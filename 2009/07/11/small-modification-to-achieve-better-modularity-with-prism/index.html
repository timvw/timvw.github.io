<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Small modification to achieve better modularity with Prism - Tim Van Wassenhove</title><meta name="viewport" content="width=device-width, initial-scale=1">
	
  <meta itemprop="name" content="Small modification to achieve better modularity with Prism">
  <meta itemprop="description" content="I have been experimenting with WPF and Prism (Composite Application Guidance for WPF and Silverlight) and ran into a major issue: modularity. Here is an excerpt from the documentation
Modules have explicit boundaries, typically by subsystem or feature. Having these boundaries makes it easier for separate teams to develop modules. On large applications, teams may be organized by cross-cutting capabilities in addition to being organized by a specific subsystem or feature. For example, there may be a team assigned to shared components of the application, such as the shell or the common infrastructure module.">
  <meta itemprop="datePublished" content="2009-07-11T00:00:00+00:00">
  <meta itemprop="dateModified" content="2021-01-04T22:47:36+01:00">
  <meta itemprop="wordCount" content="256">
  <meta itemprop="keywords" content="CSharp"><meta property="og:url" content="https://timvw.be/2009/07/11/small-modification-to-achieve-better-modularity-with-prism/">
  <meta property="og:site_name" content="Tim Van Wassenhove">
  <meta property="og:title" content="Small modification to achieve better modularity with Prism">
  <meta property="og:description" content="I have been experimenting with WPF and Prism (Composite Application Guidance for WPF and Silverlight) and ran into a major issue: modularity. Here is an excerpt from the documentation
Modules have explicit boundaries, typically by subsystem or feature. Having these boundaries makes it easier for separate teams to develop modules. On large applications, teams may be organized by cross-cutting capabilities in addition to being organized by a specific subsystem or feature. For example, there may be a team assigned to shared components of the application, such as the shell or the common infrastructure module.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2009-07-11T00:00:00+00:00">
    <meta property="article:modified_time" content="2021-01-04T22:47:36+01:00">
    <meta property="article:tag" content="CSharp">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Small modification to achieve better modularity with Prism">
  <meta name="twitter:description" content="I have been experimenting with WPF and Prism (Composite Application Guidance for WPF and Silverlight) and ran into a major issue: modularity. Here is an excerpt from the documentation
Modules have explicit boundaries, typically by subsystem or feature. Having these boundaries makes it easier for separate teams to develop modules. On large applications, teams may be organized by cross-cutting capabilities in addition to being organized by a specific subsystem or feature. For example, there may be a team assigned to shared components of the application, such as the shell or the common infrastructure module.">
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://timvw.be/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://timvw.be/js/main.js"></script>
	<link href="https://github.com/timvw" rel="me">
    <link href="https://timvw.be/" rel="me">
    <link href="https://fosstodon.org/@timvw" rel="me">
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="https://timvw.be/">Tim Van Wassenhove</a></h1>
	<div class="site-description"><p>Passionate geek, interested in Technology. Proud father of two</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/timvw" title="Github"><i data-feather="github"></i></a></li><li><a href="https://www.linkedin.com/in/timvanwassenhove" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="https://timvw.be/feed.xml" title="RSS"><i data-feather="rss"></i></a></li><li><a rel="me" href="https://fosstodon.org/@timvw" class="masto-link" ></a></li>
			</ul>
		
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="../../../../">Home</a>
			</li>
			
			<li>
				<a href="../../../../posts">All posts</a>
			</li>
			
			<li>
				<a href="../../../../tags">Tags</a>
			</li>
			
			<li>
				<a href="../../../../contact/">Contact</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">11</span>
							<span class="rest">Jul 2009</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Small modification to achieve better modularity with Prism</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>I have been experimenting with WPF and Prism (<a href="http://msdn.microsoft.com/en-us/library/cc707819.aspx">Composite Application Guidance for WPF and Silverlight</a>) and ran into a major issue: modularity. Here is an excerpt from the documentation</p>
<blockquote>
<p>Modules have explicit boundaries, typically by subsystem or feature. Having these boundaries makes it easier for separate teams to develop modules. On large applications, teams may be organized by cross-cutting capabilities in addition to being organized by a specific subsystem or feature. For example, there may be a team assigned to shared components of the application, such as the shell or the common infrastructure module.</p></blockquote>
<p>The Modularity quick start solution uses the DirectoryModuleCatalog to discover modules. The module projects have a build event that copy their output to a single Modules folder</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>xcopy &#34;$(TargetDir)*.*&#34; &#34;$(SolutionDir)DirectoryLookupModularity\$(OutDir)Modules\&#34; /Y
</span></span></code></pre></div><p>This means that if two modules output a file with the same name, one of the two will get lost :(. In order to avoid this we create a directory per module</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>xcopy &#34;$(TargetDir)*.*&#34; &#34;$(SolutionDir)DirectoryLookupModularity\$(OutDir)Modules\$(TargetName)\&#34; /Y
</span></span></code></pre></div><p>To make this work we have to modify the catalog a little</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#cf222e">protected</span> <span style="color:#cf222e">override</span> <span style="color:#cf222e">void</span> InnerLoad<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#cf222e">if</span> <span style="color:#1f2328">(</span><span style="color:#cf222e">string</span><span style="color:#1f2328">.</span>IsNullOrEmpty<span style="color:#1f2328">(</span><span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>ModulePath<span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>		<span style="color:#cf222e">throw</span> <span style="color:#cf222e">new</span> InvalidOperationException<span style="color:#1f2328">(</span>Resources<span style="color:#1f2328">.</span>ModulePathCannotBeNullOrEmpty<span style="color:#1f2328">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#cf222e">if</span> <span style="color:#1f2328">(!</span>Directory<span style="color:#1f2328">.</span>Exists<span style="color:#1f2328">(</span><span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>ModulePath<span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>		<span style="color:#cf222e">throw</span> <span style="color:#cf222e">new</span> InvalidOperationException<span style="color:#1f2328">(</span><span style="color:#cf222e">string</span><span style="color:#1f2328">.</span>Format<span style="color:#1f2328">(</span>CultureInfo<span style="color:#1f2328">.</span>CurrentCulture<span style="color:#1f2328">,</span> Resources<span style="color:#1f2328">.</span>DirectoryNotFound<span style="color:#1f2328">,</span> <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>ModulePath<span style="color:#1f2328">));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#cf222e">foreach</span> <span style="color:#1f2328">(</span><span style="color:#cf222e">var</span> assemblyFile <span style="color:#cf222e">in</span> Directory<span style="color:#1f2328">.</span>GetFiles<span style="color:#1f2328">(</span><span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>ModulePath<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;*.dll&#34;</span><span style="color:#1f2328">,</span> SearchOption<span style="color:#1f2328">.</span>AllDirectories<span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>	<span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#cf222e">var</span> privateBinPath <span style="color:#1f2328">=</span> Path<span style="color:#1f2328">.</span>GetFullPath<span style="color:#1f2328">(</span>Path<span style="color:#1f2328">.</span>GetDirectoryName<span style="color:#1f2328">(</span>assemblyFile<span style="color:#1f2328">));</span>
</span></span><span style="display:flex;"><span>		<span style="color:#cf222e">var</span> childDomain <span style="color:#1f2328">=</span> <span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>BuildChildDomain<span style="color:#1f2328">(</span>AppDomain<span style="color:#1f2328">.</span>CurrentDomain<span style="color:#1f2328">,</span> privateBinPath<span style="color:#1f2328">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#cf222e">try</span>
</span></span><span style="display:flex;"><span>		<span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#cf222e">var</span> loaderType <span style="color:#1f2328">=</span> <span style="color:#cf222e">typeof</span><span style="color:#1f2328">(</span>InnerModuleInfoLoader<span style="color:#1f2328">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#cf222e">if</span> <span style="color:#1f2328">(</span>loaderType<span style="color:#1f2328">.</span>Assembly <span style="color:#1f2328">==</span> <span style="color:#cf222e">null</span><span style="color:#1f2328">)</span> <span style="color:#cf222e">continue</span><span style="color:#1f2328">;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#cf222e">var</span> loader <span style="color:#1f2328">=</span> <span style="color:#1f2328">(</span>InnerModuleInfoLoader<span style="color:#1f2328">)</span>childDomain<span style="color:#1f2328">.</span>CreateInstanceFromAndUnwrap<span style="color:#1f2328">(</span>loaderType<span style="color:#1f2328">.</span>Assembly<span style="color:#1f2328">.</span>Location<span style="color:#1f2328">,</span> loaderType<span style="color:#1f2328">.</span>FullName<span style="color:#1f2328">);</span>
</span></span><span style="display:flex;"><span>			loader<span style="color:#1f2328">.</span>LoadAssembly<span style="color:#1f2328">(</span>assemblyFile<span style="color:#1f2328">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#cf222e">this</span><span style="color:#1f2328">.</span>Items<span style="color:#1f2328">.</span>AddRange<span style="color:#1f2328">(</span>loader<span style="color:#1f2328">.</span>GetModuleInfos<span style="color:#1f2328">());</span>
</span></span><span style="display:flex;"><span>		<span style="color:#1f2328">}</span>		
</span></span><span style="display:flex;"><span>		<span style="color:#cf222e">finally</span>
</span></span><span style="display:flex;"><span>		<span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>			AppDomain<span style="color:#1f2328">.</span>Unload<span style="color:#1f2328">(</span>childDomain<span style="color:#1f2328">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span></code></pre></div><p>As long as we don&rsquo;t use (unsigned and different) assembly files with the same name in different modules we will have a working solution.</p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="../../../../tags/csharp">CSharp</a></li>
							
						</ul>
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2025  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-9DP4SV12YW"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-9DP4SV12YW');
        }
      </script><script>feather.replace()</script>
</body>
</html>
