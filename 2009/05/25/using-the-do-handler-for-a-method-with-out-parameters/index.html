<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Using the Do handler for a method with out parameters - Tim Van Wassenhove</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="Using the Do handler for a method with out parameters"><meta itemprop=description content="As you can read in the documentation for Rhino Mocks:
There are times when the returning a static value is not good enough for the scenario that you are testing, so for those cases, you can use the Do() handler to add custom behavior when the method is called. In general, the Do() handler simply replaces the method call. Its return value will be returned from the mocked call (as well as any exception thrown)."><meta itemprop=datePublished content="2009-05-25T00:00:00+00:00"><meta itemprop=dateModified content="2021-01-04T22:47:36+01:00"><meta itemprop=wordCount content="190"><meta itemprop=keywords content="CSharp,"><meta property="og:title" content="Using the Do handler for a method with out parameters"><meta property="og:description" content="As you can read in the documentation for Rhino Mocks:
There are times when the returning a static value is not good enough for the scenario that you are testing, so for those cases, you can use the Do() handler to add custom behavior when the method is called. In general, the Do() handler simply replaces the method call. Its return value will be returned from the mocked call (as well as any exception thrown)."><meta property="og:type" content="article"><meta property="og:url" content="https://timvw.be/2009/05/25/using-the-do-handler-for-a-method-with-out-parameters/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2009-05-25T00:00:00+00:00"><meta property="article:modified_time" content="2021-01-04T22:47:36+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using the Do handler for a method with out parameters"><meta name=twitter:description content="As you can read in the documentation for Rhino Mocks:
There are times when the returning a static value is not good enough for the scenario that you are testing, so for those cases, you can use the Do() handler to add custom behavior when the method is called. In general, the Do() handler simply replaces the method call. Its return value will be returned from the mocked call (as well as any exception thrown)."><link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel=stylesheet type=text/css><link rel=stylesheet type=text/css media=screen href=https://timvw.be/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://timvw.be/css/main.css><link id=dark-scheme rel=stylesheet type=text/css href=https://timvw.be/css/dark.css><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script>
<script src=https://timvw.be/js/main.js></script></head><body><div class="container wrapper"><div class=header><h1 class=site-title><a href=https://timvw.be/>Tim Van Wassenhove</a></h1><div class=site-description><p>Passionate geek, interested in Technology. Proud father of two</p><nav class="nav social"><ul class=flat><li><a href=https://twitter.com/timvw title=Twitter><i data-feather=twitter></i></a></li><li><a href=https://github.com/timvw title=Github><i data-feather=github></i></a></li><li><a href=https://www.linkedin.com/in/timvanwassenhove title=Linkedin><i data-feather=linkedin></i></a></li><li><a href=https://timvw.be/feed.xml title=RSS><i data-feather=rss></i></a></li></ul></nav></div><nav class=nav><ul class=flat><li><a href=../../../../>Home</a></li><li><a href=../../../../posts>All posts</a></li><li><a href=../../../../tags>Tags</a></li></ul></nav></div><div class=post><div class=post-header><div class=meta><div class=date><span class=day>25</span>
<span class=rest>May 2009</span></div></div><div class=matter><h1 class=title>Using the Do handler for a method with out parameters</h1></div></div><div class=markdown><p>As you can read in <a href=http://ayende.com/Wiki/(S(mc1hst55a1303emfc34dkmyr))/Rhino+Mocks+The+Do()+Handler.ashx>the documentation</a> for Rhino Mocks:</p><blockquote><p>There are times when the returning a static value is not good enough for the scenario that you are testing, so for those cases, you can use the Do() handler to add custom behavior when the method is called. In general, the Do() handler simply replaces the method call. Its return value will be returned from the mocked call (as well as any exception thrown). The handler&rsquo;s signature must match the method signature, since it gets the same parameters as the call.</p></blockquote><p>There are quite a lot of delegates defined in Rhino.Mocks.Delegates but none of them has an output parameter so we got stuck when we tried to mock a method with the following signature:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#458;font-weight:700>bool</span> TryGet(<span style=color:#458;font-weight:700>int</span> id, <span style=color:#000;font-weight:700>out</span> Entity entity);
</span></span></code></pre></div><p>Luckily enough it didn&rsquo;t take too long before i realised we could simply define our own delegate:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#000;font-weight:700>delegate</span> <span style=color:#458;font-weight:700>bool</span> TryGetMethod&lt;keyType, ValueType&gt;(KeyType key, <span style=color:#000;font-weight:700>out</span> ValueType <span style=color:#000;font-weight:700>value</span>);
</span></span></code></pre></div><p>And now we can easily setup a result for our method:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>myEntityRepository
</span></span><span style=display:flex><span>.Stub(repository =&gt; repository.TryGet(<span style=color:#099>0</span>, <span style=color:#000;font-weight:700>out</span> myEntity);)
</span></span><span style=display:flex><span>.IgnoreArguments()
</span></span><span style=display:flex><span>.Do((TryGetMethod&lt;<span style=color:#458;font-weight:700>int</span>, MyEntity&gt;)<span style=color:#000;font-weight:700>delegate</span>(<span style=color:#458;font-weight:700>int</span> id, <span style=color:#000;font-weight:700>out</span> MyEntity entity)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>entity = <span style=color:#000;font-weight:700>new</span> MyEntity();
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>return</span> id == <span style=color:#099>1</span>;
</span></span><span style=display:flex><span>});
</span></span></code></pre></div></div><div class=tags><ul class=flat><li><a href=../../../../tags/csharp>CSharp</a></li></ul></div></div></div><div class="footer wrapper"><nav class=nav><div>2022 <a href=https://github.com/knadh/hugo-ink>Ink</a> theme on <a href=https://gohugo.io>Hugo</a></div></nav></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-9DP4SV12YW"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-9DP4SV12YW',{anonymize_ip:!1})}</script><script>feather.replace()</script></body></html>