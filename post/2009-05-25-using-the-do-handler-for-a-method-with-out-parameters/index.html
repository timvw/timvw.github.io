<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Using the Do handler for a method with out parameters - Tim Van Wassenhove</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta itemprop="name" content="Using the Do handler for a method with out parameters">
<meta itemprop="description" content="As you can read in the documentation for Rhino Mocks:
 There are times when the returning a static value is not good enough for the scenario that you are testing, so for those cases, you can use the Do() handler to add custom behavior when the method is called. In general, the Do() handler simply replaces the method call. Its return value will be returned from the mocked call (as well as any exception thrown).">
<meta itemprop="datePublished" content="2009-05-25T00:00:00+00:00" />
<meta itemprop="dateModified" content="2009-05-25T00:00:00+00:00" />
<meta itemprop="wordCount" content="190">



<meta itemprop="keywords" content="C#," />
<meta property="og:title" content="Using the Do handler for a method with out parameters" />
<meta property="og:description" content="As you can read in the documentation for Rhino Mocks:
 There are times when the returning a static value is not good enough for the scenario that you are testing, so for those cases, you can use the Do() handler to add custom behavior when the method is called. In general, the Do() handler simply replaces the method call. Its return value will be returned from the mocked call (as well as any exception thrown)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/2009-05-25-using-the-do-handler-for-a-method-with-out-parameters/" />
<meta property="article:published_time" content="2009-05-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2009-05-25T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Using the Do handler for a method with out parameters"/>
<meta name="twitter:description" content="As you can read in the documentation for Rhino Mocks:
 There are times when the returning a static value is not good enough for the scenario that you are testing, so for those cases, you can use the Do() handler to add custom behavior when the method is called. In general, the Do() handler simply replaces the method call. Its return value will be returned from the mocked call (as well as any exception thrown)."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="">Tim Van Wassenhove</a></h1>
	<div class="site-description"><nav class="nav social">
			<ul class="flat"><li><a href="https://twitter.com/timvw" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://github.com/timvw" title="Github"><i data-feather="github"></i></a></li><li><a href="https://www.linkedin.com/in/timvanwassenhove" title="Linkedin"><i data-feather="linkedin"></i></a></li></ul>
		</nav></div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/post">All posts</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">25</span>
							<span class="rest">May 2009</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Using the Do handler for a method with out parameters</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>As you can read in <a href="http://ayende.com/Wiki/(S(mc1hst55a1303emfc34dkmyr))/Rhino+Mocks+The+Do()+Handler.ashx">the documentation</a> for Rhino Mocks:</p>
<blockquote>
<p>There are times when the returning a static value is not good enough for the scenario that you are testing, so for those cases, you can use the Do() handler to add custom behavior when the method is called. In general, the Do() handler simply replaces the method call. Its return value will be returned from the mocked call (as well as any exception thrown). The handler&rsquo;s signature must match the method signature, since it gets the same parameters as the call.</p>
</blockquote>
<p>There are quite a lot of delegates defined in Rhino.Mocks.Delegates but none of them has an output parameter so we got stuck when we tried to mock a method with the following signature:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">bool</span> TryGet(<span style="color:#66d9ef">int</span> id, <span style="color:#66d9ef">out</span> Entity entity);
</code></pre></div><p>Luckily enough it didn&rsquo;t take too long before i realised we could simply define our own delegate:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">delegate</span> <span style="color:#66d9ef">bool</span> TryGetMethod&lt;keyType, ValueType&gt;(KeyType key, <span style="color:#66d9ef">out</span> ValueType <span style="color:#66d9ef">value</span>);
</code></pre></div><p>And now we can easily setup a result for our method:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">myEntityRepository
.Stub(repository =&gt; repository.TryGet(<span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">out</span> myEntity);)
.IgnoreArguments()
.Do((TryGetMethod&lt;<span style="color:#66d9ef">int</span>, MyEntity&gt;)<span style="color:#66d9ef">delegate</span>(<span style="color:#66d9ef">int</span> id, <span style="color:#66d9ef">out</span> MyEntity entity)
{
entity = <span style="color:#66d9ef">new</span> MyEntity();
<span style="color:#66d9ef">return</span> id == <span style="color:#ae81ff">1</span>;
});
</code></pre></div>
			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/C">C#</a></li>
							
						</ul>
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2021  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-2585435-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
