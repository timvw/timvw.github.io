<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Brainteaser - Tim Van Wassenhove</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta itemprop="name" content="Brainteaser">
<meta itemprop="description" content="Earlier today Chung Leong, an intelligent regular at comp.lang.php, posted a little brainteaser:
 The two functions in the example below behave differently. The difference is easy to spot, of ocurse. The challenge is correctly explaining why this is so. Why does the second function seemingly corrupt the cloned copy of an object?
 function BritneySpear(&amp;$obj) { $attr =&amp; $obj-&gt;attributes; $clone = /* clone */ $obj; $obj-&gt;attributes[‘Length’] = 0; $obj-&gt;data = “”; return $clone; } $data = “This is a test”; $obj1-&gt;attributes = array(‘Length’ =&gt; strlen($data)); $obj1-&gt;data = $data; $clone1 = Bobcat($obj1); print_r($clone1); $obj2-&gt;attributes = array(‘Length’ =&gt; strlen($data)); $obj2-&gt;data = $data; $clone2 = BritneySpear($obj2); print_r($clone2); ?">
<meta itemprop="datePublished" content="2006-01-14T00:00:00+00:00" />
<meta itemprop="dateModified" content="2021-01-04T14:42:30+01:00" />
<meta itemprop="wordCount" content="227">



<meta itemprop="keywords" content="PHP," />
<meta property="og:title" content="Brainteaser" />
<meta property="og:description" content="Earlier today Chung Leong, an intelligent regular at comp.lang.php, posted a little brainteaser:
 The two functions in the example below behave differently. The difference is easy to spot, of ocurse. The challenge is correctly explaining why this is so. Why does the second function seemingly corrupt the cloned copy of an object?
 function BritneySpear(&amp;$obj) { $attr =&amp; $obj-&gt;attributes; $clone = /* clone */ $obj; $obj-&gt;attributes[‘Length’] = 0; $obj-&gt;data = “”; return $clone; } $data = “This is a test”; $obj1-&gt;attributes = array(‘Length’ =&gt; strlen($data)); $obj1-&gt;data = $data; $clone1 = Bobcat($obj1); print_r($clone1); $obj2-&gt;attributes = array(‘Length’ =&gt; strlen($data)); $obj2-&gt;data = $data; $clone2 = BritneySpear($obj2); print_r($clone2); ?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://timvw.be/post/2006-01-14-brainteaser/" />
<meta property="article:published_time" content="2006-01-14T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-04T14:42:30+01:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Brainteaser"/>
<meta name="twitter:description" content="Earlier today Chung Leong, an intelligent regular at comp.lang.php, posted a little brainteaser:
 The two functions in the example below behave differently. The difference is easy to spot, of ocurse. The challenge is correctly explaining why this is so. Why does the second function seemingly corrupt the cloned copy of an object?
 function BritneySpear(&amp;$obj) { $attr =&amp; $obj-&gt;attributes; $clone = /* clone */ $obj; $obj-&gt;attributes[‘Length’] = 0; $obj-&gt;data = “”; return $clone; } $data = “This is a test”; $obj1-&gt;attributes = array(‘Length’ =&gt; strlen($data)); $obj1-&gt;data = $data; $clone1 = Bobcat($obj1); print_r($clone1); $obj2-&gt;attributes = array(‘Length’ =&gt; strlen($data)); $obj2-&gt;data = $data; $clone2 = BritneySpear($obj2); print_r($clone2); ?"/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://timvw.be/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://timvw.be/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="https://timvw.be/">Tim Van Wassenhove</a></h1>
	<div class="site-description"><nav class="nav social">
			<ul class="flat"><li><a href="https://twitter.com/timvw" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://github.com/timvw" title="Github"><i data-feather="github"></i></a></li><li><a href="https://www.linkedin.com/in/timvanwassenhove" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="https://timvw.be/feed.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav></div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/post">All posts</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">14</span>
							<span class="rest">Jan 2006</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Brainteaser</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>Earlier today Chung Leong, an intelligent regular at <a href="news://comp.lang.php">comp.lang.php</a>, posted a little brainteaser:</p>
<blockquote>
<p>The two functions in the example below behave differently. The difference is easy to spot, of ocurse. The challenge is correctly explaining why this is so. Why does the second function seemingly corrupt the cloned copy of an object?</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">BritneySpear</span>(<span style="color:#f92672">&amp;</span>$obj) {
$attr <span style="color:#f92672">=&amp;</span> $obj<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">attributes</span>;
$clone <span style="color:#f92672">=</span> <span style="color:#75715e">/* clone */</span> $obj;
$obj<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">attributes</span>[<span style="color:#a6e22e">‘Length’</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
$obj<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">“”</span>;
<span style="color:#66d9ef">return</span> $clone;
}

$data <span style="color:#f92672">=</span> <span style="color:#a6e22e">“This</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">test”</span>;
$obj1<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">attributes</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(<span style="color:#a6e22e">‘Length’</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">strlen</span>($data));
$obj1<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> $data;
$clone1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Bobcat</span>($obj1);
<span style="color:#a6e22e">print_r</span>($clone1);

$obj2<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">attributes</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(<span style="color:#a6e22e">‘Length’</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">strlen</span>($data));
$obj2<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> $data;
$clone2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">BritneySpear</span>($obj2);
<span style="color:#a6e22e">print_r</span>($clone2);
<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><blockquote>
<p>Result:</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">stdClass</span> <span style="color:#a6e22e">Object</span>
(
    [<span style="color:#a6e22e">attributes</span>] <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">Array</span>
        (
            [<span style="color:#a6e22e">Length</span>] <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">14</span>
        )

    [<span style="color:#a6e22e">data</span>] <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">This</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">test</span>
)
<span style="color:#66d9ef">stdClass</span> <span style="color:#a6e22e">Object</span>
(
    [<span style="color:#a6e22e">attributes</span>] <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">Array</span>
        (
            [<span style="color:#a6e22e">Length</span>] <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">0</span>
        )

    [<span style="color:#a6e22e">data</span>] <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">This</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">test</span>
)
</code></pre></div><p>It took me fifteen minutes to figure out the source of this mysterious behaviour, but it took me a couple of hours to come up with the following explanation: After $attr =&amp; $obj-&gt;attributes in the BritneySpear function the container that holds this variables has is_ref=1. Any properties that are references to other variables, will remain references when $obj is copied into $clone as explained in <a href="http://php.belnet.be/manual/en/language.oop5.cloning.php">Object cloning</a>.</p>
<p>If you want to know more about references i can advise you to read <a href="http://derickrethans.nl/files/phparch-php-variables-article.pdf">PHP References</a> by <a href="http://derickrethans.nl">Derick Rethans</a>.</p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/PHP">PHP</a></li>
							
						</ul>
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2021  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-2585435-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
