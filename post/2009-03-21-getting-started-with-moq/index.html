<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Getting started with Moq - Tim Van Wassenhove</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta itemprop="name" content="Getting started with Moq">
<meta itemprop="description" content="In this article I will demonstrate the Moq API by means of a simple application that allows the user to manage a quote.
In order to prevent that we have to rewrite our application when we move to a different graphical environment such as Web Forms, Silverlight or WPF I have decided to apply the [Humble Object](http://xunitpatterns.com/Humble Object.html) pattern in the design. The implementation of the application has been based on the Passive View pattern.">
<meta itemprop="datePublished" content="2009-03-21T00:00:00+00:00" />
<meta itemprop="dateModified" content="2021-01-04T15:22:11+01:00" />
<meta itemprop="wordCount" content="537">



<meta itemprop="keywords" content="CSharp," />
<meta property="og:title" content="Getting started with Moq" />
<meta property="og:description" content="In this article I will demonstrate the Moq API by means of a simple application that allows the user to manage a quote.
In order to prevent that we have to rewrite our application when we move to a different graphical environment such as Web Forms, Silverlight or WPF I have decided to apply the [Humble Object](http://xunitpatterns.com/Humble Object.html) pattern in the design. The implementation of the application has been based on the Passive View pattern." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://timvw.be/post/2009-03-21-getting-started-with-moq/" />
<meta property="article:published_time" content="2009-03-21T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-04T15:22:11+01:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Getting started with Moq"/>
<meta name="twitter:description" content="In this article I will demonstrate the Moq API by means of a simple application that allows the user to manage a quote.
In order to prevent that we have to rewrite our application when we move to a different graphical environment such as Web Forms, Silverlight or WPF I have decided to apply the [Humble Object](http://xunitpatterns.com/Humble Object.html) pattern in the design. The implementation of the application has been based on the Passive View pattern."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://timvw.be/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://timvw.be/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="https://timvw.be/">Tim Van Wassenhove</a></h1>
	<div class="site-description"><p>Passionate geek, interested in Technology. Proud father of two</p><nav class="nav social">
			<ul class="flat"><li><a href="https://twitter.com/timvw" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://github.com/timvw" title="Github"><i data-feather="github"></i></a></li><li><a href="https://www.linkedin.com/in/timvanwassenhove" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="https://timvw.be/feed.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav></div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="../../">Home</a>
			</li>
			
			<li>
				<a href="../../post">All posts</a>
			</li>
			
			<li>
				<a href="../../tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">21</span>
							<span class="rest">Mar 2009</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Getting started with Moq</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>In this article I will demonstrate the Moq API by means of a simple application that allows the user to manage a quote.</p>
<p><img src="http://www.timvw.be/wp-content/images/QuoteOfTheDay-01.jpg" alt="screenshot of quote manager displaying opening screen."></p>
<p><img src="http://www.timvw.be/wp-content/images/QuoteOfTheDay-02.jpg" alt="screenshot of quote manager displaying edit screen."></p>
<p>In order to prevent that we have to rewrite our application when we move to a different graphical environment such as Web Forms, Silverlight or WPF I have decided to apply the [Humble Object](<a href="http://xunitpatterns.com/Humble">http://xunitpatterns.com/Humble</a> Object.html) pattern in the design. The implementation of the application has been based on the <a href="http://martinfowler.com/eaaDev/PassiveScreen.html">Passive View pattern</a>.</p>
<p>First we describe what should happen when the user launches the application:</p>
<ul>
<li>The quote should be displayed</li>
<li>The Edit button should be visible</li>
<li>The OK button should be invisible</li>
<li>The Cancel button should be invisible</li>
<li>It should not be possible to edit the quote</li>
</ul>
<p>Now we translate these requirements in <a href="http://www.timvw.be/wp-content/code/csharp/Code-01.txt">code</a>. Because it is too expensive to test with actual Windows resources I have decided to use a mock object that mimics the actual resource. This is done in the Given method which arranges the context in which we want to verify the behavior:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">this</span>.quoteFormViewMock = <span style="color:#000;font-weight:bold">new</span> Mock&lt;iquoteFormView&gt;();
<span style="color:#998;font-style:italic">// The mimicked view object is available via the Object property
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">this</span>.sut = <span style="color:#000;font-weight:bold">new</span> QuoteFormPresenter(<span style="color:#000;font-weight:bold">this</span>.quoteFormViewMock.Object);
</code></pre></div><p>The When method is used to invoke the behavior that we want to verify. In the situation where the user launches the application this means raising the Load event:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">this</span>.quoteFormViewMock.Raise(view =&gt; view.Load += <span style="color:#000;font-weight:bold">null</span>, <span style="color:#000;font-weight:bold">null</span>, EventArgs.Empty);
</code></pre></div><p>We can verify that a certain method has been called as following:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">this</span>.quoteFormViewMock.Verify(view =&gt; view.MakeEditButtonVisible(<span style="color:#000;font-weight:bold">true</span>));
</code></pre></div><p>In situations where we donâ€™t have the exact parameters for the method that should be invoked we can use the <a href="http://api.moq.me/html/FBE0FFA5.htm">It</a> class to describe those parameters:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">this</span>.quoteFormViewMock.Verify(view =&gt; view.DisplayQuote(It.IsAny&lt;<span style="color:#458;font-weight:bold">string</span>&gt;()));
</code></pre></div><p>We repeat this process of defining and implementing the requirements for the other interactions we want to describe. We end up with a set of requirements that looks like this:</p>
<p><img src="http://www.timvw.be/wp-content/images/QuoteOfTheDay-03.jpg" alt="screenshot of test manager"></p>
<p>In case the user clicked the Cancel button we want to verify that the updated quote is not displayed:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">this</span>.quoteFormViewMock.Verify(view =&gt; view.DisplayQuote(It.IsAny&lt;<span style="color:#458;font-weight:bold">string</span>&gt;()), Times.Never());
</code></pre></div><p>In case the user clicked the OK button we have to ensure a context where an updated quote is available. This is achieved by adding the following in our Given method:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">this</span>.quoteFormViewMock
.Setup(view =&gt; view.UpdatedQuote)
.Returns(<span style="color:#000;font-weight:bold">this</span>.updatedQuote);
</code></pre></div><p>Now we can verify that the updated quote is displayed:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">this</span>.quoteFormViewMock.Verify(view =&gt; view.DisplayQuote(<span style="color:#000;font-weight:bold">this</span>.updatedQuote));
</code></pre></div><p>Virtually every application interacts with a database and the same is true for our application. Just like we abstracted our view, we decide to abstract our quote resource too. In case the user clicked the OK button we want to verify that the resource was instructed to update the quote.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#458;font-weight:bold">var</span> quote = <span style="color:#000;font-weight:bold">this</span>.quoteFormViewMock.Object.UpdatedQuote;
<span style="color:#000;font-weight:bold">this</span>.quoteResourceMock.Verify(resource =&gt; resource.Update(quote));
</code></pre></div><p>In case the quote resource fails we would like to display an error message. To achieve this we create a new test that establishes a context where the quote resource throws an exception when it is asked to update a quote as following:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">base</span>.Given();
<span style="color:#000;font-weight:bold">base</span>.quoteResourceMock
.Setup(resource =&gt; resource.Update(It.IsAny&lt;<span style="color:#458;font-weight:bold">string</span>&gt;()))
.Throws(<span style="color:#000;font-weight:bold">new</span> ApplicationException(<span style="color:#d14">&#34;Resource is unavailable.&#34;</span>));
</code></pre></div><p>Sometimes we want to determine what should happen based on the parameters that are provided. In that case we can provide the Returns function a delegate:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">base</span>.quoteResourceMock
.Setup(resource =&gt; resource.Update(It.IsAny&lt;<span style="color:#458;font-weight:bold">string</span>&gt;()))
.Returns&lt;<span style="color:#458;font-weight:bold">string</span>&gt;(quote =&gt;
{
<span style="color:#000;font-weight:bold">if</span> (<span style="color:#458;font-weight:bold">string</span>.IsNullOrEmpty(quote)) <span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> ApplicationException();
<span style="color:#000;font-weight:bold">return</span> quote.Replace(<span style="color:#d14">&#34;a&#34;</span>, <span style="color:#d14">&#34;b&#34;</span>);
});
</code></pre></div><p>I think that this covers most typical usage scenarios. Feel free to download the code: <a href="http://www.timvw.be/wp-content/code/csharp/QuoteManager.zip">QuoteManager.zip</a>.</p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="../../tags/CSharp">CSharp</a></li>
							
						</ul>
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2021  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-2585435-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
