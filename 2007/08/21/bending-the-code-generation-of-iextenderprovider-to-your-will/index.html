<!doctype html><html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge"><title>Bending the code generation of IExtenderProvider to your will - Tim Van Wassenhove</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta itemprop=name content="Bending the code generation of IExtenderProvider to your will">
<meta itemprop=description content="In Exploring CodeDomSerializer i already explained how we can modify the code that the Visual Studio designer generates for us. With a typical IExtenderProvider the designer generates an initializer, SetXXX methods and a variable declaration, which looks like
this.constantsExtenderProvider1 = new WindowsApplication1.ConstantsExtenderProvider(); this.constantsExtenderProvider1.SetConstants(this.button1, new string[] { &#34;Operation1&#34;, &#34;Operation5&#34;}); this.constantsExtenderProvider1.SetConstants(this, null); private ConstantsExtenderProvider constantsExtenderProvider1; Now, what if we&rsquo;re not happy with those generated SetXXX methods on each Component? The problem is that this code is not generated by the serializer for the ConstantsExtenderProvider but by the serializers for the Components."><meta itemprop=datePublished content="2007-08-21T00:00:00+00:00">
<meta itemprop=dateModified content="2021-01-04T22:47:36+01:00">
<meta itemprop=wordCount content="302">
<meta itemprop=keywords content="CSharp,Visual Studio,Windows Forms,"><meta property="og:title" content="Bending the code generation of IExtenderProvider to your will">
<meta property="og:description" content="In Exploring CodeDomSerializer i already explained how we can modify the code that the Visual Studio designer generates for us. With a typical IExtenderProvider the designer generates an initializer, SetXXX methods and a variable declaration, which looks like
this.constantsExtenderProvider1 = new WindowsApplication1.ConstantsExtenderProvider(); this.constantsExtenderProvider1.SetConstants(this.button1, new string[] { &#34;Operation1&#34;, &#34;Operation5&#34;}); this.constantsExtenderProvider1.SetConstants(this, null); private ConstantsExtenderProvider constantsExtenderProvider1; Now, what if we&rsquo;re not happy with those generated SetXXX methods on each Component? The problem is that this code is not generated by the serializer for the ConstantsExtenderProvider but by the serializers for the Components.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://timvw.be/2007/08/21/bending-the-code-generation-of-iextenderprovider-to-your-will/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2007-08-21T00:00:00+00:00">
<meta property="article:modified_time" content="2021-01-04T22:47:36+01:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Bending the code generation of IExtenderProvider to your will">
<meta name=twitter:description content="In Exploring CodeDomSerializer i already explained how we can modify the code that the Visual Studio designer generates for us. With a typical IExtenderProvider the designer generates an initializer, SetXXX methods and a variable declaration, which looks like
this.constantsExtenderProvider1 = new WindowsApplication1.ConstantsExtenderProvider(); this.constantsExtenderProvider1.SetConstants(this.button1, new string[] { &#34;Operation1&#34;, &#34;Operation5&#34;}); this.constantsExtenderProvider1.SetConstants(this, null); private ConstantsExtenderProvider constantsExtenderProvider1; Now, what if we&rsquo;re not happy with those generated SetXXX methods on each Component? The problem is that this code is not generated by the serializer for the ConstantsExtenderProvider but by the serializers for the Components.">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700" rel=stylesheet type=text/css>
<link rel=stylesheet type=text/css media=screen href=https://timvw.be/css/normalize.css>
<link rel=stylesheet type=text/css media=screen href=https://timvw.be/css/main.css>
<link id=dark-scheme rel=stylesheet type=text/css href=https://timvw.be/css/dark.css>
<script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script>
<script src=https://timvw.be/js/main.js></script>
</head>
<body>
<div class="container wrapper">
<div class=header>
<h1 class=site-title><a href=https://timvw.be/>Tim Van Wassenhove</a></h1>
<div class=site-description><p>Passionate geek, interested in Technology. Proud father of two</p><nav class="nav social">
<ul class=flat><li><a href=https://twitter.com/timvw title=Twitter><i data-feather=twitter></i></a></li><li><a href=https://github.com/timvw title=Github><i data-feather=github></i></a></li><li><a href=https://www.linkedin.com/in/timvanwassenhove title=Linkedin><i data-feather=linkedin></i></a></li><li><a href=https://timvw.be/feed.xml title=RSS><i data-feather=rss></i></a></li></ul>
</nav>
</div>
<nav class=nav>
<ul class=flat>
<li>
<a href=../../../../>Home</a>
</li>
<li>
<a href=../../../../posts>All posts</a>
</li>
<li>
<a href=../../../../tags>Tags</a>
</li>
</ul>
</nav>
</div>
<div class=post>
<div class=post-header>
<div class=meta>
<div class=date>
<span class=day>21</span>
<span class=rest>Aug 2007</span>
</div>
</div>
<div class=matter>
<h1 class=title>Bending the code generation of IExtenderProvider to your will</h1>
</div>
</div>
<div class=markdown>
<p>In <a href=http://www.timvw.be/exploring-codedomserializer/>Exploring CodeDomSerializer</a> i already explained how we can modify the code that the Visual Studio designer generates for us. With a typical <a href=http://msdn2.microsoft.com/en-us/library/system.componentmodel.iextenderprovider.aspx>IExtenderProvider</a> the designer generates an initializer, SetXXX methods and a variable declaration, which looks like</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#000;font-weight:700>this</span>.constantsExtenderProvider1 = <span style=color:#000;font-weight:700>new</span> WindowsApplication1.ConstantsExtenderProvider();

<span style=color:#000;font-weight:700>this</span>.constantsExtenderProvider1.SetConstants(<span style=color:#000;font-weight:700>this</span>.button1, <span style=color:#000;font-weight:700>new</span> <span style=color:#458;font-weight:700>string</span>[] {
<span style=color:#d14>&#34;Operation1&#34;</span>,
<span style=color:#d14>&#34;Operation5&#34;</span>});

<span style=color:#000;font-weight:700>this</span>.constantsExtenderProvider1.SetConstants(<span style=color:#000;font-weight:700>this</span>, <span style=color:#000;font-weight:700>null</span>);

<span style=color:#000;font-weight:700>private</span> ConstantsExtenderProvider constantsExtenderProvider1;
</code></pre></div><p>Now, what if we&rsquo;re not happy with those generated SetXXX methods on each Component? The problem is that this code is not generated by the serializer for the ConstantsExtenderProvider but by the serializers for the Components. An easy workaround for this problem is to set the <a href=http://msdn2.microsoft.com/en-us/library/system.componentmodel.designerserializationvisibilityattribute.aspx>DesignerSerializationVisibilityAttribute</a> on the GetXXX method in our IExtenderProvider to <a href=http://msdn2.microsoft.com/en-us/library/system.componentmodel.designerserializationvisibility.aspx>Hidden</a>.</p>
<p>With those ugly SetXXX methods out of the way it&rsquo;s up to us to do it better. We do this by implementing a custom serializer for our ConstantsExtenderProvider</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>ConstantsSerializer</span>&lt;T&gt; : CodeDomSerializer
{
	<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>override</span> <span style=color:#458;font-weight:700>object</span> Serialize(IDesignerSerializationManager manager, <span style=color:#458;font-weight:700>object</span> <span style=color:#000;font-weight:700>value</span>)
	{
		ConstantsExtenderProvider provider = <span style=color:#000;font-weight:700>value</span> <span style=color:#000;font-weight:700>as</span> ConstantsExtenderProvider;

		CodeDomSerializer baseClassSerializer = manager.GetSerializer(<span style=color:#000;font-weight:700>typeof</span>(ConstantsExtenderProvider).BaseType, <span style=color:#000;font-weight:700>typeof</span>(CodeDomSerializer)) <span style=color:#000;font-weight:700>as</span> CodeDomSerializer;
		CodeStatementCollection statements = baseClassSerializer.Serialize(manager, <span style=color:#000;font-weight:700>value</span>) <span style=color:#000;font-weight:700>as</span> CodeStatementCollection;

		IDesignerHost host = (IDesignerHost)manager.GetService(<span style=color:#000;font-weight:700>typeof</span>(IDesignerHost));
		ComponentCollection components = host.Container.Components;
		<span style=color:#000;font-weight:700>this</span>.SerializeExtender(manager, provider, components, statements);

		<span style=color:#000;font-weight:700>return</span> statements;
	}

	<span style=color:#000;font-weight:700>private</span> <span style=color:#000;font-weight:700>void</span> SerializeExtender(IDesignerSerializationManager manager, ConstantsExtenderProvider provider, ComponentCollection components, CodeStatementCollection statements)
	{
		<span style=color:#000;font-weight:700>foreach</span> (IComponent component <span style=color:#000;font-weight:700>in</span> components)
		{
			Control control = component <span style=color:#000;font-weight:700>as</span> Control;
			<span style=color:#000;font-weight:700>if</span> (control != <span style=color:#000;font-weight:700>null</span> &amp;&amp; (control <span style=color:#000;font-weight:700>as</span> Form == <span style=color:#000;font-weight:700>null</span>))
			{
				CodeMethodInvokeExpression methodcall = <span style=color:#000;font-weight:700>new</span> CodeMethodInvokeExpression(<span style=color:#000;font-weight:700>base</span>.SerializeToExpression(manager, provider), <span style=color:#d14>&#34;SetConstants&#34;</span>);
				methodcall.Parameters.Add(<span style=color:#000;font-weight:700>new</span> CodeFieldReferenceExpression(<span style=color:#000;font-weight:700>new</span> CodeThisReferenceExpression(), control.Name));

				<span style=color:#458;font-weight:700>string</span>[] constants = provider.GetConstants(control);
				<span style=color:#000;font-weight:700>if</span> (constants != <span style=color:#000;font-weight:700>null</span>)
				{
					StringBuilder sb = <span style=color:#000;font-weight:700>new</span> StringBuilder();
					sb.Append(<span style=color:#d14>&#34;new string[] { &#34;</span>);

					<span style=color:#000;font-weight:700>foreach</span> (<span style=color:#458;font-weight:700>string</span> constant <span style=color:#000;font-weight:700>in</span> constants)
					{
						sb.Append(<span style=color:#000;font-weight:700>typeof</span>(T).FullName);
						sb.Append(<span style=color:#d14>&#34;.&#34;</span>);
						sb.Append(constant);
						sb.Append(<span style=color:#d14>&#34;, &#34;</span>);
					}

					sb.Remove(sb.Length -- <span style=color:#099>2</span>, <span style=color:#099>2</span>);
					sb.Append(<span style=color:#d14>&#34; }&#34;</span>);

					methodcall.Parameters.Add(<span style=color:#000;font-weight:700>new</span> CodeSnippetExpression(sb.ToString()));
				}
				<span style=color:#000;font-weight:700>else</span>
				{
					methodcall.Parameters.Add(<span style=color:#000;font-weight:700>new</span> CodePrimitiveExpression(<span style=color:#000;font-weight:700>null</span>));
				}

				statements.Add(methodcall);
			}
		}
	}
}
</code></pre></div><p>And now the generated code looks like</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#000;font-weight:700>this</span>.constantsExtenderProvider1.SetConstants(<span style=color:#000;font-weight:700>this</span>.button1, <span style=color:#000;font-weight:700>new</span> <span style=color:#458;font-weight:700>string</span>[] { WindowsApplication1.Constants.Operation1, WindowsApplication1.Constants.Operation5 });
</code></pre></div><p>As always, feel free to download the <a href=http://www.timvw.be/wp-content/code/csharp/ConstantsExtenderProvider.zip>ConstantsExtenderProvider</a> source.</p>
</div>
<div class=tags>
<ul class=flat>
<li><a href=../../../../tags/csharp>CSharp</a></li>
<li><a href=../../../../tags/visual-studio>Visual Studio</a></li>
<li><a href=../../../../tags/windows-forms>Windows Forms</a></li>
</ul>
</div></div>
</div>
<div class="footer wrapper">
<nav class=nav>
<div>2022 <a href=https://github.com/knadh/hugo-ink>Ink</a> theme on <a href=https://gohugo.io>Hugo</a></div>
</nav>
</div>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-2585435-1','auto'),ga('send','pageview'))</script><script>feather.replace()</script>
</body>
</html>