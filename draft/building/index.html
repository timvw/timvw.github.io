<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Leverage Terraform, Azure Container Service and kaniko to create and use container images on Kubernetes. - Tim Van Wassenhove</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta itemprop="name" content="Leverage Terraform, Azure Container Service and kaniko to create and use container images on Kubernetes.">
<meta itemprop="description" content="In this post I demonstrate how easy it has become to build and use container images on Kubernetes (without docker) leveraging kaniko.
In order to follow along you should clone the sample code from this repository:
git clone https://github.com/timvw/sample-terraform-azure-k8s-acr-kaniko Create an Azure Container Registry with Terraform
terraform init terraform apply -auto-approve We will use the admin credentials to create a docker registry secret:
kubectl create secret docker-registry acr-secret \  --namespace default \  --docker-server=https://$(terraform output cr_server) \  --docker-username=$(terraform output cr_admin_username) \  --docker-password=$(terraform output cr_admin_password) Now we can build an image on our cluster and push it to our container registry:">
<meta itemprop="dateModified" content="2021-01-04T14:52:31+01:00" />
<meta itemprop="wordCount" content="127">



<meta itemprop="keywords" content="" />
<meta property="og:title" content="Leverage Terraform, Azure Container Service and kaniko to create and use container images on Kubernetes." />
<meta property="og:description" content="In this post I demonstrate how easy it has become to build and use container images on Kubernetes (without docker) leveraging kaniko.
In order to follow along you should clone the sample code from this repository:
git clone https://github.com/timvw/sample-terraform-azure-k8s-acr-kaniko Create an Azure Container Registry with Terraform
terraform init terraform apply -auto-approve We will use the admin credentials to create a docker registry secret:
kubectl create secret docker-registry acr-secret \  --namespace default \  --docker-server=https://$(terraform output cr_server) \  --docker-username=$(terraform output cr_admin_username) \  --docker-password=$(terraform output cr_admin_password) Now we can build an image on our cluster and push it to our container registry:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/draft/building/" />
<meta property="article:modified_time" content="2021-01-04T14:52:31+01:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Leverage Terraform, Azure Container Service and kaniko to create and use container images on Kubernetes."/>
<meta name="twitter:description" content="In this post I demonstrate how easy it has become to build and use container images on Kubernetes (without docker) leveraging kaniko.
In order to follow along you should clone the sample code from this repository:
git clone https://github.com/timvw/sample-terraform-azure-k8s-acr-kaniko Create an Azure Container Registry with Terraform
terraform init terraform apply -auto-approve We will use the admin credentials to create a docker registry secret:
kubectl create secret docker-registry acr-secret \  --namespace default \  --docker-server=https://$(terraform output cr_server) \  --docker-username=$(terraform output cr_admin_username) \  --docker-password=$(terraform output cr_admin_password) Now we can build an image on our cluster and push it to our container registry:"/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="">Tim Van Wassenhove</a></h1>
	<div class="site-description"><nav class="nav social">
			<ul class="flat"><li><a href="https://twitter.com/timvw" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://github.com/timvw" title="Github"><i data-feather="github"></i></a></li><li><a href="https://www.linkedin.com/in/timvanwassenhove" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="https://timvw.be/feed.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav></div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="../../">Home</a>
			</li>
			
			<li>
				<a href="../../post">All posts</a>
			</li>
			
			<li>
				<a href="../../tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
				<div class="matter">
					<h1 class="title">Leverage Terraform, Azure Container Service and kaniko to create and use container images on Kubernetes.</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>In this post I demonstrate how easy it has become to build and use container images on Kubernetes (without docker) leveraging <a href="https://github.com/GoogleContainerTools/kaniko">kaniko</a>.</p>
<p>In order to follow along you should clone the sample code from this <a href="https://github.com/timvw/sample-terraform-azure-k8s-acr-kaniko">repository</a>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/timvw/sample-terraform-azure-k8s-acr-kaniko
</code></pre></div><p>Create an <a href="https://azure.microsoft.com/en-us/services/container-registry/">Azure Container Registry</a> with <a href="https://www.terraform.io/docs/providers/azurerm/r/container_registry.html">Terraform</a></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">terraform init
terraform apply -auto-approve
</code></pre></div><p>We will use the admin credentials to create a docker registry secret:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl create secret docker-registry acr-secret <span style="color:#d14">\
</span><span style="color:#d14"></span>  --namespace default <span style="color:#d14">\
</span><span style="color:#d14"></span>  --docker-server<span style="color:#000;font-weight:bold">=</span>https://<span style="color:#000;font-weight:bold">$(</span>terraform output cr_server<span style="color:#000;font-weight:bold">)</span> <span style="color:#d14">\
</span><span style="color:#d14"></span>  --docker-username<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">$(</span>terraform output cr_admin_username<span style="color:#000;font-weight:bold">)</span> <span style="color:#d14">\
</span><span style="color:#d14"></span>  --docker-password<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">$(</span>terraform output cr_admin_password<span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Now we can build an image on our cluster and push it to our container registry:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl apply -f build-helloworld-job.yaml
kubectl <span style="color:#0086b3">wait</span> --for<span style="color:#000;font-weight:bold">=</span><span style="color:#008080">condition</span><span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">complete</span> job/build-helloworld --timeout<span style="color:#000;font-weight:bold">=</span>300s
</code></pre></div><p>Now deploy the application we just built and verify that it&rsquo;s working:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl apply -f helloworld-deploy.yaml
curl -v https://helloworld.apps.icteam.be
</code></pre></div>
			</div>

			<div class="tags">
				
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2021  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-2585435-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
