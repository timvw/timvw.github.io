<!DOCTYPE html>
<html>
<head>
	<meta name="generator" content="Hugo 0.80.0" />
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Tim Van Wassenhove - Passionate geek, interested in Technology. Proud father of two </title><meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="alternate" type="application/rss+xml" href="https://timvw.be/feed.xml" title="Tim Van Wassenhove" />
	<meta itemprop="name" content="Tim Van Wassenhove">
<meta itemprop="description" content="">
<meta property="og:title" content="Tim Van Wassenhove" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://timvw.be/" />
<meta property="og:updated_time" content="2021-05-03T07:23:13+02:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Tim Van Wassenhove"/>
<meta name="twitter:description" content=""/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://timvw.be/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://timvw.be/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="https://timvw.be/">Tim Van Wassenhove</a></h1>
	<div class="site-description"><p>Passionate geek, interested in Technology. Proud father of two</p><nav class="nav social">
			<ul class="flat"><li><a href="https://twitter.com/timvw" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://github.com/timvw" title="Github"><i data-feather="github"></i></a></li><li><a href="https://www.linkedin.com/in/timvanwassenhove" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="https://timvw.be/feed.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="../../">Home</a>
			</li>
			
			<li>
				<a href="../../posts">All posts</a>
			</li>
			
			<li>
				<a href="../../tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="recent-posts section">
			<div class="posts">
				
				
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">05</span>
										<span class="rest">Mar 2011</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Consume custom SSIS tasks without GAC installation</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>For a while i thought that in order to consume a custom SSIS task you had to install the assembly in the GAC. Now i know better 😉</p>
<p>For the designer (BIDS) you have to copy the files to</p>
<ul>
<li>C:\Program Files\Microsoft SQL Server\100\DTS\Tasks</li>
<li>C:\Program Files\Microsoft SQL Server\100\DTS\PipelineComponents</li>
</ul>
<p>For the runtime (BIDS) you have to copy the files to</p>
<ul>
<li>C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\PrivateAssemblies</li>
</ul>
<p>And for dtexec you have to copy the files to</p>
<ul>
<li>C:\Program Files\Microsoft SQL Server\100\DTS\Binn</li>
</ul>
<p>Here is a small powershell script that gives you the paths where you want to copy your assembly to:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#998;font-style:italic"># Lookup Tasks, PipelineComponents and DtExec paths  </span>
<span style="color:#008080">$DtsPath</span> = (<span style="color:#0086b3">Get-ItemProperty</span> <span style="color:#d14">&#39;HKLM:\SOFTWARE\Microsoft\Microsoft SQL Server\100\DTS\Setup&#39;</span>).SQLPath;
<span style="color:#008080">$DtsTasksPath</span> = (<span style="color:#0086b3">Resolve-Path</span> <span style="color:#d14">&#34;$DtsPath\Tasks&#34;</span>);

<span style="color:#008080">$DtsPipelineComponentsPath</span> = (<span style="color:#0086b3">Resolve-Path</span> <span style="color:#d14">&#34;$DtsPath\Pipelinecomponents&#34;</span>);
<span style="color:#008080">$DtExecPath</span> = (<span style="color:#0086b3">Resolve-Path</span> <span style="color:#d14">&#34;$DtsPath\Binn&#34;</span>);

<span style="color:#998;font-style:italic"># Lookup VS2008/Bids path</span>
<span style="color:#008080">$Vs2008Path</span> = (<span style="color:#0086b3">Get-ItemProperty</span> <span style="color:#d14">&#39;HKLM:\Software\Microsoft\VisualStudio\9.0&#39;</span>).InstallDir;
<span style="color:#008080">$Vs2008PrivateAssembliesPath</span> = (<span style="color:#0086b3">Resolve-Path</span> <span style="color:#d14">&#34;$Vs2008Path\PrivateAssemblies&#34;</span>);
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/powershell">PowerShell</a></li>
										
										<li><a href="../../tags/ssis">SSIS</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">26</span>
										<span class="rest">Feb 2011</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Exploring messaging at lower levels...</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Yesterday a colleague of mine, <a href="http://neildoesdotnet.blogspot.com/">Neil Robbins</a>, asked me how a piece of code would look like if I apply the Hollywood principle on it (Don&rsquo;t call us, we&rsquo;ll cal you).</p>
<p>Let me start with setting the scene: The purpose of the code is to provide items via provider and to consume those items via a consumer.</p>
<p>Here is how my oldskool function signatures would look like:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ItemProviderFactory</span> {
  <span style="color:#000;font-weight:bold">public</span> ItemProvider Create() { .. } 
}

<span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ItemProvider</span> {   
  <span style="color:#000;font-weight:bold">public</span> IEnumerable&lt;Item&gt; Provide() { .. } 
}

<span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ItemConsumerFactory</span> { 
  <span style="color:#000;font-weight:bold">public</span> ItemConsumer Create() { .. }
}

<span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ItemConsumer</span> { 
  <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">void</span> Consume(IEnumerable&lt;Item&gt; items) { .. }
} 
</code></pre></div><p>My Hollywood style function signatures look like the following:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ItemProviderFactory</span> { 
  <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">void</span> WithItemProvider(Action&lt;ItemProvider&gt; action) { .. } 
}

<span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ItemProvider</span> {
  <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">void</span> Provide(Action&lt;IEnumerable&lt;Item&gt;&gt; action) { .. }
}

<span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ItemConsumerFactory</span> { 
  <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">void</span> WithItemConsumer(Action&lt;ItemConsumer&gt; action) { .. }
}

<span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ItemConsumer</span> {
  <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">void</span> Consume(IEnumerable&lt;Item&gt; items) { .. }
}
</code></pre></div><p>And now I am able compare the code that glues everything together:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">void</span> OldStyle(OldStyle.ItemProviderFactory itemProviderFactory, OldStyle.ItemConsumerFactory itemConsumerFactory) {
  <span style="color:#458;font-weight:bold">var</span> provider = itemProviderFactory.Create();
  <span style="color:#458;font-weight:bold">var</span> items = provider.Provide();
  <span style="color:#458;font-weight:bold">var</span> consumer = itemConsumerFactory.Create(); 
  consumer.Consume(items); 
}
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">  
<span style="color:#000;font-weight:bold">void</span> HollywoodStyle(HollywoodStyle.ItemProviderFactory itemProviderFactory, HollywoodStyle.ItemConsumerFactory itemConsumerFactory) {  
  itemProviderFactory.With(provider =&gt; 
    provider.Provide(items =&gt; itemConsumerFactory.With(consumer =&gt; 
      consumer.Consume(items))));
}
</code></pre></div><p>Let me refactor this Hollywood code a bit:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#998;font-style:italic">// An itemconsumer consumes items as following:
</span><span style="color:#998;font-style:italic"></span>Action&lt;HollywoodStyle.ItemConsumer, IEnumerable&lt;Item&gt;&gt; consumerAction = (consumer, items) =&gt; consumer.Consume(items);

<span style="color:#998;font-style:italic">// As soon as I have items, I want a consumer to consume them:
</span><span style="color:#998;font-style:italic"></span>Action&lt;IEnumerable&lt;Item&gt;&gt; itemsAction = (items) =&gt; itemConsumerFactory.With(consumer =&gt; consumerAction(consumer, items));

<span style="color:#998;font-style:italic">// I can get items as following:
</span><span style="color:#998;font-style:italic"></span>Action&lt;HollywoodStyle.ItemProvider&gt; providerAction = (provider) =&gt; provider.Provide(itemsAction);

<span style="color:#998;font-style:italic">// I can get an ItemProvider as following:
</span><span style="color:#998;font-style:italic"></span>itemProviderFactory.With(providerAction);
</code></pre></div><p>I think that most colleagues are quite thankful that i am not a Hollywood star 😉</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/c">C</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">24</span>
										<span class="rest">Jan 2011</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Get current file in PowerShell</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>A while ago i wrote a small script to take care of deployment. Configuring the source folders went as following:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#000;font-weight:bold">param</span>(  
  <span style="color:#008080">$BaseDir</span> = (<span style="color:#0086b3">Get-Location</span>).Path,  
  <span style="color:#008080">$WebDir</span> = (<span style="color:#0086b3">Resolve-Path</span> <span style="color:#d14">&#34;$BaseDir\web&#34;</span>),  
  <span style="color:#008080">$DatabaseDir</span> = (<span style="color:#0086b3">Resolve-Path</span> <span style="color:#d14">&#34;$BaseDir\database&#34;</span>)
)
</code></pre></div><p>The problem with this code is that it only works when your current working directory is set to the location of this script. An administrator (or build system) invokes the script as following:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#0086b3">PS </span>C:\Users\Admin&gt;&amp; <span style="color:#d14">&#39;D:\Deployments\20110124\Deploy.ps1&#39;</span>;
</code></pre></div><p>Because we don&rsquo;t want to annoy the consumer of our script with the burden of making sure he is in the correct directory we modified our code as following:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#000;font-weight:bold">param</span>(  
  <span style="color:#008080">$BaseDir</span> = (<span style="color:#0086b3">Split-Path</span> <span style="color:#008080">$MyInvocation</span>.MyCommand.Definition),  
  <span style="color:#008080">$WebDir</span> = (<span style="color:#0086b3">Resolve-Path</span> <span style="color:#d14">&#34;$BaseDir\web&#34;</span>),	  
  <span style="color:#008080">$DatabaseDir</span> = (<span style="color:#0086b3">Resolve-Path</span> <span style="color:#d14">&#34;$BaseDir\database&#34;</span>)  
)  
</code></pre></div><p>A quick win 🙂</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/powershell">PowerShell</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">24</span>
										<span class="rest">Jan 2011</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Polling the existence of a file with PowerShell</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Sometimes you run into a situations where a given task spawns a separate thread and completes it&rsquo;s work on that separate thread. Eg: sending a bit XMLA to SQL Server Analysis Services with Microsoft.AnalysisServices.Deployment.exe and then waiting for the processing to be completed. Anyway, here is a simple function that will wait untill a given file exists:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#000;font-weight:bold">function</span> WaitForFile(<span style="color:#008080">$File</span>) {
  <span style="color:#000;font-weight:bold">while</span>(!(<span style="color:#0086b3">Test-Path</span> <span style="color:#008080">$File</span>)) {    
    <span style="color:#0086b3">Start-Sleep</span> -s 10;   
  }  
}  
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/powershell">PowerShell</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">06</span>
										<span class="rest">Jan 2011</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Get entire message body from an Intent</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>I recently started programming the <a href="http://www.android.com/">Android</a> and noticed that most examples for processing an incoming SMS are not entirely correct.</p>
<p>An SMS message is <a href="http://en.wikipedia.org/wiki/SMS#Message_size">limited</a> to 160 characters. Current mobile phones break up a larger message in multiple messages transparently for the user. When Android notifies you about an incoming SMS it has all parts (of that large message) available. So here is how you reconstruct the entire message body from an Intent</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Bundle bundle <span style="color:#000;font-weight:bold">=</span> intent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getExtras</span><span style="color:#000;font-weight:bold">();</span>
<span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>bundle <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>

StringBuilder message <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> StringBuilder<span style="color:#000;font-weight:bold">();</span>  
Object<span style="color:#000;font-weight:bold">[]</span> pdus <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>Object<span style="color:#000;font-weight:bold">[])</span> bundle<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;pdus&#34;</span><span style="color:#000;font-weight:bold">);</span>

<span style="color:#998;font-style:italic">// Rebuild this entire message from the multi part smses/pdus  
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>Object pdu <span style="color:#000;font-weight:bold">:</span> pdus<span style="color:#000;font-weight:bold">){</span>
  <span style="color:#998;font-style:italic">// Notice that i use the deprecated android.telephony.gsm.SmsMessage
</span><span style="color:#998;font-style:italic"></span>  <span style="color:#998;font-style:italic">// android.telephony.SmsMessage throws when i call createFromPdu
</span><span style="color:#998;font-style:italic"></span>  SmsMessage msg <span style="color:#000;font-weight:bold">=</span> SmsMessage<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createFromPdu</span><span style="color:#000;font-weight:bold">((</span><span style="color:#458;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">[])</span>pdu<span style="color:#000;font-weight:bold">);</span>
  message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">append</span><span style="color:#000;font-weight:bold">(</span>msg<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMessageBody</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">toString</span><span style="color:#000;font-weight:bold">());</span>  
<span style="color:#000;font-weight:bold">}</span>  
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/android">Android</a></li>
										
										<li><a href="../../tags/java">Java</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">11</span>
										<span class="rest">Dec 2010</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Techniques learned in SQLtopia: Look Ma, no loops!</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>I have been programming in c-based languages for more than 10 years now. Lately i have spent quite a bit of time in SQLtopia and learned a couple of techniques that are quite different from what i was used to.</p>
<p>Let me explain with an example: The boss comes in and asks for a report that contains all the days on which i have worked this year. As a typical c# programmer i come up with the following solution: Iterate over all the days in the year and skip the days i was out on holidays:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">IEnumerable&lt;DateTime&gt; FindWorkingDays()
{
  <span style="color:#458;font-weight:bold">var</span> begin = <span style="color:#000;font-weight:bold">new</span> DateTime(<span style="color:#099">2010</span>, <span style="color:#099">01</span>, <span style="color:#099">01</span>);
  <span style="color:#458;font-weight:bold">var</span> end = <span style="color:#000;font-weight:bold">new</span> DateTime(<span style="color:#099">2010</span>, <span style="color:#099">12</span>, <span style="color:#099">31</span>);

  <span style="color:#458;font-weight:bold">var</span> holidays = <span style="color:#000;font-weight:bold">new</span>[]   
  {    
    <span style="color:#000;font-weight:bold">new</span> Holiday { Begin = <span style="color:#000;font-weight:bold">new</span> DateTime(<span style="color:#099">2010</span>, <span style="color:#099">07</span>, <span style="color:#099">01</span>), End = <span style="color:#000;font-weight:bold">new</span> DateTime(<span style="color:#099">2010</span>, <span style="color:#099">07</span>, <span style="color:#099">31</span>) },    
    <span style="color:#000;font-weight:bold">new</span> Holiday { Begin = <span style="color:#000;font-weight:bold">new</span> DateTime(<span style="color:#099">2010</span>, <span style="color:#099">09</span>, <span style="color:#099">01</span>), End = <span style="color:#000;font-weight:bold">new</span> DateTime(<span style="color:#099">2010</span>, <span style="color:#099">09</span>, <span style="color:#099">15</span>) }   
  };

  <span style="color:#000;font-weight:bold">for</span> (<span style="color:#458;font-weight:bold">var</span> date = begin; date &lt;= end; date = date.AddDays(<span style="color:#099">1</span>))   
  {    
    <span style="color:#000;font-weight:bold">if</span>(holidays.Any(holiday =&gt; holiday.Begin &lt;= date &amp;&amp; date &lt;= holiday.End)) <span style="color:#000;font-weight:bold">continue</span>;    
    <span style="color:#000;font-weight:bold">yield</span> <span style="color:#000;font-weight:bold">return</span> date;   
  }  
}  
</code></pre></div><p>In SQLtopia it is recommended to use set-based solutions instead of loops so we need a radically different solution.</p>
<p>Here is how we generate rows:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">WITH</span>    
  [Nums1] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">AS</span> [Value] <span style="color:#000;font-weight:bold">UNION</span> <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">AS</span> [Value] )  
, [Nums2] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums1] <span style="color:#000;font-weight:bold">AS</span> A, [Nums1] <span style="color:#000;font-weight:bold">AS</span> B, [Nums1] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">C</span>)  
, [Nums3] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums2] <span style="color:#000;font-weight:bold">AS</span> A, [Nums2] <span style="color:#000;font-weight:bold">AS</span> B, [Nums2] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">C</span>)  
, [Nums4] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums3] <span style="color:#000;font-weight:bold">AS</span> A, [Nums3] <span style="color:#000;font-weight:bold">AS</span> B )
<span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums4];
</code></pre></div><p>With rows we can generate numbers:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">DECLARE</span> <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">count</span> <span style="color:#0086b3">INT</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1000</span>;

<span style="color:#000;font-weight:bold">WITH</span>    
  [Nums1] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">AS</span> [Value] <span style="color:#000;font-weight:bold">UNION</span> <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">AS</span> [Value] )  
, [Nums2] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums1] <span style="color:#000;font-weight:bold">AS</span> A, [Nums1] <span style="color:#000;font-weight:bold">AS</span> B, [Nums1] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">C</span>)
, [Nums3] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums2] <span style="color:#000;font-weight:bold">AS</span> A, [Nums2] <span style="color:#000;font-weight:bold">AS</span> B, [Nums2] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">C</span>)
, [Nums4] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums3] <span style="color:#000;font-weight:bold">AS</span> A, [Nums3] <span style="color:#000;font-weight:bold">AS</span> B )
, [Numbers] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> TOP(<span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">count</span>) <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span> <span style="color:#000;font-weight:bold">+</span> ROW_NUMBER() OVER(<span style="color:#000;font-weight:bold">ORDER</span> <span style="color:#000;font-weight:bold">BY</span> [Value]) <span style="color:#000;font-weight:bold">AS</span> [Value] <span style="color:#000;font-weight:bold">FROM</span>[Nums4] )
<span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Numbers];
</code></pre></div><p>And with numbers we can generate dates:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">DECLARE</span> <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">begin</span> DATETIME <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;2010-01-01&#39;</span>;
<span style="color:#000;font-weight:bold">DECLARE</span> <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">end</span> DATETIME <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;2010-12-31&#39;</span>;
<span style="color:#000;font-weight:bold">DECLARE</span> <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">count</span> <span style="color:#0086b3">INT</span> <span style="color:#000;font-weight:bold">=</span> DATEDIFF(<span style="color:#000;font-weight:bold">DAY</span>, <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">begin</span>, <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">end</span>) <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>;

<span style="color:#000;font-weight:bold">WITH</span>    
  [Nums1] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">AS</span> [Value] <span style="color:#000;font-weight:bold">UNION</span> <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">AS</span> [Value] )
, [Nums2] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums1] <span style="color:#000;font-weight:bold">AS</span> A, [Nums1] <span style="color:#000;font-weight:bold">AS</span> B, [Nums1] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">C</span>)  
, [Nums3] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums2] <span style="color:#000;font-weight:bold">AS</span> A, [Nums2] <span style="color:#000;font-weight:bold">AS</span> B, [Nums2] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">C</span>)  
, [Nums4] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums3] <span style="color:#000;font-weight:bold">AS</span> A, [Nums3] <span style="color:#000;font-weight:bold">AS</span> B )  
, [Numbers] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> TOP(<span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">count</span>) <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span> <span style="color:#000;font-weight:bold">+</span> ROW_NUMBER() OVER(<span style="color:#000;font-weight:bold">ORDER</span> <span style="color:#000;font-weight:bold">BY</span> [Value]) <span style="color:#000;font-weight:bold">AS</span> [Value] <span style="color:#000;font-weight:bold">FROM</span>[Nums4] )  
, [Dates] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> DATEADD(<span style="color:#000;font-weight:bold">DAY</span>, [Value], <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">begin</span>) <span style="color:#000;font-weight:bold">AS</span> [<span style="color:#0086b3">Date</span>] <span style="color:#000;font-weight:bold">FROM</span> [Numbers] )
<span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Dates];
</code></pre></div><p>With dates we can build the dates on which we were out on holidays:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">
<span style="color:#000;font-weight:bold">DECLARE</span> <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">begin</span> DATETIME <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;2010-01-01&#39;</span>;
<span style="color:#000;font-weight:bold">DECLARE</span> <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">end</span> DATETIME <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;2010-12-31&#39;</span>;
<span style="color:#000;font-weight:bold">DECLARE</span> <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">count</span> <span style="color:#0086b3">INT</span> <span style="color:#000;font-weight:bold">=</span> DATEDIFF(<span style="color:#000;font-weight:bold">DAY</span>, <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">begin</span>, <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">end</span>) <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>;

<span style="color:#000;font-weight:bold">WITH</span>    
  [Nums1] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">AS</span> [Value] <span style="color:#000;font-weight:bold">UNION</span> <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">AS</span> [Value] )  
, [Nums2] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums1] <span style="color:#000;font-weight:bold">AS</span> A, [Nums1] <span style="color:#000;font-weight:bold">AS</span> B, [Nums1] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">C</span>)
, [Nums3] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums2] <span style="color:#000;font-weight:bold">AS</span> A, [Nums2] <span style="color:#000;font-weight:bold">AS</span> B, [Nums2] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">C</span>)    
, [Nums4] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums3] <span style="color:#000;font-weight:bold">AS</span> A, [Nums3] <span style="color:#000;font-weight:bold">AS</span> B )    
, [Numbers] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> TOP(<span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">count</span>) <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span> <span style="color:#000;font-weight:bold">+</span> ROW_NUMBER() OVER(<span style="color:#000;font-weight:bold">ORDER</span> <span style="color:#000;font-weight:bold">BY</span> [Value]) <span style="color:#000;font-weight:bold">AS</span> [Value] <span style="color:#000;font-weight:bold">FROM</span>[Nums4] )    
, [Dates] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> DATEADD(<span style="color:#000;font-weight:bold">DAY</span>, [Value], <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">begin</span>) <span style="color:#000;font-weight:bold">AS</span> [<span style="color:#0086b3">Date</span>] <span style="color:#000;font-weight:bold">FROM</span> [Numbers] )    
, [Holidays] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#d14">&#39;2010-07-01&#39;</span> <span style="color:#000;font-weight:bold">AS</span> [<span style="color:#000;font-weight:bold">Begin</span>], <span style="color:#d14">&#39;2010-07-31&#39;</span> <span style="color:#000;font-weight:bold">AS</span> [<span style="color:#000;font-weight:bold">End</span>]                      
<span style="color:#000;font-weight:bold">UNION</span>                    
  <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#d14">&#39;2010-09-01&#39;</span> <span style="color:#000;font-weight:bold">AS</span> [<span style="color:#000;font-weight:bold">Begin</span>], <span style="color:#d14">&#39;2010-09-15&#39;</span> <span style="color:#000;font-weight:bold">AS</span> [<span style="color:#000;font-weight:bold">End</span>]                  
)
<span style="color:#000;font-weight:bold">SELECT</span> [<span style="color:#0086b3">Date</span>] <span style="color:#000;font-weight:bold">FROM</span> [Holidays],[Dates] <span style="color:#000;font-weight:bold">WHERE</span> [<span style="color:#0086b3">Date</span>] <span style="color:#000;font-weight:bold">BETWEEN</span> [<span style="color:#000;font-weight:bold">Begin</span>] <span style="color:#000;font-weight:bold">AND</span> [<span style="color:#000;font-weight:bold">End</span>] <span style="color:#000;font-weight:bold">ORDER</span> <span style="color:#000;font-weight:bold">BY</span> [<span style="color:#0086b3">Date</span>];  
</code></pre></div><p>And now we can easily select the dates that are not holiday dates:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">DECLARE</span> <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">begin</span> DATETIME <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;2010-01-01&#39;</span>;
<span style="color:#000;font-weight:bold">DECLARE</span> <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">end</span> DATETIME <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;2010-12-31&#39;</span>;
<span style="color:#000;font-weight:bold">DECLARE</span> <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">count</span> <span style="color:#0086b3">INT</span> <span style="color:#000;font-weight:bold">=</span> DATEDIFF(<span style="color:#000;font-weight:bold">DAY</span>, <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">begin</span>, <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">end</span>) <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>;

<span style="color:#000;font-weight:bold">WITH</span>  
  [Nums1] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">AS</span> [Value] <span style="color:#000;font-weight:bold">UNION</span> <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">AS</span> [Value] )    
, [Nums2] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums1] <span style="color:#000;font-weight:bold">AS</span> A, [Nums1] <span style="color:#000;font-weight:bold">AS</span> B, [Nums1] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">C</span>)  
, [Nums3] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums2] <span style="color:#000;font-weight:bold">AS</span> A, [Nums2] <span style="color:#000;font-weight:bold">AS</span> B, [Nums2] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">C</span>)    
, [Nums4] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums3] <span style="color:#000;font-weight:bold">AS</span> A, [Nums3] <span style="color:#000;font-weight:bold">AS</span> B )    
, [Numbers] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> TOP(<span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">count</span>) <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span> <span style="color:#000;font-weight:bold">+</span> ROW_NUMBER() OVER(<span style="color:#000;font-weight:bold">ORDER</span> <span style="color:#000;font-weight:bold">BY</span> [Value]) <span style="color:#000;font-weight:bold">AS</span> [Value] <span style="color:#000;font-weight:bold">FROM</span>[Nums4] )    
, [Dates] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> DATEADD(<span style="color:#000;font-weight:bold">DAY</span>, [Value], <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">begin</span>) <span style="color:#000;font-weight:bold">AS</span> [<span style="color:#0086b3">Date</span>] <span style="color:#000;font-weight:bold">FROM</span> [Numbers] <span style="color:#000;font-weight:bold">WHERE</span> [Value] <span style="color:#000;font-weight:bold">&lt;=</span> DATEDIFF(<span style="color:#000;font-weight:bold">DAY</span>, <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">begin</span>, <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">end</span>))    
, [Holidays] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#d14">&#39;2010-07-01&#39;</span> <span style="color:#000;font-weight:bold">AS</span> [<span style="color:#000;font-weight:bold">Begin</span>], <span style="color:#d14">&#39;2010-07-31&#39;</span> <span style="color:#000;font-weight:bold">AS</span> [<span style="color:#000;font-weight:bold">End</span>]                      
<span style="color:#000;font-weight:bold">UNION</span>                      
  <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#d14">&#39;2010-09-01&#39;</span> <span style="color:#000;font-weight:bold">AS</span> [<span style="color:#000;font-weight:bold">Begin</span>], <span style="color:#d14">&#39;2010-09-15&#39;</span> <span style="color:#000;font-weight:bold">AS</span> [<span style="color:#000;font-weight:bold">End</span>]                  
)
, [HolidayDates] <span style="color:#000;font-weight:bold">AS</span> (<span style="color:#000;font-weight:bold">SELECT</span> [<span style="color:#0086b3">Date</span>] <span style="color:#000;font-weight:bold">FROM</span> [Holidays],[Dates] <span style="color:#000;font-weight:bold">WHERE</span> [<span style="color:#0086b3">Date</span>] <span style="color:#000;font-weight:bold">BETWEEN</span> [<span style="color:#000;font-weight:bold">Begin</span>] <span style="color:#000;font-weight:bold">AND</span> [<span style="color:#000;font-weight:bold">End</span>] )
<span style="color:#000;font-weight:bold">SELECT</span> [Dates].[<span style="color:#0086b3">Date</span>] <span style="color:#000;font-weight:bold">FROM</span> [Dates]					  
<span style="color:#000;font-weight:bold">LEFT</span> <span style="color:#000;font-weight:bold">OUTER</span> <span style="color:#000;font-weight:bold">JOIN</span> [HolidayDates] <span style="color:#000;font-weight:bold">ON</span> [Dates].[<span style="color:#0086b3">Date</span>] <span style="color:#000;font-weight:bold">=</span> [HolidayDates].[<span style="color:#0086b3">Date</span>]				    
<span style="color:#000;font-weight:bold">WHERE</span> [HolidayDates].[<span style="color:#0086b3">Date</span>] <span style="color:#000;font-weight:bold">IS</span> <span style="color:#000;font-weight:bold">NULL</span>;
</code></pre></div><p>Look Ma, no loops!</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/sql">SQL</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">10</span>
										<span class="rest">Dec 2010</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Exploring window functions</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Here is a sample query that allows you to explore the behavior of various <a href="http://msdn.microsoft.com/en-us/library/ms189461.aspx">aggregate window functions</a>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">WITH</span>    
  [Nums1] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">AS</span> [Value] <span style="color:#000;font-weight:bold">UNION</span> <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">AS</span> [Value] )  
, [Nums2] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums1] <span style="color:#000;font-weight:bold">AS</span> A, [Nums1] <span style="color:#000;font-weight:bold">AS</span> B, [Nums1] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">C</span>)  
, [Nums3] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums2] <span style="color:#000;font-weight:bold">AS</span> A, [Nums2] <span style="color:#000;font-weight:bold">AS</span> B, [Nums2] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">C</span>)
, [Nums4] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums3] <span style="color:#000;font-weight:bold">AS</span> A, [Nums3] <span style="color:#000;font-weight:bold">AS</span> B )
<span style="color:#998;font-style:italic">-- Build numbers from 1 to 1000
</span><span style="color:#998;font-style:italic"></span>, [Numbers] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> TOP(<span style="color:#099">1000</span>) ROW_NUMBER() OVER(<span style="color:#000;font-weight:bold">ORDER</span> <span style="color:#000;font-weight:bold">BY</span> [Value]) <span style="color:#000;font-weight:bold">AS</span> [Value] <span style="color:#000;font-weight:bold">FROM</span>[Nums4] )

<span style="color:#000;font-weight:bold">SELECT</span>    
  [Value]  
, ROW_NUMBER() OVER(PARTITION <span style="color:#000;font-weight:bold">BY</span> [Value] <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">100</span> <span style="color:#000;font-weight:bold">ORDER</span> <span style="color:#000;font-weight:bold">BY</span> [Value] <span style="color:#000;font-weight:bold">%</span> <span style="color:#099">10</span>) <span style="color:#000;font-weight:bold">AS</span> [RowNumber]
, RANK() OVER(PARTITION <span style="color:#000;font-weight:bold">BY</span> [Value] <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">100</span> <span style="color:#000;font-weight:bold">ORDER</span> <span style="color:#000;font-weight:bold">BY</span> [Value] <span style="color:#000;font-weight:bold">%</span> <span style="color:#099">10</span>) <span style="color:#000;font-weight:bold">AS</span> [Rank]
, DENSE_RANK() OVER (PARTITION <span style="color:#000;font-weight:bold">BY</span> [Value] <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">100</span> <span style="color:#000;font-weight:bold">ORDER</span> <span style="color:#000;font-weight:bold">BY</span> [Value] <span style="color:#000;font-weight:bold">%</span> <span style="color:#099">10</span>) <span style="color:#000;font-weight:bold">AS</span> [DenseRank]    
, NTILE(<span style="color:#099">4</span>) OVER (PARTITION <span style="color:#000;font-weight:bold">BY</span> [Value] <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">100</span> <span style="color:#000;font-weight:bold">ORDER</span> <span style="color:#000;font-weight:bold">BY</span> [Value] <span style="color:#000;font-weight:bold">%</span> <span style="color:#099">10</span>) <span style="color:#000;font-weight:bold">AS</span> [Tile100]  
<span style="color:#000;font-weight:bold">FROM</span>    
  [Numbers]
<span style="color:#000;font-weight:bold">ORDER</span> <span style="color:#000;font-weight:bold">BY</span>    
  [Value];
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/sql">SQL</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">20</span>
										<span class="rest">Nov 2010</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Convert AAC/M4A files to MP3 with VLC and PowerShell</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Here is a way to convert your AAC/M4A files to MP3 using <a href="http://www.videolan.org/vlc">VLC</a> media player:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">vlc.exe -I dummy old.m4a :sout=#transcode{acodec=$codec,vcodec=dummy}:standard{access=file,mux=raw,dst=new.mp3} vlc://quit
</code></pre></div><p>Let&rsquo;s wrap this command in a bit of PowerShell:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#000;font-weight:bold">function</span> ConvertToMp3(<span style="color:#008080">[switch]</span> <span style="color:#008080">$inputObject</span>, <span style="color:#008080">[string]</span> <span style="color:#008080">$vlc</span> = <span style="color:#d14">&#39;C:\Program Files\VideoLAN\VLC\vlc.exe&#39;</span>) {      
  <span style="color:#000;font-weight:bold">PROCESS</span> {            
    <span style="color:#008080">$codec</span> = <span style="color:#d14">&#39;mp3&#39;</span>;        
    <span style="color:#008080">$oldFile</span> = <span style="color:#008080">$_</span>;

    <span style="color:#008080">$newFile</span> = <span style="color:#008080">$oldFile</span>.FullName.Replace(<span style="color:#008080">$oldFile</span>.Extension, <span style="color:#d14">&#34;.$codec&#34;</span>);

    &amp;<span style="color:#d14">&#34;$vlc&#34;</span> -I dummy <span style="color:#d14">&#34;$oldFile&#34;</span> <span style="color:#d14">&#34;:sout=#transcode{acodec=$codec,vcodec=dummy}:standard{access=file,mux=raw,dst=\</span><span style="color:#d14">`&#39;</span><span style="color:#d14">$newFile\</span><span style="color:#d14">`&#39;</span><span style="color:#d14">}&#34;</span> vlc<span style="color:#a61717;background-color:#e3d2d2">:</span>//quit | <span style="color:#0086b3">out-null</span>;

    <span style="color:#998;font-style:italic">#Only remove source files when you are sure that the conversion works as you want          </span>
    <span style="color:#998;font-style:italic">#Remove-Item $oldFile;</span>
  }  
}
</code></pre></div><p>And now we can use this function for *all* m4a files in a given folder:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#000;font-weight:bold">function</span> ConvertAllToMp3(<span style="color:#008080">[string]</span> <span style="color:#008080">$sourcePath</span>) {
  <span style="color:#0086b3">Get-ChildItem</span> <span style="color:#d14">&#34;$sourcePath\*&#34;</span> -recurse -include *.m4a | ConvertToMp3;
}
</code></pre></div><p>Using the function is as easy as:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">ConvertAllToMp3 <span style="color:#d14">&#39;C:\Users\timvw\Music&#39;</span>;
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/aac">AAC</a></li>
										
										<li><a href="../../tags/m4a">M4A</a></li>
										
										<li><a href="../../tags/mp3">MP3</a></li>
										
										<li><a href="../../tags/powershell">PowerShell</a></li>
										
										<li><a href="../../tags/vlc">VLC</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">17</span>
										<span class="rest">Nov 2010</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Configure Visual Studio 2010 environment in PowerShell</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Instead of using the &ldquo;Visual Studo Command Prompt (2010)&rdquo; i wanted to use PowerShell instead. I found <a href="http://blogs.msdn.com/b/ploeh/archive/2008/04/09/visualstudio2008powershell.aspx">this</a> post which does it for VS2008. Extending it for VS2010 was pretty easy:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#000;font-weight:bold">function</span> SetVS2008()
{
	<span style="color:#008080">$vs90comntools</span> = (<span style="color:#0086b3">Get-ChildItem</span> env<span style="color:#a61717;background-color:#e3d2d2">:</span>VS90COMNTOOLS).Value
	<span style="color:#008080">$batchFile</span> = <span style="color:#008080">[System.IO.Path]</span>::Combine(<span style="color:#008080">$vs90comntools</span>, <span style="color:#d14">&#34;vsvars32.bat&#34;</span>)
	<span style="color:#0086b3">Get-Batchfile</span> <span style="color:#008080">$BatchFile</span>
	<span style="color:#008080">[System.Console]</span>::Title = <span style="color:#d14">&#34;Visual Studio 2008 Windows PowerShell&#34;</span>
}

<span style="color:#000;font-weight:bold">function</span> SetVS2010()
{
	<span style="color:#008080">$vs100comntools</span> = (<span style="color:#0086b3">Get-ChildItem</span> env<span style="color:#a61717;background-color:#e3d2d2">:</span>VS100COMNTOOLS).Value
	<span style="color:#008080">$batchFile</span> = <span style="color:#008080">[System.IO.Path]</span>::Combine(<span style="color:#008080">$vs100comntools</span>, <span style="color:#d14">&#34;vsvars32.bat&#34;</span>)
	<span style="color:#0086b3">Get-Batchfile</span> <span style="color:#008080">$BatchFile</span>
	<span style="color:#008080">[System.Console]</span>::Title = <span style="color:#d14">&#34;Visual Studio 2010 Windows PowerShell&#34;</span>
}

<span style="color:#000;font-weight:bold">function</span> <span style="color:#0086b3">Get-Batchfile</span>(<span style="color:#008080">$file</span>)
{
	<span style="color:#008080">$cmd</span> = <span style="color:#d14">&#34;\</span><span style="color:#d14">`&#34;</span><span style="color:#d14">$file\</span><span style="color:#d14">`&#34;</span><span style="color:#d14"> &amp; set&#34;</span>
	cmd /c <span style="color:#008080">$cmd</span> | <span style="color:#000;font-weight:bold">Foreach</span>-Object {
		<span style="color:#008080">$p</span>, <span style="color:#008080">$v</span> = <span style="color:#008080">$_</span>.split(<span style="color:#d14">&#39;=&#39;</span>)
		<span style="color:#0086b3">Set-Item</span> -path env<span style="color:#a61717;background-color:#e3d2d2">:</span><span style="color:#008080">$p</span> -value <span style="color:#008080">$v</span>
	}
}
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/powershell">PowerShell</a></li>
										
										<li><a href="../../tags/visual-studio">Visual Studio</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">17</span>
										<span class="rest">Nov 2010</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Load all script files at PowerShell startup</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>These days i have quite some scripts files that i want to be loaded each time i launch PowerShell. <a href="http://msdn.microsoft.com/en-us/library/bb613488%28VS.85%29.aspx">Windows PowerShell Profiles</a> teaches me where i should store my $profile. Here is what it looks like:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#998;font-style:italic"># Lookup powershell scripts location</span>
<span style="color:#008080">$UserProfile</span> = (<span style="color:#0086b3">Get-ChildItem</span> Env<span style="color:#a61717;background-color:#e3d2d2">:</span>UserProfile).Value;
<span style="color:#008080">$ScriptFolder</span> = <span style="color:#d14">&#34;$UserProfile\My documents\WindowsPowerShell&#34;</span>;

<span style="color:#998;font-style:italic"># Source all .ps1 files in PowerShell profile folder  </span>
<span style="color:#0086b3">Get-ChildItem</span> <span style="color:#008080">$ScriptFolder</span> -name -include <span style="color:#d14">&#39;*.ps1&#39;</span> -exclude <span style="color:#d14">&#39;profile.ps1&#39;</span>   
| <span style="color:#000;font-weight:bold">foreach</span> { (. <span style="color:#d14">&#34;$ScriptFolder\$_&#34;</span>) };

<span style="color:#998;font-style:italic"># Configure environment for VS2010  </span>
SetVS2010;
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/powershell">PowerShell</a></li>
										
									</ul>
								
							
						</div></div>
				
				

<ul class="pagination">
	<li class="page-item page-prev">
	
    <a href="../../page/5/" class="page-link" aria-label="Previous"><span aria-hidden="true">← Prev page</span></a>
	
	</li>
	<li class="page-item page-next">
	
    <a href="../../page/7/" class="page-link" aria-label="Next"><span aria-hidden="true">Next page →</span></a>
	
	</li>
</ul>


			</div>
		</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2021  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-2585435-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
