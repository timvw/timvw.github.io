<!DOCTYPE html>
<html>
<head>
	<meta name="generator" content="Hugo 0.92.2" />
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Tim Van Wassenhove - Passionate geek, interested in Technology. Proud father of two </title><meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="alternate" type="application/rss+xml" href="https://timvw.be/feed.xml" title="Tim Van Wassenhove" />
	<meta itemprop="name" content="Tim Van Wassenhove">
<meta itemprop="description" content=""><meta property="og:title" content="Tim Van Wassenhove" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://timvw.be/" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Tim Van Wassenhove"/>
<meta name="twitter:description" content=""/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://timvw.be/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://timvw.be/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="https://timvw.be/">Tim Van Wassenhove</a></h1>
	<div class="site-description"><p>Passionate geek, interested in Technology. Proud father of two</p><nav class="nav social">
			<ul class="flat"><li><a href="https://twitter.com/timvw" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://github.com/timvw" title="Github"><i data-feather="github"></i></a></li><li><a href="https://www.linkedin.com/in/timvanwassenhove" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="https://timvw.be/feed.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="../../">Home</a>
			</li>
			
			<li>
				<a href="../../posts">All posts</a>
			</li>
			
			<li>
				<a href="../../tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="recent-posts section">
			<div class="posts">
				
				
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">29</span>
										<span class="rest">Oct 2009</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Party for one</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Inspired by Jimmy Bogard&rsquo;s <a href="http://www.lostechies.com/blogs/jimmy_bogard/archive/2009/10/15/more-missing-linq-operators.aspx">More missing LINQ operators</a> i found another one</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> IEnumerable&lt;T&gt; MakeEnumerable&lt;T&gt;(<span style="color:#000;font-weight:bold">this</span> T element)
{
	<span style="color:#000;font-weight:bold">yield</span> <span style="color:#000;font-weight:bold">return</span> element;
}
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">29</span>
										<span class="rest">Oct 2009</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Presenting PathBuilder</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Currently it is annoying to build a path with <a href="http://msdn.microsoft.com/en-us/library/fyy7a5kt.aspx">Path.Combine</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#458;font-weight:bold">var</span> home1 = Path.Combine(Path.Combine(Path.Combine(<span style="color:#d14">&#34;C&#34;</span>, <span style="color:#d14">&#34;Users&#34;</span>), <span style="color:#d14">&#34;timvw&#34;</span>), <span style="color:#d14">&#34;My Documents&#34;</span>);
</code></pre></div><p>And here is how it can be:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#458;font-weight:bold">var</span> home2 = PathBuilder.Combine(<span style="color:#d14">&#34;C&#34;</span>, <span style="color:#d14">&#34;Users&#34;</span>, <span style="color:#d14">&#34;timvw&#34;</span>, <span style="color:#d14">&#34;My Documents&#34;</span>);
</code></pre></div><p>The implementation is pretty simple:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PathBuilder</span>
{
	<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">string</span> Combine(<span style="color:#000;font-weight:bold">params</span> <span style="color:#458;font-weight:bold">string</span>[] parts)
	{
		<span style="color:#000;font-weight:bold">return</span> parts.Aggregate((l, r) =&gt; Path.Combine(l, r));
	}
}
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">19</span>
										<span class="rest">Oct 2009</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Separation of concerns: Behavior = Trigger &#43; TriggerAction</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>If you look at my <a href="http://www.timvw.be/true-keybehavior-with-system-windows-interactivity-behavior/">KeyBehavior</a> you notice that it is doing two things: register for events so that the behavior can be triggered and handle the actual command invocation. In order to enhance reuse we can refactor this KeyBehavior in a KeyTrigger and an InvokeCommandAction. Well, we&rsquo;re not going to do that, because they exist already in the silverlight sdk.</p>
<p>A shortcoming of the InvokeCommandAction is that it can only invoke commands on the FrameworkElement itself, thus we write a custom implementation that finds commands on the DataContext instead</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">InvokeCommandAction</span> : TriggerAction&lt;frameworkElement&gt;
{
	<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">string</span> CommandName { <span style="color:#000;font-weight:bold">get</span>; <span style="color:#000;font-weight:bold">set</span>; }

	<span style="color:#000;font-weight:bold">protected</span> <span style="color:#000;font-weight:bold">override</span> <span style="color:#000;font-weight:bold">void</span> Invoke(<span style="color:#458;font-weight:bold">object</span> parameter)
	{
		<span style="color:#458;font-weight:bold">var</span> viewModel = AssociatedObject.DataContext;
		GetCommandAndExecuteIt(viewModel, CommandName);
	}

	<span style="color:#000;font-weight:bold">void</span> GetCommandAndExecuteIt(<span style="color:#458;font-weight:bold">object</span> viewModel, <span style="color:#458;font-weight:bold">string</span> commandName)
	{
		<span style="color:#458;font-weight:bold">var</span> command = viewModel.GetPropertyValue&lt;icommand&gt;(commandName);
		<span style="color:#000;font-weight:bold">if</span>(command.CanExecute(<span style="color:#000;font-weight:bold">null</span>)) command.Execute(<span style="color:#000;font-weight:bold">null</span>);
	}
}
</code></pre></div><p>And now we can drag this action on our design surface in Blend and select a trigger that goes with it</p>
<p><img src="http://www.timvw.be/wp-content/images/InvokeCommandAction_ChooseTrigger.png" alt="choosing a keypress trigger in blend"></p>
<p>All we have to do is choose the Key and Command to invoke</p>
<p><img src="http://www.timvw.be/wp-content/images/InvokeCommandAction_SetProperties.png" alt="setting properties for action in blend"></p>
<p>In XAML this looks like</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000080">&lt;interactivity:Interaction.Triggers&gt;</span>
	<span style="color:#000080">&lt;ii:KeyTrigger</span> <span style="color:#008080">Key=</span><span style="color:#d14">&#34;Right&#34;</span><span style="color:#000080">&gt;</span>
		<span style="color:#000080">&lt;inf:InvokeCommandAction</span> <span style="color:#008080">CommandName=</span><span style="color:#d14">&#34;PlayerRight&#34;</span><span style="color:#000080">/&gt;</span>
	<span style="color:#000080">&lt;/ii:KeyTrigger&gt;</span>
	<span style="color:#000080">&lt;ii:KeyTrigger</span> <span style="color:#008080">Key=</span><span style="color:#d14">&#34;Left&#34;</span><span style="color:#000080">&gt;</span>
		<span style="color:#000080">&lt;inf:InvokeCommandAction</span> <span style="color:#008080">CommandName=</span><span style="color:#d14">&#34;PlayerLeft&#34;</span><span style="color:#000080">/&gt;</span>
	<span style="color:#000080">&lt;/ii:KeyTrigger&gt;</span>
	<span style="color:#000080">&lt;ii:KeyTrigger</span> <span style="color:#008080">Key=</span><span style="color:#d14">&#34;Up&#34;</span><span style="color:#000080">&gt;</span>
		<span style="color:#000080">&lt;inf:InvokeCommandAction</span> <span style="color:#008080">CommandName=</span><span style="color:#d14">&#34;PlayerUp&#34;</span><span style="color:#000080">/&gt;</span>
	<span style="color:#000080">&lt;/ii:KeyTrigger&gt;</span>
	<span style="color:#000080">&lt;ii:KeyTrigger</span> <span style="color:#008080">Key=</span><span style="color:#d14">&#34;Down&#34;</span><span style="color:#000080">&gt;</span>
		<span style="color:#000080">&lt;inf:InvokeCommandAction</span> <span style="color:#008080">CommandName=</span><span style="color:#d14">&#34;PlayerDown&#34;</span><span style="color:#000080">/&gt;</span>
	<span style="color:#000080">&lt;/ii:KeyTrigger&gt;</span>
<span style="color:#000080">&lt;/interactivity:Interaction.Triggers&gt;</span>
</code></pre></div><p>I guess this ends our exploration of the behavior features in Silverlight.</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
										<li><a href="../../tags/silverlight">Silverlight</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">19</span>
										<span class="rest">Oct 2009</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">True KeyBehavior with System.Windows.Interactivity.Behavior</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Yesterday i demonstrated how attached properties can be used to invoke commands on specific key presses (and releases). With the aid of System.Windows.Interactivity.Behavior we can implement a true behavior and we get an extension point to do the required cleanup.</p>
<p><img src="http://www.timvw.be/wp-content/images/BlendKeyBehavior.png" alt="screenshot of Blend managing a KeyBehavior"></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000080">&lt;grid&gt;</span>
	<span style="color:#000080">&lt;interactivity:Interaction.Behaviors&gt;</span>
		<span style="color:#000080">&lt;inf:KeyBehavior&gt;</span>
			<span style="color:#000080">&lt;inf:KeyBehavior.DownKeyCommands&gt;</span>
				<span style="color:#000080">&lt;inf:KeyCommandName</span> <span style="color:#008080">Key=</span><span style="color:#d14">&#34;Right&#34;</span> <span style="color:#008080">CommandName=</span><span style="color:#d14">&#34;PlayerRight&#34;</span> <span style="color:#000080">/&gt;</span>
				<span style="color:#000080">&lt;inf:KeyCommandName</span> <span style="color:#008080">Key=</span><span style="color:#d14">&#34;Left&#34;</span> <span style="color:#008080">CommandName=</span><span style="color:#d14">&#34;PlayerLeft&#34;</span> <span style="color:#000080">/&gt;</span>
				<span style="color:#000080">&lt;inf:KeyCommandName</span> <span style="color:#008080">Key=</span><span style="color:#d14">&#34;Up&#34;</span> <span style="color:#008080">CommandName=</span><span style="color:#d14">&#34;PlayerUp&#34;</span> <span style="color:#000080">/&gt;</span>
				<span style="color:#000080">&lt;inf:KeyCommandName</span> <span style="color:#008080">Key=</span><span style="color:#d14">&#34;Down&#34;</span> <span style="color:#008080">CommandName=</span><span style="color:#d14">&#34;PlayerDown&#34;</span> <span style="color:#000080">/&gt;</span>
			<span style="color:#000080">&lt;/inf:KeyBehavior.DownKeyCommands&gt;</span>
		<span style="color:#000080">&lt;/inf:KeyBehavior&gt;</span>
	<span style="color:#000080">&lt;/interactivity:Interaction.Behaviors&gt;</span>
...
<span style="color:#000080">&lt;/grid&gt;</span>
</code></pre></div><p>The behavior implementation is the same as yesterday, only this time we thankfully override the OnAttached and OnDetaching methods</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">KeyBehavior</span> : Behavior&lt;frameworkElement&gt;
{
	<span style="color:#000;font-weight:bold">public</span> List&lt;keyCommandName&gt; DownKeyCommands { <span style="color:#000;font-weight:bold">get</span>; <span style="color:#000;font-weight:bold">set</span>; }
	<span style="color:#000;font-weight:bold">public</span> List&lt;keyCommandName&gt; UpKeyCommands { <span style="color:#000;font-weight:bold">get</span>; <span style="color:#000;font-weight:bold">set</span>; }

	<span style="color:#000;font-weight:bold">public</span> KeyBehavior()
	: <span style="color:#000;font-weight:bold">base</span>()
	{
		DownKeyCommands = <span style="color:#000;font-weight:bold">new</span> List&lt;keyCommandName&gt;();
		UpKeyCommands = <span style="color:#000;font-weight:bold">new</span> List&lt;keyCommandName&gt;();
	}

	<span style="color:#000;font-weight:bold">protected</span> <span style="color:#000;font-weight:bold">override</span> <span style="color:#000;font-weight:bold">void</span> OnAttached()
	{
		<span style="color:#000;font-weight:bold">base</span>.OnAttached();
		SubscribeToKeyEvents();
	}

	<span style="color:#000;font-weight:bold">protected</span> <span style="color:#000;font-weight:bold">override</span> <span style="color:#000;font-weight:bold">void</span> OnDetaching()
	{
		UnsubscribeFromKeyEvents();
		<span style="color:#000;font-weight:bold">base</span>.OnDetaching();
	}

	<span style="color:#000;font-weight:bold">void</span> SubscribeToKeyEvents()
	{
		AssociatedObject.KeyDown += AssociatedObject_KeyDown;
		AssociatedObject.KeyUp += AssociatedObject_KeyUp;
	}

	<span style="color:#000;font-weight:bold">void</span> UnsubscribeFromKeyEvents()
	{
		AssociatedObject.KeyDown -= AssociatedObject_KeyDown;
		AssociatedObject.KeyUp -= AssociatedObject_KeyUp;
	}
}
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
										<li><a href="../../tags/silverlight">Silverlight</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">17</span>
										<span class="rest">Oct 2009</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Silverlight: leveraging attached properties to handle key events</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>I strongly believe that input handling is a responsability that belongs to the View. At first i simply added the following in the code-behind of my GameView</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">protected</span> <span style="color:#000;font-weight:bold">override</span> <span style="color:#000;font-weight:bold">void</span> OnKeyDown(KeyEventArgs e)
{
	<span style="color:#000;font-weight:bold">base</span>.OnKeyDown(e);

	<span style="color:#000;font-weight:bold">if</span> (e.Key == Key.Left) Model.MovePlayerLeft();
	...
}
</code></pre></div><p>But i wanted to play with the cool kids so i exposed ICommand properties on my ViewModel instead and rewrote the code like this</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">protected</span> <span style="color:#000;font-weight:bold">override</span> <span style="color:#000;font-weight:bold">void</span> OnKeyDown(KeyEventArgs e)
{
	<span style="color:#000;font-weight:bold">base</span>.OnKeyDown(e);

	<span style="color:#000;font-weight:bold">if</span> (e.Key == Key.Left) Model.PlayerLeft.Execute(<span style="color:#000;font-weight:bold">null</span>);
	...
</code></pre></div><p>Offcourse, designers should not have to write code at all, thus i searched for a different solution. Because there isn&rsquo;t a behavior that allows me to differentiate the command based on the actual key being pressed i wrote my own KeyEvents class which allows the designer to map a key to a command. Here is an example</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000080">&lt;grid&gt;</span>
	<span style="color:#000080">&lt;inf:KeyEvents.Down&gt;</span>
		<span style="color:#000080">&lt;inf:KeyCommand</span> <span style="color:#008080">Key=</span><span style="color:#d14">&#34;Right&#34;</span> <span style="color:#008080">CommandName=</span><span style="color:#d14">&#34;PlayerRight&#34;</span> <span style="color:#000080">/&gt;</span>
		<span style="color:#000080">&lt;inf:KeyCommand</span> <span style="color:#008080">Key=</span><span style="color:#d14">&#34;Left&#34;</span> <span style="color:#008080">CommandName=</span><span style="color:#d14">&#34;PlayerLeft&#34;</span> <span style="color:#000080">/&gt;</span>
		<span style="color:#000080">&lt;inf:KeyCommand</span> <span style="color:#008080">Key=</span><span style="color:#d14">&#34;Up&#34;</span> <span style="color:#008080">CommandName=</span><span style="color:#d14">&#34;PlayerUp&#34;</span> <span style="color:#000080">/&gt;</span>
		<span style="color:#000080">&lt;inf:KeyCommand</span> <span style="color:#008080">Key=</span><span style="color:#d14">&#34;Down&#34;</span> <span style="color:#008080">CommandName=</span><span style="color:#d14">&#34;PlayerDown&#34;</span> <span style="color:#000080">/&gt;</span>
	<span style="color:#000080">&lt;/inf:KeyEvents.Down&gt;</span>
	...
<span style="color:#000080">&lt;/grid&gt;</span>
</code></pre></div><p>The down property is nothing more than an attached property:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">readonly</span> DependencyProperty DownProperty = DependencyProperty.RegisterAttached(<span style="color:#d14">&#34;Down&#34;</span>, <span style="color:#000;font-weight:bold">typeof</span>(List&lt;keyCommand&gt;), <span style="color:#000;font-weight:bold">typeof</span>(KeyEvents), <span style="color:#000;font-weight:bold">new</span> PropertyMetadata(<span style="color:#000;font-weight:bold">null</span>, OnSetDownCallback));
</code></pre></div><p>A KeyCommand is a simple pair of a Key and a Command name:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">KeyCommand</span>
{
	<span style="color:#000;font-weight:bold">public</span> Key Key { <span style="color:#000;font-weight:bold">get</span>; <span style="color:#000;font-weight:bold">set</span>; }
	<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">string</span> CommandName { <span style="color:#000;font-weight:bold">get</span>; <span style="color:#000;font-weight:bold">set</span>; }
}
</code></pre></div><p>The GetDown method (for the attached Down property) will instantiate a KeyBehavior class which hooks up to the element&rsquo;s KeyDown and KeyUp events and uses a bit of reflection to find the commands&hellip;</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">KeyBehavior</span>
{
	<span style="color:#000;font-weight:bold">public</span> KeyBehavior(FrameworkElement frameworkElement)
	{
		FrameworkElement = frameworkElement;
		DownKeyCommands = <span style="color:#000;font-weight:bold">new</span> List&lt;keyCommand&gt;();
		UpKeyCommands = <span style="color:#000;font-weight:bold">new</span> List&lt;keyCommand&gt;();

		frameworkElement.KeyDown += frameworkElement_KeyDown;
		frameworkElement.KeyUp += frameworkElement_KeyUp;
	}

	<span style="color:#000;font-weight:bold">public</span> FrameworkElement FrameworkElement { <span style="color:#000;font-weight:bold">get</span>; <span style="color:#000;font-weight:bold">set</span>; }
	<span style="color:#000;font-weight:bold">public</span> IList&lt;keyCommand&gt; DownKeyCommands { <span style="color:#000;font-weight:bold">get</span>; <span style="color:#000;font-weight:bold">set</span>; }
	<span style="color:#000;font-weight:bold">public</span> IList&lt;keyCommand&gt; UpKeyCommands { <span style="color:#000;font-weight:bold">get</span>; <span style="color:#000;font-weight:bold">set</span>; }

	<span style="color:#000;font-weight:bold">void</span> frameworkElement_KeyUp(<span style="color:#458;font-weight:bold">object</span> sender, KeyEventArgs e)
	{
		ExecuteCommandsForKey(e.Key, UpKeyCommands);
	}

	<span style="color:#000;font-weight:bold">void</span> frameworkElement_KeyDown(<span style="color:#458;font-weight:bold">object</span> sender, KeyEventArgs e)
	{
		ExecuteCommandsForKey(e.Key, DownKeyCommands);
	}

	<span style="color:#000;font-weight:bold">void</span> ExecuteCommandsForKey(Key key, IEnumerable&lt;keyCommand&gt; commands)
	{
		<span style="color:#458;font-weight:bold">var</span> commandNamesForKey = commands.Where(p =&gt; p.Key == key).Select(p =&gt; p.CommandName);
		<span style="color:#458;font-weight:bold">var</span> viewModel = FrameworkElement.DataContext;
		<span style="color:#000;font-weight:bold">foreach</span> (<span style="color:#458;font-weight:bold">var</span> command <span style="color:#000;font-weight:bold">in</span> commandNamesForKey) GetCommandAndExecuteIt(viewModel, command);
	}

	<span style="color:#000;font-weight:bold">void</span> GetCommandAndExecuteIt(<span style="color:#458;font-weight:bold">object</span> model, <span style="color:#458;font-weight:bold">string</span> name)
	{
		<span style="color:#458;font-weight:bold">var</span> command = GetCommand(model, name);
		command.Execute(<span style="color:#000;font-weight:bold">null</span>);
	}

	ICommand GetCommand(<span style="color:#458;font-weight:bold">object</span> model, <span style="color:#458;font-weight:bold">string</span> name)
	{
		<span style="color:#000;font-weight:bold">return</span> (ICommand)model.GetType().GetProperty(name).GetValue(model, <span style="color:#000;font-weight:bold">null</span>);
	}
}
</code></pre></div><p>The only thing that is missing is a way to unsubscribe from the events (and so you will end up with memory leaks). WeakReferences may come of use but i&rsquo;ll leave that as an exercise for the reader. Many thanks go to the <a href="http://wpfdisciples.wordpress.com/">WPF Disciples</a> because they inspired me to come up with this attached properties magic.</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
										<li><a href="../../tags/silverlight">Silverlight</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">16</span>
										<span class="rest">Oct 2009</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Exploring graphical programming with Blend, Visual State Manager and Behaviors</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>A while ago i presented the <a href="http://www.timvw.be/experimenting-with-controlstatemachine-and-fluent-interfaces/">ControlStateMachine</a> and in Silverlight this concept is implemented as the <a href="http://windowsclient.net/wpf/wpf35/wpf-35sp1-toolkit-visual-state-manager-overview.aspx">Visual State Manager</a>.</p>
<p>In my sokoban implementation i have a cellview which exists out of 6 canvasses but only two of them (one for the cell type and one for the piece type) are visible at any given point in time. I have implemented this with 6 properties CanvasXVisible (with X being Player, Box, Wall, Goal, Floor and Cell) in my ViewModel but a State Machine / Manager may help clarify how the visibility of the canvasses are related. Here are the 2 visual state groups and their states that i would need for the CellView</p>
<p><img src="http://www.timvw.be/wp-content/images/cellview-vsm.png" alt="screenshot of visual state manager in expression blend"></p>
<p>As you can see there is quite a lof of XAML involved to make the correct canvas visible:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000080">&lt;visualState</span> <span style="color:#008080">x:Name=</span><span style="color:#d14">&#34;Space1&#34;</span><span style="color:#000080">&gt;</span>
 <span style="color:#000080">&lt;storyboard&gt;</span>
  <span style="color:#000080">&lt;objectAnimationUsingKeyFrames</span> <span style="color:#008080">BeginTime=</span><span style="color:#d14">&#34;00:00:00&#34;</span>  <span style="color:#008080">Duration=</span><span style="color:#d14">&#34;00:00:00.0010000&#34;</span>
   <span style="color:#008080">Storyboard.TargetName=</span><span style="color:#d14">&#34;Space&#34;</span>  <span style="color:#008080">Storyboard.TargetProperty=</span><span style="color:#d14">&#34;(UIElement.Visibility)&#34;</span><span style="color:#000080">&gt;</span>
    <span style="color:#000080">&lt;discreteObjectKeyFrame</span> <span style="color:#008080">KeyTime=</span><span style="color:#d14">&#34;00:00:00&#34;</span><span style="color:#000080">&gt;</span>
     <span style="color:#000080">&lt;discreteObjectKeyFrame.Value&gt;</span>
      <span style="color:#000080">&lt;visibility&gt;</span>Visible<span style="color:#000080">&lt;/visibility&gt;</span>
     <span style="color:#000080">&lt;/discreteObjectKeyFrame.Value&gt;</span>
    <span style="color:#000080">&lt;/discreteObjectKeyFrame&gt;</span>
   <span style="color:#000080">&lt;/objectAnimationUsingKeyFrames&gt;</span>
  <span style="color:#000080">&lt;/storyboard&gt;</span>
<span style="color:#000080">&lt;/visualState&gt;</span>
</code></pre></div><p>For a simple modification to the Visibility property this seems like overkill but in many situations you will want to change more than this one property.</p>
<p>With the aid of the behaviors that come with Blend i can quickly add a couple of radio buttons, toss in some gotostate actions and end up with an interactive application:</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000080">&lt;radioButton</span> <span style="color:#008080">Width=</span><span style="color:#d14">&#34;63&#34;</span> <span style="color:#008080">Canvas.Left=</span><span style="color:#d14">&#34;8&#34;</span> <span style="color:#008080">Canvas.Top=</span><span style="color:#d14">&#34;172&#34;</span> <span style="color:#008080">Content=</span><span style="color:#d14">&#34;Wall&#34;</span> <span style="color:#008080">GroupName=</span><span style="color:#d14">&#34;PieceTypes&#34;</span><span style="color:#000080">&gt;</span>
 <span style="color:#000080">&lt;i:Interaction.Triggers&gt;</span>
  <span style="color:#000080">&lt;i:EventTrigger</span> <span style="color:#008080">EventName=</span><span style="color:#d14">&#34;Checked&#34;</span><span style="color:#000080">&gt;</span>
   <span style="color:#000080">&lt;ic:GoToStateAction</span> <span style="color:#008080">StateName=</span><span style="color:#d14">&#34;Wall1&#34;</span><span style="color:#000080">/&gt;</span>
  <span style="color:#000080">&lt;/i:EventTrigger&gt;</span>
 <span style="color:#000080">&lt;/i:Interaction.Triggers&gt;</span>
<span style="color:#000080">&lt;/radioButton&gt;</span>
</code></pre></div><p>Feel free to try it yourself by changing the radio buttons</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000080">&lt;div</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;exploringVSM&#34;</span><span style="color:#000080">&gt;</span>
 <span style="color:#000080">&lt;object</span> <span style="color:#008080">data=</span><span style="color:#d14">&#34;data:application/x-silverlight-2,&#34;</span> <span style="color:#008080">type=</span><span style="color:#d14">&#34;application/x-silverlight-2&#34;</span>  <span style="color:#008080">width=</span><span style="color:#d14">&#34;300&#34;</span> <span style="color:#008080">height=</span><span style="color:#d14">&#34;240&#34;</span><span style="color:#000080">&gt;</span>
  <span style="color:#000080">&lt;param</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;source&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;http://www.timvw.be/ClientBin/ExploringVSM.xap&#34;</span><span style="color:#000080">/&gt;</span>
  <span style="color:#000080">&lt;param</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;onError&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;onSilverlightError&#34;</span> <span style="color:#000080">/&gt;</span>
  <span style="color:#000080">&lt;param</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;background&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;white&#34;</span> <span style="color:#000080">/&gt;</span>
  <span style="color:#000080">&lt;param</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;minRuntimeVersion&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;3.0.40624.0&#34;</span> <span style="color:#000080">/&gt;</span>
  <span style="color:#000080">&lt;param</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;autoUpgrade&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;true&#34;</span> <span style="color:#000080">/&gt;</span>
  <span style="color:#000080">&lt;a</span> <span style="color:#008080">href=</span><span style="color:#d14">&#34;http://go.microsoft.com/fwlink/?LinkID=149156&amp;#038;v=3.0.40624.0&#34;</span> <span style="color:#008080">style=</span><span style="color:#d14">&#34;text-decoration:none&#34;</span><span style="color:#000080">&gt;</span>
   <span style="color:#000080">&lt;img</span> <span style="color:#008080">src=</span><span style="color:#d14">&#34;http://go.microsoft.com/fwlink/?LinkId=108181&#34;</span> <span style="color:#008080">alt=</span><span style="color:#d14">&#34;Get Microsoft Silverlight&#34;</span> <span style="color:#008080">style=</span><span style="color:#d14">&#34;border-style:none&#34;</span><span style="color:#000080">/&gt;</span>
  <span style="color:#000080">&lt;/a&gt;</span>
 <span style="color:#000080">&lt;/object&gt;</span>
 <span style="color:#000080">&lt;iframe</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;_sl_historyFrame&#34;</span> <span style="color:#008080">style=</span><span style="color:#d14">&#34;visibility:hidden;height:0px;width:0px;border:0px&#34;</span><span style="color:#000080">&gt;&lt;/iframe&gt;</span>
<span style="color:#000080">&lt;/div&gt;&lt;/div&gt;</span>
</code></pre></div><p>Conclusion: All in all it is relatively easy to create interactive applications using Blend without writing a single line of code.
Too bad that the behaviors are in an Expression assembly and don&rsquo;t come with standard Silverlight.
Another attention point is the maintainability of this new style of programming.</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/silverlight">Silverlight</a></li>
										
										<li><a href="../../tags/wpf">WPF</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">13</span>
										<span class="rest">Oct 2009</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">About databinding and composite views</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>A couple of days ago i had a databound ItemsControl (collection of Model.Cell) which instantiated sub views (with their own viewmodel).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000080">&lt;grid&gt;</span>
	<span style="color:#000080">&lt;grid.Resources&gt;</span>
		<span style="color:#000080">&lt;dataTemplate</span> <span style="color:#008080">x:Key=</span><span style="color:#d14">&#34;CellTemplate&#34;</span><span style="color:#000080">&gt;</span>
			<span style="color:#000080">&lt;views:CellView</span> <span style="color:#000080">/&gt;</span>
		<span style="color:#000080">&lt;/dataTemplate&gt;</span>
	<span style="color:#000080">&lt;/grid.Resources&gt;</span>
	<span style="color:#000080">&lt;itemsControl</span> <span style="color:#008080">ItemTemplate=</span><span style="color:#d14">&#34;{StaticResource CellTemplate}&#34;</span> <span style="color:#008080">ItemsSource=</span><span style="color:#d14">&#34;{Binding Cells}&#34;</span> <span style="color:#000080">/&gt;</span>
<span style="color:#000080">&lt;/grid&gt;</span>
</code></pre></div><p>Because each CellViewModel needs to know which cell they manage i used the following dirty hack</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> CellView()
{
	Loaded += CellView_Loaded;
}

<span style="color:#000;font-weight:bold">void</span> CellView_Loaded(<span style="color:#458;font-weight:bold">object</span> sender, RoutedEventArgs e)
{
	DataContext = <span style="color:#000;font-weight:bold">new</span> CellViewModel(DataContext);
}
</code></pre></div><p>Later on that day i realised there was a much cleaner solution: Let the BoardViewModel expose a collection of ViewModels.CellViewModel instead of Model.Cell. What a relief that i don&rsquo;t have to use the Loaded event hack.</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/patterns">Patterns</a></li>
										
										<li><a href="../../tags/silverlight">Silverlight</a></li>
										
										<li><a href="../../tags/wpf">WPF</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">13</span>
										<span class="rest">Oct 2009</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Exploring M-V-VM</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>A couple of years ago a collegue recommended <a href="http://www.amazon.com/Data-Binding-Windows-Forms-2-0/dp/032126892X">Data Binding with Windows Forms 2.0: Programming Smart Client Data Applications with .NET</a> and i noticed that my code started to gravitate towards an <a href="http://en.wikipedia.org/wiki/Model_View_ViewModel">Model-View-ViewModel</a> architecture. Due to shortcomings and painful experiences i gave up on databinding and began to use <a href="http://martinfowler.com/eaaDev/PassiveScreen.html">Passieve View</a> instead.</p>
<p>Passive View doesn&rsquo;t work (well) with smart views so i decided to give M-V-VM another because i really wanted to leverage WPF&rsquo;s rich support for databinding.</p>
<p>The key difference between M-V-VM and Passive View is, imho, the fact that the ViewModel is unaware of the View unlike Passive View where the Presenter knows about the (simple) View.</p>
<p>When we test a Presenter i notice that we end up writing interaction based tests (assertions on a mocked view) and when we test a ViewModel we end up writing state-based tests instead.</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/patterns">Patterns</a></li>
										
										<li><a href="../../tags/silverlight">Silverlight</a></li>
										
										<li><a href="../../tags/wpf">WPF</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">13</span>
										<span class="rest">Oct 2009</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">ViewModel to translate domain messages to view events</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Here is an example of a ViewModel that translates domain messages to view events:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">GameViewModel</span> : INotifyPropertyChanged, IListener&lt;boardChanged&gt;
{
	<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">event</span> PropertyChangedEventHandler PropertyChanged = <span style="color:#000;font-weight:bold">delegate</span> { };

	<span style="color:#000;font-weight:bold">public</span> GameViewModel()
	{
		<span style="color:#458;font-weight:bold">var</span> messageBus = ServiceLocator.MessageBus;
		messageBus.Subscribe&lt;boardChanged&gt;(<span style="color:#000;font-weight:bold">this</span>);
	}

	<span style="color:#000;font-weight:bold">void</span> IListener&lt;boardChanged&gt;.Handle(BoardChanged message)
	{
		PropertyChanged(<span style="color:#d14">&#34;Board&#34;</span>);
	}
}
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
										<li><a href="../../tags/silverlight">Silverlight</a></li>
										
										<li><a href="../../tags/wpf">WPF</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">12</span>
										<span class="rest">Oct 2009</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Sokoban: Creating graphics with Expression Design</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Earlier this morning i decided to improve the graphics the little. I launched Expression Design, created a new image, and drew each possible cell and piece in a seperate layer. With this technique i can easily preview how a &ldquo;Box&rdquo; on &ldquo;Goal&rdquo; looks like.</p>
<p>For each layer i simply copied the XAML from Expression Design into my Cell.xaml file. Apparently all the layers are interpreted as a Canvas and the layer name determines their x:Name which makes it pretty easy to make the correct canvasses visible. With a simple ScaleTransform i can ensure that the canvasses are sized correctly.</p>
<p>Here is the updated version of Sokoban:</p>
<!-- raw HTML omitted -->

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/silverlight">Silverlight</a></li>
										
										<li><a href="../../tags/wpf">WPF</a></li>
										
									</ul>
								
							
						</div></div>
				
				

<ul class="pagination">
	<li class="page-item page-prev">
	
    <a href="../../page/12/" class="page-link" aria-label="Previous"><span aria-hidden="true">← Prev page</span></a>
	
	</li>
	<li class="page-item page-next">
	
    <a href="../../page/14/" class="page-link" aria-label="Next"><span aria-hidden="true">Next page →</span></a>
	
	</li>
</ul>


			</div>
		</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2022  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-9DP4SV12YW', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
