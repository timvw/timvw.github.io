<!DOCTYPE html>
<html>
<head>
	<meta name="generator" content="Hugo 0.80.0" />
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Tim Van Wassenhove - Passionate geek, interested in Technology. Proud father of two </title><meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="alternate" type="application/rss+xml" href="https://timvw.be/feed.xml" title="Tim Van Wassenhove" />
	<meta itemprop="name" content="Tim Van Wassenhove">
<meta itemprop="description" content="">
<meta property="og:title" content="Tim Van Wassenhove" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://timvw.be/" />
<meta property="og:updated_time" content="2021-11-08T15:31:18+01:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Tim Van Wassenhove"/>
<meta name="twitter:description" content=""/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://timvw.be/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://timvw.be/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="https://timvw.be/">Tim Van Wassenhove</a></h1>
	<div class="site-description"><p>Passionate geek, interested in Technology. Proud father of two</p><nav class="nav social">
			<ul class="flat"><li><a href="https://twitter.com/timvw" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://github.com/timvw" title="Github"><i data-feather="github"></i></a></li><li><a href="https://www.linkedin.com/in/timvanwassenhove" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="https://timvw.be/feed.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="../../">Home</a>
			</li>
			
			<li>
				<a href="../../posts">All posts</a>
			</li>
			
			<li>
				<a href="../../tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="recent-posts section">
			<div class="posts">
				
				
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">28</span>
										<span class="rest">Oct 2011</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Say no to primitives in your API.. and make your software more explicit</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>A while ago I wrote some code like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> ICanBroadcast
{ 
  <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">void</span> Broadcast(<span style="color:#458;font-weight:bold">string</span> message) { ... }  
  <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">void</span> Broadcast(<span style="color:#458;font-weight:bold">string</span> message, <span style="color:#458;font-weight:bold">string</span> author) { ... }
}
</code></pre></div><p>A bit later the requirements changed and from now on it was required to specify the topic:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> ICanBroadcast  
{
  <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">void</span> Broadcast(<span style="color:#458;font-weight:bold">string</span> message, <span style="color:#458;font-weight:bold">string</span> topic) { ... }  
  <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">void</span> Broadcast(<span style="color:#458;font-weight:bold">string</span> message, <span style="color:#458;font-weight:bold">string</span> author, <span style="color:#458;font-weight:bold">string</span> topic) { ... } 
}
</code></pre></div><p>In case you were using Broadcast(string message) the compiler would rightfully inform you that no such method exists. In case you were using Broadcast(string message, string author) the compiler does not catch the error and incorrectly uses the author as topic. I can only hope that you have a suite of tests that makes you notice that something is wrong when you upgrade to my latest release.</p>
<p>Let&rsquo;s make the difference between an Author and a Topic more explicit (to our API consumers and the compiler) by creating explicit types to represent the concepts:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> ICanBroadcast 
{  
  <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">void</span> Broadcast(Message message, Topic topic) { ... } 
  <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">void</span> Broadcast(Message message, Author author, Topic topic) { ... }  
} 
</code></pre></div><p>The joy of using a typed language 😉</p>

						</div>
			
						<div class="tags">
							
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">18</span>
										<span class="rest">Oct 2011</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Force the removal of a file with PowerShell</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Last couple of weeks I have been generating a lot of files (and restricting their ACLs) and today I decided to remove all those files. The problem is that my user account did not have permissions on those files. Here is a small script that will first take ownership of the file, then grants FullControl permissions, and finally removes the file 🙂</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#000;font-weight:bold">function</span> RemoveFile 
{	  
	<span style="color:#000;font-weight:bold">param</span>(<span style="color:#008080">$FileName</span>)
	
	&amp;takeown /F <span style="color:#008080">$FileName</span>
	<span style="color:#008080">$User</span> = <span style="color:#008080">[System.Security.Principal.WindowsIdentity]</span>::GetCurrent().User
	<span style="color:#008080">$Acl</span> = <span style="color:#0086b3">Get-Acl</span> <span style="color:#008080">$FileName</span>	  
	<span style="color:#008080">$Acl</span>.SetOwner(<span style="color:#008080">$User</span>)	  
	<span style="color:#008080">$AccessRule</span> = <span style="color:#0086b3">New-Object</span> System.Security.AccessControl.FileSystemAccessRule(<span style="color:#008080">$User</span>, <span style="color:#d14">&#34;FullControl&#34;</span>, <span style="color:#d14">&#34;Allow&#34;</span>)	  
	<span style="color:#008080">$Acl</span>.SetAccessRule(<span style="color:#008080">$AccessRule</span>)	  
	<span style="color:#0086b3">Set-Acl</span> <span style="color:#008080">$FileName</span> <span style="color:#008080">$Acl</span>
	<span style="color:#0086b3">Remove-Item</span> <span style="color:#008080">$FileName</span> 
}

<span style="color:#0086b3">Get-ChildItem</span> *.txt -R | % { RemoveFile <span style="color:#008080">$_</span>.FullName; }
</code></pre></div><p><strong>Edit on 2011-10-19</strong></p>
<p>Resetting the permissions with icacls c:\output /reset /t and then calling Remove-Item c:\output -R does the trick.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#000;font-weight:bold">function</span> RemoveFiles 
{  
	<span style="color:#000;font-weight:bold">param</span>(<span style="color:#008080">$Directory</span>)

	icacls <span style="color:#008080">$Directory</span> /reset /t 
	<span style="color:#0086b3">Remove-Item</span> <span style="color:#008080">$Directory</span> -R 
}

RemoveFiles c:\output;
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/powershell">PowerShell</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">22</span>
										<span class="rest">Sep 2011</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Remove all access rules from a directory</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>A while ago i needed to write some code that removes all (existing/inherited) access rules from a given directory. It was pretty frustrating to notice that all my attempts seemed to fail (<a href="http://msdn.microsoft.com/en-us/library/system.security.accesscontrol.commonobjectsecurity.removeaccessrule.aspx">RemoveAccessRule</a>, <a href="http://msdn.microsoft.com/en-us/library/system.security.accesscontrol.objectsecurity.purgeaccessrules.aspx">PurgeAccessRule</a>, &hellip;)</p>
<p>Finally i found that <a href="">SetAccessRuleProtection</a> was the method that i needed to invoke.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">string</span> Folder = <span style="color:#d14">@&#34;c:\temp\secured&#34;</span>;
<span style="color:#458;font-weight:bold">var</span> directory = <span style="color:#000;font-weight:bold">new</span> DirectoryInfo(Folder);
<span style="color:#458;font-weight:bold">var</span> directorySecurity = directory.GetAccessControl();
directorySecurity.SetAccessRuleProtection(<span style="color:#000;font-weight:bold">true</span>,<span style="color:#000;font-weight:bold">false</span>);
directory.SetAccessControl(directorySecurity);
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>There you go 😉</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/c">C</a></li>
										
										<li><a href="../../tags/security">security</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">19</span>
										<span class="rest">Aug 2011</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Use SQL Server Profiler to see if a connection is pooled</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>It took me a couple of websearches to discover how i can see in SQL Server Profiler whether or not a connection is pooled. Apparently you have to check &lsquo;Show all columns&rsquo; and then you can check the &lsquo;EventSubClass&rsquo; column:</p>
<p><a href="http://www.timvw.be/wp-content/uploads/2011/08/sql_server_profiler_eventsubclass.png"><!-- raw HTML omitted --></a></p>
<p>This is how it looks like in your trace window:</p>
<p><a href="http://www.timvw.be/wp-content/uploads/2011/08/sql_server_profiler_eventsubclass_trace.png"><!-- raw HTML omitted --></a></p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/pooling">pooling</a></li>
										
										<li><a href="../../tags/profiler">profiler</a></li>
										
										<li><a href="../../tags/sql">SQL</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">18</span>
										<span class="rest">Aug 2011</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">SqlConnectionStringBuilder sets the Pooling property to true by default</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Here is something that surprised me: SqlConnectionStringBuilder sets the <a href="http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnectionstringbuilder.pooling.aspx">Pooling</a> property to true by default.</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/c">C</a></li>
										
										<li><a href="../../tags/t-sql">t-sql</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">01</span>
										<span class="rest">Aug 2011</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Specialized solution for aggregate string concatenation</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>I have noticed that most people come up with the following solution to build a string in T-SQL:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">WITH</span> [Numbers] <span style="color:#000;font-weight:bold">AS</span> (	  
	<span style="color:#000;font-weight:bold">SELECT</span> TOP(<span style="color:#099">10</span>) [n]	  
	<span style="color:#000;font-weight:bold">FROM</span> [Nums] 
)	  
<span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#000;font-weight:bold">@</span>message <span style="color:#000;font-weight:bold">=</span> COALESCE(<span style="color:#000;font-weight:bold">@</span>message, <span style="color:#d14">&#39;&#39;</span>) <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;&#39;</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">CAST</span>([n] <span style="color:#000;font-weight:bold">AS</span> nvarchar(<span style="color:#099">2</span>))	  
<span style="color:#000;font-weight:bold">FROM</span> [Numbers];

<span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#000;font-weight:bold">@</span>message <span style="color:#000;font-weight:bold">=</span> STUFF(<span style="color:#000;font-weight:bold">@</span>message, <span style="color:#099">1</span>, <span style="color:#099">2</span>, <span style="color:#d14">&#39;&#39;</span>);
<span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#000;font-weight:bold">@</span>message;
</code></pre></div><blockquote>
<p>Important! Microsoft has no official documentation describing this aggregate concatenation
technique that is based on the assignment SELECT syntax. The behavior described here is
based on observation alone. The current implementation of the ConcatOrders function doesn’t
incorporate
an ORDER BY clause and does not guarantee the order of concatenation. According
to a blog entry by Microsoft’s Conor Cunningham, it seems that SQL Server will respect an
ORDER BY clause if specified (<a href="http://blogs.msdn.com/sqltips/archive/2005/07/20/441053.aspx)">http://blogs.msdn.com/sqltips/archive/2005/07/20/441053.aspx)</a>.
Conor is a very credible source, but I should stress that besides
this blog entry I haven’t found
any official documentation describing how a multi-row assignment
SELECT should behave—with
or without an ORDER BY clause.</p>
</blockquote>
<p>With the aid of FOR XML PATH (as mentionned in <a href="http://www.sql.co.il/books/insidetsql2008/">Inside Microsoft SQL Server 2008: T-SQL Programming</a> we can solve this problem using a documented approach:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">WITH</span> [Numbers] <span style="color:#000;font-weight:bold">AS</span> (	  
	<span style="color:#000;font-weight:bold">SELECT</span> TOP(<span style="color:#099">10</span>) [n]	  
	<span style="color:#000;font-weight:bold">FROM</span> [Nums] 
)	  
<span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#000;font-weight:bold">@</span>message <span style="color:#000;font-weight:bold">=</span> (<span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#d14">&#39;&#39;</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">CAST</span>([n] <span style="color:#000;font-weight:bold">AS</span> nvarchar(<span style="color:#099">2</span>)) <span style="color:#000;font-weight:bold">AS</span> [<span style="color:#0086b3">text</span>()]  
<span style="color:#000;font-weight:bold">FROM</span> [Numbers]	  
<span style="color:#000;font-weight:bold">FOR</span> XML PATH(<span style="color:#d14">&#39;&#39;</span>));

<span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#000;font-weight:bold">@</span>message <span style="color:#000;font-weight:bold">=</span> STUFF(<span style="color:#000;font-weight:bold">@</span>message, <span style="color:#099">1</span>, <span style="color:#099">2</span>, <span style="color:#d14">&#39;&#39;</span>);
<span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#000;font-weight:bold">@</span>message;
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/t-sql">t-sql</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">01</span>
										<span class="rest">Aug 2011</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">TryGetResult</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>I think this entry has been in the pipeline for a couple of years now and today i have decided to finally post it 😉 I got frustrated with the annoying out parameter in TryGet methods so i decided to use a different signature using TryGetResult:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TryGetResult</span>&lt;T&gt; 
{
  <span style="color:#000;font-weight:bold">public</span> TryGetResult()   
  {   
    Success = <span style="color:#000;font-weight:bold">false</span>;  
  }

  <span style="color:#000;font-weight:bold">public</span> TryGetResult(T result)  
  {   
    Success = <span style="color:#000;font-weight:bold">true</span>; 
    Result = result;  
  }

  <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">bool</span> Success { <span style="color:#000;font-weight:bold">get</span>; <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">set</span>; }

  <span style="color:#000;font-weight:bold">public</span> T Result { <span style="color:#000;font-weight:bold">get</span>; <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">set</span>; }
}
</code></pre></div><p>And now your TryGet methods can have the following signature:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> TryGetResult&lt;Person&gt; TryGetPersonByName(<span style="color:#458;font-weight:bold">string</span> name) 
{   
  <span style="color:#998;font-style:italic">// person is not available  
</span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">if</span>(name.IsInvalidPersonName()) <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> TryGetResult();

  <span style="color:#998;font-style:italic">// return the person
</span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> TryGetResult(<span style="color:#000;font-weight:bold">new</span> Person(name));
}
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/c">C</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">15</span>
										<span class="rest">Jul 2011</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Launch DtExec from PowerShell</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Running an SSIS package from PowerShell (using DTExec) can be as simple as:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">RunPackage <span style="color:#000;font-weight:bold">-File</span> <span style="color:#d14">&#39;C:\test.dtsx&#39;</span> -DatabaseHost <span style="color:#d14">&#39;.&#39;</span> -DatabaseName <span style="color:#d14">&#39;TEST&#39;</span>;
</code></pre></div><p>Here are the functions that make it this simple:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#000;font-weight:bold">function</span> GetDtExecPath {    
  <span style="color:#008080">$DtsPath</span> = (<span style="color:#0086b3">Get-ItemProperty</span> <span style="color:#d14">&#39;HKLM:\SOFTWARE\Microsoft\Microsoft SQL Server\100\DTS\Setup&#39;</span>).SQLPath;    
  <span style="color:#008080">$DtExecPath</span> = (<span style="color:#0086b3">Resolve-Path</span> <span style="color:#d14">&#34;$DtsPath\Binn\DTExec.exe&#34;</span>);    
  <span style="color:#008080">$DtExecPath</span>;
}

<span style="color:#000;font-weight:bold">function</span> GetDtExecPropertyPathValue() {      
  <span style="color:#000;font-weight:bold">param</span>(
    <span style="color:#008080">$PropertyPath</span> = <span style="color:#d14">&#39;&#39;</span>,
    <span style="color:#008080">$Value</span> = <span style="color:#d14">&#39;&#39;</span>;
  );

  <span style="color:#d14">&#34;$PropertyPath;\</span><span style="color:#d14">`&#34;</span><span style="color:#d14">\</span><span style="color:#d14">`&#34;</span><span style="color:#d14">$Value\</span><span style="color:#d14">`&#34;</span><span style="color:#d14">\</span><span style="color:#d14">`&#34;</span><span style="color:#d14">&#34;</span>;
}

<span style="color:#000;font-weight:bold">function</span> RunPackage {
      
  <span style="color:#000;font-weight:bold">param</span>(        
  <span style="color:#008080">$DtExecPath</span> = (GetDtExecPath),       
  <span style="color:#008080">$File</span> = <span style="color:#d14">&#39;test.dtsx&#39;</span>  
  );

  <span style="color:#008080">$Params</span> = <span style="color:#d14">&#34;/FILE $File&#34;</span>;
   
  <span style="color:#000;font-weight:bold">for</span>(<span style="color:#008080">$i</span> = 0; <span style="color:#008080">$i</span> <span style="color:#000;font-weight:bold">-lt</span> <span style="color:#008080">$Args</span>.Length; <span style="color:#008080">$i</span> += 2) {       
    <span style="color:#008080">$PropertyPath</span> = <span style="color:#008080">$Args</span>[<span style="color:#008080">$i</span>].SubString(1);       
    <span style="color:#008080">$Value</span> = <span style="color:#008080">$Args</span>[<span style="color:#008080">$i</span>+1];       
    <span style="color:#008080">$PropertyPathValue</span> = GetDtExecPropertyPathValue -PropertyPath <span style="color:#008080">$PropertyPath</span> -Value <span style="color:#008080">$Value</span>;       
    <span style="color:#008080">$Params</span> += <span style="color:#d14">&#34; /SET $PropertyPathValue&#34;</span>;    
  } 

  &amp;<span style="color:#d14">&#34;$DtExecPath&#34;</span> <span style="color:#008080">$Params</span>;
}
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/powershell">PowerShell</a></li>
										
										<li><a href="../../tags/ssis">SSIS</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">13</span>
										<span class="rest">Jul 2011</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Building a Nums table (quickly)</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>A while ago i presented my approach to generate a nums table <a href="http://www.timvw.be/2010/12/11/techniques-learned-in-sqltopia-look-ma-no-loops/">here</a>.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">DECLARE</span> <span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">count</span> <span style="color:#0086b3">INT</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1000</span>;

<span style="color:#000;font-weight:bold">WITH</span>    
  [Nums1] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">AS</span> [Value] <span style="color:#000;font-weight:bold">UNION</span> <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">AS</span> [Value] ) 
, [Nums2] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums1] <span style="color:#000;font-weight:bold">AS</span> A, [Nums1] <span style="color:#000;font-weight:bold">AS</span> B, [Nums1] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">C</span>)  
, [Nums3] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums2] <span style="color:#000;font-weight:bold">AS</span> A, [Nums2] <span style="color:#000;font-weight:bold">AS</span> B, [Nums2] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">C</span>)
, [Nums4] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums3] <span style="color:#000;font-weight:bold">AS</span> A, [Nums3] <span style="color:#000;font-weight:bold">AS</span> B )
, [Numbers] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> TOP(<span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">count</span>) <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span> <span style="color:#000;font-weight:bold">+</span> ROW_NUMBER() OVER(<span style="color:#000;font-weight:bold">ORDER</span> <span style="color:#000;font-weight:bold">BY</span> [Value]) <span style="color:#000;font-weight:bold">AS</span> [Value] <span style="color:#000;font-weight:bold">FROM</span>[Nums4] )
  
<span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Numbers];
</code></pre></div><p>Because we only use this code once to fill the table we don&rsquo;t really care that it is not very fast. Today i discovered there is a way to speed it up in this wonderful book: <a href="http://oreilly.com/catalog/9780735626034/">Inside Microsoft® SQL Server® 2008: T-SQL Querying</a>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">WITH</span>
      
  [Nums1] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">AS</span> [Value] <span style="color:#000;font-weight:bold">UNION</span> <span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">AS</span> [Value] )  
, [Nums2] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums1] <span style="color:#000;font-weight:bold">AS</span> A, [Nums1] <span style="color:#000;font-weight:bold">AS</span> B, [Nums1] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">C</span>)
, [Nums3] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums2] <span style="color:#000;font-weight:bold">AS</span> A, [Nums2] <span style="color:#000;font-weight:bold">AS</span> B, [Nums2] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">C</span>)
, [Nums4] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> A.<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Nums3] <span style="color:#000;font-weight:bold">AS</span> A, [Nums3] <span style="color:#000;font-weight:bold">AS</span> B )
, [Numbers] <span style="color:#000;font-weight:bold">AS</span> ( <span style="color:#000;font-weight:bold">SELECT</span> TOP(<span style="color:#000;font-weight:bold">@</span><span style="color:#000;font-weight:bold">count</span>) <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span> <span style="color:#000;font-weight:bold">+</span> ROW_NUMBER() OVER(<span style="color:#000;font-weight:bold">ORDER</span> <span style="color:#000;font-weight:bold">BY</span> (<span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#099">0</span>)) <span style="color:#000;font-weight:bold">AS</span> [Value] <span style="color:#000;font-weight:bold">FROM</span>[Nums4] )
  
<span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">FROM</span> [Numbers];
</code></pre></div><p>Yay for features like ORDER BY (SELECT <!-- raw HTML omitted -->).</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/sql">SQL</a></li>
										
										<li><a href="../../tags/t-sql">t-sql</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">13</span>
										<span class="rest">Jul 2011</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Using User-Defined Table Type with Identity column in ADO.NET</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>A while ago i wanted to use a <a href="http://msdn.microsoft.com/en-us/library/bb522526.aspx">User-Defined Table Type</a> to pass in a set of records. Nothing special about this except that the first column of the UDTT was an Identity column:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">CREATE</span> <span style="color:#000;font-weight:bold">TYPE</span> [Star].[example] <span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">TABLE</span>(  
  [Ordinal] [<span style="color:#0086b3">int</span>] <span style="color:#000;font-weight:bold">IDENTITY</span>(<span style="color:#099">1</span>,<span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">NOT</span> <span style="color:#000;font-weight:bold">NULL</span>,  
  [Name] [nvarchar](<span style="color:#099">200</span>) <span style="color:#000;font-weight:bold">NOT</span> <span style="color:#000;font-weight:bold">NULL</span>,
)
</code></pre></div><p>After finding a lot of posts saying that this is not supported a colleague of mine, <a href="http://stevehorsfield.wordpress.com/">Stephen Horsfield</a>, found a way to do it as following:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#458;font-weight:bold">var</span> sqlMetaData = <span style="color:#000;font-weight:bold">new</span>[] 
{  
  <span style="color:#000;font-weight:bold">new</span> SqlMetaData(<span style="color:#d14">&#34;Ordinal&#34;</span>, SqlDbType.Int, <span style="color:#000;font-weight:bold">true</span>, <span style="color:#000;font-weight:bold">false</span>, SortOrder.Unspecified, -<span style="color:#099">1</span>),   
  <span style="color:#000;font-weight:bold">new</span> SqlMetaData(<span style="color:#d14">&#34;Name&#34;</span>, SqlDbType.NVarChar, <span style="color:#099">200</span>)
};

sqlRecords = <span style="color:#000;font-weight:bold">new</span> HashSet&lt;SqlDataRecord&gt;(usersToInclude.Select(user =&gt;
{   
  <span style="color:#458;font-weight:bold">var</span> record = <span style="color:#000;font-weight:bold">new</span> SqlDataRecord(sqlMetaData);   
  record.SetString(<span style="color:#099">1</span>, user.Name);   
  <span style="color:#000;font-weight:bold">return</span> record; 
}));
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/ado.net">ado.net</a></li>
										
										<li><a href="../../tags/c">C</a></li>
										
										<li><a href="../../tags/t-sql">t-sql</a></li>
										
									</ul>
								
							
						</div></div>
				
				

<ul class="pagination">
	<li class="page-item page-prev">
	
    <a href="../../page/3/" class="page-link" aria-label="Previous"><span aria-hidden="true">← Prev page</span></a>
	
	</li>
	<li class="page-item page-next">
	
    <a href="../../page/5/" class="page-link" aria-label="Next"><span aria-hidden="true">Next page →</span></a>
	
	</li>
</ul>


			</div>
		</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2021  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-2585435-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
