<!DOCTYPE html>
<html>
<head>
	<meta name="generator" content="Hugo 0.92.2" />
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Tim Van Wassenhove - Passionate geek, interested in Technology. Proud father of two </title><meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="alternate" type="application/rss+xml" href="https://timvw.be/feed.xml" title="Tim Van Wassenhove" />
	<meta itemprop="name" content="Tim Van Wassenhove">
<meta itemprop="description" content=""><meta property="og:title" content="Tim Van Wassenhove" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://timvw.be/" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Tim Van Wassenhove"/>
<meta name="twitter:description" content=""/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://timvw.be/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://timvw.be/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="https://timvw.be/">Tim Van Wassenhove</a></h1>
	<div class="site-description"><p>Passionate geek, interested in Technology. Proud father of two</p><nav class="nav social">
			<ul class="flat"><li><a href="https://twitter.com/timvw" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://github.com/timvw" title="Github"><i data-feather="github"></i></a></li><li><a href="https://www.linkedin.com/in/timvanwassenhove" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="https://timvw.be/feed.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="../../">Home</a>
			</li>
			
			<li>
				<a href="../../posts">All posts</a>
			</li>
			
			<li>
				<a href="../../tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="recent-posts section">
			<div class="posts">
				
				
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">07</span>
										<span class="rest">Feb 2007</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Don&#39;t wait until the DateTimePicker has lost focus to write back the values</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Drag a TextBox and a DateTimePicker control on a Form and databind them to a DateTime property, eg</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">partial</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Form1</span> : Form
{
	<span style="color:#000;font-weight:bold">public</span> Form1()
	{
		InitializeComponent();

		SimpleObject simpleObject = <span style="color:#000;font-weight:bold">new</span> SimpleObject();
		simpleObject.Birthday = DateTime.Now;

		<span style="color:#000;font-weight:bold">this</span>.dateTimePicker1.DataBindings.Add(<span style="color:#d14">&#34;Value&#34;</span>, simpleObject, <span style="color:#d14">&#34;Birthday&#34;</span>);
		<span style="color:#000;font-weight:bold">this</span>.textBox1.DataBindings.Add(<span style="color:#d14">&#34;Text&#34;</span>, simpleObject, <span style="color:#d14">&#34;Birthday&#34;</span>, <span style="color:#000;font-weight:bold">true</span>, DataSourceUpdateMode.OnPropertyChanged);
	}
}

<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SimpleObject</span> : INotifyPropertyChanged
{
	<span style="color:#000;font-weight:bold">private</span> DateTime birthday;

	<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">event</span> PropertyChangedEventHandler PropertyChanged;

	<span style="color:#000;font-weight:bold">public</span> DateTime Birthday
	{
		<span style="color:#000;font-weight:bold">get</span> { <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span>.birthday; }
		<span style="color:#000;font-weight:bold">set</span>
		{
		<span style="color:#000;font-weight:bold">this</span>.birthday = <span style="color:#000;font-weight:bold">value</span>;
		<span style="color:#000;font-weight:bold">this</span>.OnPropertyChanged(<span style="color:#d14">&#34;Birthday&#34;</span>);
		}
	}

	<span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">void</span> OnPropertyChanged(<span style="color:#458;font-weight:bold">string</span> propertyName)
	{
		<span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">this</span>.PropertyChanged != <span style="color:#000;font-weight:bold">null</span>)
		{
			<span style="color:#000;font-weight:bold">this</span>.PropertyChanged(<span style="color:#000;font-weight:bold">this</span>, <span style="color:#000;font-weight:bold">new</span> PropertyChangedEventArgs(propertyName));
		}
	}
}
</code></pre></div><p>The annoying bit is that every time the user picks a datetime, he has to move the focus before the changes in the DateTimePicker control are written back to the datasource&hellip; You can circumvent this by handling the CloseUp event of the DataTimePicker as following</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">void</span> dateTimePicker1_CloseUp(<span style="color:#458;font-weight:bold">object</span> sender, EventArgs e)
{
	DateTimePicker dateTimePicker = sender <span style="color:#000;font-weight:bold">as</span> DateTimePicker;
	<span style="color:#000;font-weight:bold">if</span> (dateTimePicker != <span style="color:#000;font-weight:bold">null</span>)
	{
		<span style="color:#000;font-weight:bold">foreach</span> (Binding binding <span style="color:#000;font-weight:bold">in</span> dateTimePicker.DataBindings)
		{
			binding.WriteValue();
		}
	}
}
</code></pre></div><p>I think mosts users will appreciate this new behaviour ðŸ™‚ We can also apply this technique on a ComboBox (using the SelectionChangeCommitted event). Instead of manually hooking up to all these events, i&rsquo;ve implemented an IExtenderProvider that takes care of this tedious task (only showing the part for the datetimepicker)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#008080">[ProvideProperty(&#34;WriteValuesAfterCloseUp&#34;, typeof(DateTimePicker))]</span>
<span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">WriteValueAfterEventExtender</span> : Component, IExtenderProvider
{
	<span style="color:#000;font-weight:bold">private</span> Dictionary&lt;dateTimePicker, <span style="color:#458;font-weight:bold">bool</span>&gt; writeValuesAfterCloseUp;

	<span style="color:#000;font-weight:bold">public</span> WriteValueAfterEventExtender()
	{
		<span style="color:#000;font-weight:bold">this</span>.writeValuesAfterCloseUp = <span style="color:#000;font-weight:bold">new</span> Dictionary&lt;dateTimePicker, <span style="color:#458;font-weight:bold">bool</span>&gt;();
	}

	<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">bool</span> CanExtend(<span style="color:#458;font-weight:bold">object</span> extendee)
	{
		<span style="color:#000;font-weight:bold">return</span> extendee <span style="color:#000;font-weight:bold">is</span> DateTimePicker;
	}
<span style="color:#008080">
</span><span style="color:#008080">	[Description(&#34;Gets a boolean indicating if the values are written to the datasource after a CloseUp event.&#34;)]</span>
	<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">bool</span> GetWriteValuesAfterCloseUp(DateTimePicker dateTimePicker)
	{
		<span style="color:#458;font-weight:bold">bool</span> <span style="color:#000;font-weight:bold">value</span>;
		<span style="color:#000;font-weight:bold">if</span> (!<span style="color:#000;font-weight:bold">this</span>.writeValuesAfterCloseUp.TryGetValue(dateTimePicker, <span style="color:#000;font-weight:bold">out</span> <span style="color:#000;font-weight:bold">value</span>))
		{
			<span style="color:#000;font-weight:bold">value</span> = <span style="color:#000;font-weight:bold">false</span>;
		}
		<span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">value</span>;
	}

	<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">void</span> SetWriteValuesAfterCloseUp(DateTimePicker dateTimePicker, <span style="color:#458;font-weight:bold">bool</span> <span style="color:#000;font-weight:bold">value</span>)
	{
		<span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">this</span>.writeValuesAfterCloseUp.ContainsKey(dateTimePicker))
		{
			<span style="color:#000;font-weight:bold">this</span>.writeValuesAfterCloseUp[dateTimePicker] = <span style="color:#000;font-weight:bold">value</span>;
		}
		<span style="color:#000;font-weight:bold">else</span>
		{
			<span style="color:#000;font-weight:bold">this</span>.writeValuesAfterCloseUp.Add(dateTimePicker, <span style="color:#000;font-weight:bold">value</span>);
		}

		<span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">value</span>)
		{
			dateTimePicker.CloseUp += <span style="color:#000;font-weight:bold">this</span>.dateTimePicker_CloseUp;
		}
		<span style="color:#000;font-weight:bold">else</span>
		{
			dateTimePicker.CloseUp -= <span style="color:#000;font-weight:bold">this</span>.dateTimePicker_CloseUp;
		}
	}

	<span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">void</span> dateTimePicker_CloseUp(<span style="color:#458;font-weight:bold">object</span> sender, EventArgs e)
	{
		DateTimePicker dateTimePicker = sender <span style="color:#000;font-weight:bold">as</span> DateTimePicker;
		<span style="color:#000;font-weight:bold">if</span> (dateTimePicker != <span style="color:#000;font-weight:bold">null</span>)
		{
			<span style="color:#000;font-weight:bold">foreach</span> (Binding binding <span style="color:#000;font-weight:bold">in</span> dateTimePicker.DataBindings)
			{
				binding.WriteValue();
			}
		}
	}
}
</code></pre></div><p>As soon as you drop an instance of the WriteValueAfterEditExtender component on your designer form you will see the that an extra property appears on the datetimepicker</p>
<p><img src="http://www.timvw.be/wp-content/images/writevalueaftereventextender.gif" alt="image of the propertylist for datetimepicker"></p>
<p>As always, feel free to download the <a href="http://www.timvw.be/wp-content/code/csharp/ExtenderProvider.zip">ExtenderProvider.zip</a>.</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
										<li><a href="../../tags/windows-forms">Windows Forms</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">04</span>
										<span class="rest">Feb 2007</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Control the order of Properties in your Class</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Sometimes you want to manipulate the order in which properties are used for databinding. Eg: If you drag and drop an object datasource on a DataGridView you have no control in which order it binds the properties. Offcourse, you can order the columns by moving them around&hellip; Today someone asked the following</p>
<blockquote>
<!-- raw HTML omitted -->
</blockquote>
<p>I started with the implementation of a PropertyOrderAttribute</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#008080">[AttributeUsage(AttributeTargets.Property)]</span>
<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PropertyOrderAttribute</span> : Attribute
{
	<span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">int</span> order;

	<span style="color:#000;font-weight:bold">public</span> PropertyOrderAttribute(<span style="color:#458;font-weight:bold">int</span> order)
	{
		<span style="color:#000;font-weight:bold">this</span>.order = order;
	}

	<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span> Order
	{
		<span style="color:#000;font-weight:bold">get</span> { <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span>.order; }
	}
}
</code></pre></div><p>So the user can use this attribute to define the order in which the properties should appear as following</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Foo</span>
{
	<span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">int</span> id;
	<span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">string</span> name;
	<span style="color:#000;font-weight:bold">private</span> DateTime birthDay;

	<span style="color:#000;font-weight:bold">public</span> Foo(<span style="color:#458;font-weight:bold">int</span> id, <span style="color:#458;font-weight:bold">string</span> name, DateTime birthDay)
	{
		<span style="color:#000;font-weight:bold">this</span>.id = id;
		<span style="color:#000;font-weight:bold">this</span>.name = name;
		<span style="color:#000;font-weight:bold">this</span>.birthDay = birthDay;
	}
<span style="color:#008080">
</span><span style="color:#008080">	[PropertyOrder(0)]</span>
	<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span> Id
	{
		<span style="color:#000;font-weight:bold">get</span> { <span style="color:#000;font-weight:bold">return</span> id; }
		<span style="color:#000;font-weight:bold">set</span> { id = <span style="color:#000;font-weight:bold">value</span>; }
	}
<span style="color:#008080">
</span><span style="color:#008080">	[PropertyOrder(2)]</span>
	<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">string</span> Name
	{
		<span style="color:#000;font-weight:bold">get</span> { <span style="color:#000;font-weight:bold">return</span> name; }
		<span style="color:#000;font-weight:bold">set</span> { name = <span style="color:#000;font-weight:bold">value</span>; }
	}
<span style="color:#008080">
</span><span style="color:#008080">	[PropertyOrder(1)]</span>
	<span style="color:#000;font-weight:bold">public</span> DateTime BirthDay
	{
		<span style="color:#000;font-weight:bold">get</span> { <span style="color:#000;font-weight:bold">return</span> birthDay; }
		<span style="color:#000;font-weight:bold">set</span> { birthDay = <span style="color:#000;font-weight:bold">value</span>; }
	}
}
</code></pre></div><p>And now i implement a generic BindingList that makes use of the PropertyOrderAttributes</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PropertyOrderBindingList</span>&lt;T&gt; : BindingList&lt;T&gt;, ITypedList
{
	<span style="color:#000;font-weight:bold">public</span> PropertyOrderBindingList()
	: <span style="color:#000;font-weight:bold">base</span>()
	{ }

	<span style="color:#000;font-weight:bold">public</span> PropertyDescriptorCollection GetItemProperties(PropertyDescriptor[] listAccessors)
	{
		PropertyDescriptorCollection typePropertiesCollection = TypeDescriptor.GetProperties(<span style="color:#000;font-weight:bold">typeof</span>(T));
		<span style="color:#000;font-weight:bold">return</span> typePropertiesCollection.Sort(<span style="color:#000;font-weight:bold">new</span> PropertyDescriptorComparer());
	}

	<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">string</span> GetListName(PropertyDescriptor[] listAccessors)
	{
		<span style="color:#000;font-weight:bold">return</span> <span style="color:#458;font-weight:bold">string</span>.Format(<span style="color:#d14">&#34;A list with Properties for {0}&#34;</span>, <span style="color:#000;font-weight:bold">typeof</span>(T).Name);
	}
}

<span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PropertyDescriptorComparer</span> : IComparer
{
	<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span> Compare(<span style="color:#458;font-weight:bold">object</span> x, <span style="color:#458;font-weight:bold">object</span> y)
	{
		<span style="color:#000;font-weight:bold">if</span> (x == y) <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">0</span>;
		<span style="color:#000;font-weight:bold">if</span> (x == <span style="color:#000;font-weight:bold">null</span>) <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">1</span>;
		<span style="color:#000;font-weight:bold">if</span> (y == <span style="color:#000;font-weight:bold">null</span>) <span style="color:#000;font-weight:bold">return</span> -<span style="color:#099">1</span>;

		PropertyDescriptor propertyDescriptorX = x <span style="color:#000;font-weight:bold">as</span> PropertyDescriptor;
		PropertyDescriptor propertyDescriptorY = y <span style="color:#000;font-weight:bold">as</span> PropertyDescriptor;

		PropertyOrderAttribute propertyOrderAttributeX = propertyDescriptorX.Attributes[<span style="color:#000;font-weight:bold">typeof</span>(PropertyOrderAttribute)] <span style="color:#000;font-weight:bold">as</span> PropertyOrderAttribute;
		PropertyOrderAttribute propertyOrderAttributeY = propertyDescriptorY.Attributes[<span style="color:#000;font-weight:bold">typeof</span>(PropertyOrderAttribute)] <span style="color:#000;font-weight:bold">as</span> PropertyOrderAttribute;

		<span style="color:#000;font-weight:bold">if</span> (propertyOrderAttributeX == propertyOrderAttributeY) <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">0</span>;
		<span style="color:#000;font-weight:bold">if</span> (propertyOrderAttributeX == <span style="color:#000;font-weight:bold">null</span>) <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">1</span>;
		<span style="color:#000;font-weight:bold">if</span> (propertyOrderAttributeY == <span style="color:#000;font-weight:bold">null</span>) <span style="color:#000;font-weight:bold">return</span> -<span style="color:#099">1</span>;

		<span style="color:#000;font-weight:bold">return</span> propertyOrderAttributeX.Order.CompareTo(propertyOrderAttributeY.Order);
	}
}
</code></pre></div><p>With all this infrastructure it becomes as easy as</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> Form1()
{
	InitializeComponent();

	PropertyOrderBindingList&lt;foo&gt; fooList = <span style="color:#000;font-weight:bold">new</span> PropertyOrderBindingList&lt;foo&gt;();
	fooList.Add(<span style="color:#000;font-weight:bold">new</span> Foo(<span style="color:#099">1</span>, <span style="color:#d14">&#34;Timvw&#34;</span>, <span style="color:#000;font-weight:bold">new</span> DateTime(<span style="color:#099">1980</span>, <span style="color:#099">4</span>, <span style="color:#099">30</span>)));
	fooList.Add(<span style="color:#000;font-weight:bold">new</span> Foo(<span style="color:#099">2</span>, <span style="color:#d14">&#34;Mike&#34;</span>, <span style="color:#000;font-weight:bold">new</span> DateTime(<span style="color:#099">1984</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>)));
	<span style="color:#000;font-weight:bold">this</span>.dataGridView1.DataSource = fooList;
}
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
										<li><a href="../../tags/windows-forms">Windows Forms</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">29</span>
										<span class="rest">Jan 2007</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">About the Wow, i removed Vista from my harddisk, experience</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>A couple of weeks ago i decided to install Vista Ultimate&hellip; Despite the marketing efforts my only <a href="http://www.experiencethewow.be/">Wow</a> experience was yesterday when i decided to remove it&hellip; (Simply boot with your XP installation cd, run fixboot and fixmbr from the rescue console and you&rsquo;re set ;))</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/events">Events</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">27</span>
										<span class="rest">Jan 2007</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Presenting the DataGridViewLargeTextBoxCell</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Today i decided to experiment a bit with custom <a href="http://msdn2.microsoft.com/en-us/library/system.windows.forms.datagridviewcell.aspx">DataGridViewCell</a> implementations. If you insert large text into a DataGridView it will (at best) wrap the text. I wanted my DataGridView to behave like <a href="http://office.microsoft.com/excel/">Excel</a> so that the whole text is displayed. Here are a couple of screenshots of the result</p>
<p><img src="http://www.timvw.be/wp-content/images/datagridviewlargetextboxcell-1.gif" alt="the large text flows over it&rsquo;s surrounding columns"></p>
<p><img src="http://www.timvw.be/wp-content/images/datagridviewlargetextboxcell-2.gif" alt="the editingcontrol is resized to fit the complete text"></p>
<p>Feel free to download <a href="http://www.timvw.be/wp-content/code/csharp/CustomDataGridViewCells.zip">CustomDataGridViewCells.zip</a>.</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
										<li><a href="../../tags/windows-forms">Windows Forms</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">21</span>
										<span class="rest">Jan 2007</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">About Thread-Safe GUI...</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>If you&rsquo;re writing windows applications you&rsquo;ll most certainly recognize the following piece of code</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">delegate</span> <span style="color:#000;font-weight:bold">void</span> UpdateIntResultDelegate(<span style="color:#458;font-weight:bold">int</span> result);

<span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">void</span> UpdateIntResult(<span style="color:#458;font-weight:bold">int</span> result)
{
	<span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">this</span>.labelIntResult.InvokeRequired)
		<span style="color:#000;font-weight:bold">this</span>.labelIntResult.Invoke(<span style="color:#000;font-weight:bold">new</span> UpdateIntResultDelegate(<span style="color:#000;font-weight:bold">this</span>.UpdateIntResult), result);
	<span style="color:#000;font-weight:bold">else</span>
		<span style="color:#000;font-weight:bold">this</span>.myDataSource.IntResult = result;
}

<span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">delegate</span> <span style="color:#000;font-weight:bold">void</span> UpdateStringResultDelegate(<span style="color:#458;font-weight:bold">string</span> result);

<span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">void</span> UpdateStringResult(<span style="color:#458;font-weight:bold">string</span> result)
{
	<span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">this</span>.labelStringResult.InvokeRequired)
		<span style="color:#000;font-weight:bold">this</span>.labelStringResult.Invoke(<span style="color:#000;font-weight:bold">new</span> UpdateStringResultDelegate(<span style="color:#000;font-weight:bold">this</span>.UpdateStringResult), result);
	<span style="color:#000;font-weight:bold">else</span>
		<span style="color:#000;font-weight:bold">this</span>.myDataSource.StringResult = result;
}
</code></pre></div><p>Today i was fed up with defining all these Delegates.. So i decided to define a generic delegate instead</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">delegate</span> <span style="color:#000;font-weight:bold">void</span> Delegate&lt;t&gt;(T t);
</code></pre></div><p>And now i can reuse this Delegate for my two update methods</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">void</span> UpdateIntResult(<span style="color:#458;font-weight:bold">int</span> result)
{
	<span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">this</span>.labelIntResult.InvokeRequired)
		<span style="color:#000;font-weight:bold">this</span>.labelIntResult.Invoke(<span style="color:#000;font-weight:bold">new</span> Delegate&lt;<span style="color:#458;font-weight:bold">int</span>&gt;(<span style="color:#000;font-weight:bold">this</span>.UpdateIntResult), result);
	<span style="color:#000;font-weight:bold">else</span>
		<span style="color:#000;font-weight:bold">this</span>.myDataSource.IntResult = result;
}

<span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">void</span> UpdateStringResult(<span style="color:#458;font-weight:bold">string</span> result)
{
	<span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">this</span>.labelStringResult.InvokeRequired)
		<span style="color:#000;font-weight:bold">this</span>.labelStringResult.Invoke(<span style="color:#000;font-weight:bold">new</span> Delegate&lt;<span style="color:#458;font-weight:bold">string</span>&gt;(<span style="color:#000;font-weight:bold">this</span>.UpdateStringResult), result);
	<span style="color:#000;font-weight:bold">else</span>
		<span style="color:#000;font-weight:bold">this</span>.myDataSource.StringResult = result;
}
</code></pre></div><p>Apparently (and not surprisingly) i&rsquo;m not the first to come up with this idea, a little websearch for &lsquo;Generic Delegate&rsquo; learned me that <a href="http://weblogs.asp.net/rosherove/default.aspx">Roy Osherove</a> blogged about it in: <a href="http://weblogs.asp.net/rosherove/archive/2006/03/01/439309.aspx">The 3 ways to create a Thread-Safe GUI with .NET 2.0, with one clear winner</a>. After reading the article i decided to take the following approach (The call to UpdateIntResult is type-safe, it only calls Invoke when it&rsquo;s required and no duplication)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">void</span> UpdateIntResult(<span style="color:#458;font-weight:bold">int</span> result)
{
	<span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">this</span>.labelIntResult.InvokeRequired)
	{
		<span style="color:#000;font-weight:bold">this</span>.labelIntResult.Invoke(<span style="color:#000;font-weight:bold">new</span> MethodInvoker(<span style="color:#000;font-weight:bold">delegate</span> { <span style="color:#000;font-weight:bold">this</span>.UpdateIntResult(result); }));
	}
	<span style="color:#000;font-weight:bold">else</span>
	{
		<span style="color:#000;font-weight:bold">this</span>.myDataSource.IntResult = result;
	}
}
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
										<li><a href="../../tags/windows-forms">Windows Forms</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">20</span>
										<span class="rest">Jan 2007</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Reading and writing unmanged structs from binary files</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>I still remember one of the first tasks during my internship (At a software shop that still used Visual Studio 6 as development environment) last year: Develop a GUI application using .Net that allows the user to manipulate data stored in a binary file which was generated by c/c++ program. As a newcomer to C# programming i just couldn&rsquo;t find the right attributes to <a href="http://msdn2.microsoft.com/en-us/library/04fy9ya1.aspx">Marshal</a> the following structs</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#000;font-weight:bold">struct</span> <span style="color:#458;font-weight:bold">test1</span> {
	<span style="color:#458;font-weight:bold">char</span> name[<span style="color:#099">9</span>];
	<span style="color:#458;font-weight:bold">int</span> score;
};

<span style="color:#000;font-weight:bold">struct</span> <span style="color:#458;font-weight:bold">test2</span> {
	test1 items[<span style="color:#099">10</span>];
}
</code></pre></div><p>After a couple of days they wanted me to deliver a product, so i decided to stop experimenting and wrote the application in C++ (<a href="http://www.timvw.be/reading-unmanaged-structs-with-net/">Example</a>). Since i don&rsquo;t like unanswered questions, i decided to give it another try this afternoon&hellip; It didn&rsquo;t take long to come up with the following</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#008080">[StructLayout(LayoutKind.Sequential, CharSet=CharSet.Ansi, Pack=4)]</span>
<span style="color:#000;font-weight:bold">struct</span> <span style="color:#458;font-weight:bold">Test1</span>
{
<span style="color:#008080">	[MarshalAs(UnmanagedType.ByValTStr, SizeConst=9)]</span>
	<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">string</span> Name;
	<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span> Score;
}
<span style="color:#008080">
</span><span style="color:#008080">[StructLayout(LayoutKind.Sequential, CharSet=CharSet.Ansi, Pack=4)]</span>
<span style="color:#000;font-weight:bold">struct</span> <span style="color:#458;font-weight:bold">Test2</span>
{
<span style="color:#008080">	[MarshalAs(UnmanagedType.ByValArray, SizeConst=10)]</span>
	<span style="color:#000;font-weight:bold">public</span> Test1[] Items;
}

<span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">object</span> Read(Stream stream, Type t)
{
	<span style="color:#458;font-weight:bold">byte</span>[] buffer = <span style="color:#000;font-weight:bold">new</span> <span style="color:#458;font-weight:bold">byte</span>[Marshal.SizeOf(t)];
	<span style="color:#000;font-weight:bold">for</span> (<span style="color:#458;font-weight:bold">int</span> read = <span style="color:#099">0</span>; read &lt; buffer.Length; read += stream.Read(buffer, read, buffer.Length)) ; 
	GCHandle gcHandle = GCHandle.Alloc(buffer, GCHandleType.Pinned); 
	<span style="color:#458;font-weight:bold">object</span> o = Marshal.PtrToStructure(gcHandle.AddrOfPinnedObject(), t); 
	gcHandle.Free(); <span style="color:#000;font-weight:bold">return</span> o; 
} 
	
<span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">void</span> Write(Stream stream, <span style="color:#458;font-weight:bold">object</span> o) 
{ 
	<span style="color:#458;font-weight:bold">byte</span>[] buffer = <span style="color:#000;font-weight:bold">new</span> <span style="color:#458;font-weight:bold">byte</span>[Marshal.SizeOf(o.GetType())]; 
	GCHandle gcHandle = GCHandle.Alloc(buffer, GCHandleType.Pinned); 
	Marshal.StructureToPtr(o, gcHandle.AddrOfPinnedObject(), <span style="color:#000;font-weight:bold">true</span>); 
	stream.Write(buffer, <span style="color:#099">0</span>, buffer.Length); 
	gcHandle.Free(); 
} 

<span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">void</span> Main(<span style="color:#458;font-weight:bold">string</span>[] args) 
{ 
	Test1 test1 = <span style="color:#000;font-weight:bold">new</span> Test1(); 
	test1.Name = <span style="color:#d14">&#34;timvw&#34;</span>; 
	test1.Score = <span style="color:#099">100</span>; 
	<span style="color:#000;font-weight:bold">using</span> (FileStream fileStream = <span style="color:#000;font-weight:bold">new</span> FileStream(<span style="color:#d14">@&#34;c:\test.dat&#34;</span>, FileMode.OpenOrCreate)) 
	{ 
		Write(fileStream, test1); 
		fileStream.Seek(<span style="color:#099">0</span>, SeekOrigin.Begin); 
		Test1 test2 = (Test1) 
		Read(fileStream, <span style="color:#000;font-weight:bold">typeof</span>(Test1)); 
		Console.WriteLine(<span style="color:#d14">&#34;Name: {0} Score: {1}&#34;</span>, test2.Name, test2.Score); 
	} 
	Console.Write(<span style="color:#d14">&#34;{0}Press any key to continue...&#34;</span>, Environment.NewLine); 
	Console.ReadKey(); 
}
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">17</span>
										<span class="rest">Jan 2007</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Exploring DataGridViewComboBoxColumn databinding</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Let&rsquo;s start with a simple example: Each Person has a Name (string) and PersonTypeCode (an Enumerated value) property. We drag a DataGridView on the designer form and add two columns (DataGridViewComboBoxColumn for the PersonTypeCode property). And then we hook up the Bindingsource as following</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Form1</span> : Form
{
	<span style="color:#000;font-weight:bold">public</span> Form1()
	{
		InitializeComponent();

		<span style="color:#000;font-weight:bold">this</span>.dataGridView1.AutoGenerateColumns = <span style="color:#000;font-weight:bold">false</span>;
		<span style="color:#000;font-weight:bold">this</span>.ColumnName.DataPropertyName = <span style="color:#d14">&#34;Name&#34;</span>;
		<span style="color:#000;font-weight:bold">this</span>.ColumnPersonTypeCode.DataPropertyName = <span style="color:#d14">&#34;PersonTypeCode&#34;</span>;

		BindingSource bindingSource = <span style="color:#000;font-weight:bold">new</span> BindingSource();
		bindingSource.DataSource = FindPersons();
		<span style="color:#000;font-weight:bold">this</span>.dataGridView1.DataSource = bindingSource;
	}

	<span style="color:#000;font-weight:bold">private</span> BindingList&lt;person&gt; FindPersons()
	{
		BindingList&lt;person&gt; bindingList = <span style="color:#000;font-weight:bold">new</span> BindingList&lt;person&gt;();
		bindingList.Add(<span style="color:#000;font-weight:bold">new</span> Person(<span style="color:#d14">&#34;Timvw&#34;</span>, PersonTypeCode.Geek));
		bindingList.Add(<span style="color:#000;font-weight:bold">new</span> Person(<span style="color:#d14">&#34;John Doe&#34;</span>, PersonTypeCode.Anonymous));
		bindingList.Add(<span style="color:#000;font-weight:bold">new</span> Person(<span style="color:#d14">&#34;An Onymous&#34;</span>, PersonTypeCode.Anonymous));
		bindingList.Add(<span style="color:#000;font-weight:bold">new</span> Person(<span style="color:#d14">&#34;Jenna Jameson&#34;</span>, PersonTypeCode.Babe));
		<span style="color:#000;font-weight:bold">return</span> bindingList;
	}
}

<span style="color:#000;font-weight:bold">enum</span> PersonTypeCode
{
	Geek = <span style="color:#099">0</span>,
	Anonymous = <span style="color:#099">1</span>,
	Babe = <span style="color:#099">2</span>
}

<span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Person</span>
{
	<span style="color:#000;font-weight:bold">private</span> PersonTypeCode personTypeCode;
	<span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">string</span> name;

	<span style="color:#000;font-weight:bold">public</span> Person(<span style="color:#458;font-weight:bold">string</span> name, PersonTypeCode personTypeCode)
	{
		<span style="color:#000;font-weight:bold">this</span>.name = name;
		<span style="color:#000;font-weight:bold">this</span>.personTypeCode = personTypeCode;
	}

	<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">string</span> Name
	{
		<span style="color:#000;font-weight:bold">get</span> { <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span>.name; }
		<span style="color:#000;font-weight:bold">set</span> { <span style="color:#000;font-weight:bold">this</span>.name = <span style="color:#000;font-weight:bold">value</span>; }
	}

	<span style="color:#000;font-weight:bold">public</span> PersonTypeCode PersonTypeCode
	{
		<span style="color:#000;font-weight:bold">get</span> { <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span>.personTypeCode; }
		<span style="color:#000;font-weight:bold">set</span> { <span style="color:#000;font-weight:bold">this</span>.personTypeCode = <span style="color:#000;font-weight:bold">value</span>; }
	}
}
</code></pre></div><p>If we run this code we run in the following error:</p>
<p><img src="http://www.timvw.be/wp-content/images/databind-datagridviewcomboboxcolumn-1.gif" alt="DataGridViewComboBoxCell value is not valid."></p>
<p>Always make sure the DataGridViewComboxColumn knows about all the possible values (<a href="http://www.timvw.be/implementing-masterdetail-for-custom-objects-with-datagridviewcomboboxcolumns/">Add them via the Items property</a> or use databinding). Let&rsquo;s extend our Form1 class as following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> Form1()
{
InitializeComponent();

<span style="color:#000;font-weight:bold">this</span>.dataGridView1.AutoGenerateColumns = <span style="color:#000;font-weight:bold">false</span>;
<span style="color:#000;font-weight:bold">this</span>.ColumnName.DataPropertyName = <span style="color:#d14">&#34;Name&#34;</span>;
<span style="color:#000;font-weight:bold">this</span>.ColumnPersonTypeCode.DataPropertyName = <span style="color:#d14">&#34;PersonTypeCode&#34;</span>;
<span style="color:#000;font-weight:bold">this</span>.ColumnPersonTypeCode.DataSource = FindPersonTypeCodes();

BindingSource bindingSource = <span style="color:#000;font-weight:bold">new</span> BindingSource();
bindingSource.DataSource = FindPersons();
<span style="color:#000;font-weight:bold">this</span>.dataGridView1.DataSource = bindingSource;
}

<span style="color:#000;font-weight:bold">private</span> BindingList&lt;personTypeCode&gt; FindPersonTypeCodes()
{
BindingList&lt;personTypeCode&gt; bindingList = <span style="color:#000;font-weight:bold">new</span> BindingList&lt;personTypeCode&gt;();
<span style="color:#000;font-weight:bold">foreach</span> (PersonTypeCode personTypeCode <span style="color:#000;font-weight:bold">in</span> Enum.GetValues(<span style="color:#000;font-weight:bold">typeof</span>(PersonTypeCode)))
{
bindingList.Add(personTypeCode);
}
<span style="color:#000;font-weight:bold">return</span> bindingList;
}
</code></pre></div><p>Allright, here is a screenshot of our first working version:</p>
<p><img src="http://www.timvw.be/wp-content/images/databind-datagridviewcomboboxcolumn-2.gif" alt="datagridviewcomboboxcolumn with enumerated values"></p>
<p>Instead of displaying the bare enum values we want to display a nice label. In order to achieve this we define a class PersonType to hold both the PersonTypeCode and the label:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PersonType</span>
{
<span style="color:#000;font-weight:bold">private</span> PersonTypeCode personTypeCode;
<span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">string</span> label;

<span style="color:#000;font-weight:bold">public</span> PersonType(<span style="color:#458;font-weight:bold">string</span> label, PersonTypeCode personTypeCode)
{
<span style="color:#000;font-weight:bold">this</span>.label = label;
<span style="color:#000;font-weight:bold">this</span>.personTypeCode = personTypeCode;
}

<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">string</span> Label
{
<span style="color:#000;font-weight:bold">get</span> { <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span>.label; }
<span style="color:#000;font-weight:bold">set</span> { <span style="color:#000;font-weight:bold">this</span>.label = <span style="color:#000;font-weight:bold">value</span>; }
}

<span style="color:#000;font-weight:bold">public</span> PersonTypeCode PersonTypeCode
{
<span style="color:#000;font-weight:bold">get</span> { <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span>.personTypeCode; }
<span style="color:#000;font-weight:bold">set</span> { <span style="color:#000;font-weight:bold">this</span>.personTypeCode = <span style="color:#000;font-weight:bold">value</span>; }
}
}
</code></pre></div><p>We modify our code so that this new PersonType class is used for the ComboBoxColumn:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> Form1()
{
InitializeComponent();

<span style="color:#000;font-weight:bold">this</span>.dataGridView1.AutoGenerateColumns = <span style="color:#000;font-weight:bold">false</span>;
<span style="color:#000;font-weight:bold">this</span>.ColumnName.DataPropertyName = <span style="color:#d14">&#34;Name&#34;</span>;
<span style="color:#000;font-weight:bold">this</span>.ColumnPersonTypeCode.DataPropertyName = <span style="color:#d14">&#34;PersonTypeCode&#34;</span>;
<span style="color:#000;font-weight:bold">this</span>.ColumnPersonTypeCode.DisplayMember = <span style="color:#d14">&#34;Label&#34;</span>;
<span style="color:#000;font-weight:bold">this</span>.ColumnPersonTypeCode.ValueMember = <span style="color:#d14">&#34;PersonTypeCode&#34;</span>;
<span style="color:#000;font-weight:bold">this</span>.ColumnPersonTypeCode.DataSource = FindPersonTypes();

BindingSource bindingSource = <span style="color:#000;font-weight:bold">new</span> BindingSource();
bindingSource.DataSource = FindPersons();
<span style="color:#000;font-weight:bold">this</span>.dataGridView1.DataSource = bindingSource;
}

<span style="color:#000;font-weight:bold">private</span> BindingList&lt;personType&gt; FindPersonTypes()
{
BindingList&lt;personType&gt; bindingList = <span style="color:#000;font-weight:bold">new</span> BindingList&lt;personType&gt;();
bindingList.Add(<span style="color:#000;font-weight:bold">new</span> PersonType(<span style="color:#d14">&#34;A geeky person&#34;</span>, PersonTypeCode.Geek));
bindingList.Add(<span style="color:#000;font-weight:bold">new</span> PersonType(<span style="color:#d14">&#34;A coward&#34;</span>, PersonTypeCode.Anonymous));
bindingList.Add(<span style="color:#000;font-weight:bold">new</span> PersonType(<span style="color:#d14">&#34;Feeling hot hot hot&#34;</span>, PersonTypeCode.Babe));
<span style="color:#000;font-weight:bold">return</span> bindingList;
}
</code></pre></div><p><img src="http://www.timvw.be/wp-content/images/databind-datagridviewcomboboxcolumn-3.gif" alt="datagridviewcomboboxcolumn with nice labels."></p>
<p>Great! Now we&rsquo;ll add some functionality that limits the possible values in the ComboBoxColumn basesd on the Name (I already demonstrated this technique <a href="http://www.timvw.be/implementing-masterdetail-for-custom-objects-with-datagridviewcomboboxcolumns/">here</a>). Simply handle the EditingControlShowing Event on the DataGridView as following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">void</span> dataGridView1_EditingControlShowing(<span style="color:#458;font-weight:bold">object</span> sender, DataGridViewEditingControlShowingEventArgs e)
{
BindingSource bindingSource = <span style="color:#000;font-weight:bold">this</span>.dataGridView1.DataSource <span style="color:#000;font-weight:bold">as</span> BindingSource;
Person person = bindingSource.Current <span style="color:#000;font-weight:bold">as</span> Person;
BindingList&lt;personType&gt; bindingList = <span style="color:#000;font-weight:bold">this</span>.FindPersonTypes(person);

DataGridViewComboBoxEditingControl comboBox = e.Control <span style="color:#000;font-weight:bold">as</span> DataGridViewComboBoxEditingControl;
comboBox.DataSource = bindingList;
}

<span style="color:#000;font-weight:bold">private</span> BindingList&lt;personType&gt; FindPersonTypes(Person person)
{
<span style="color:#998;font-style:italic">// by default, all persons simply have one of the available persontypecodes
</span><span style="color:#998;font-style:italic"></span>BindingList&lt;personType&gt; bindingList = FindPersonTypes();

<span style="color:#000;font-weight:bold">if</span> (person.PersonTypeCode == PersonTypeCode.Geek)
{
<span style="color:#998;font-style:italic">// geeks are doomed to stay geeks
</span><span style="color:#998;font-style:italic"></span>bindingList.RemoveAt(<span style="color:#099">2</span>);
bindingList.RemoveAt(<span style="color:#099">1</span>);
}

<span style="color:#000;font-weight:bold">return</span> bindingList;
}
</code></pre></div><p>If you open the combox for &ldquo;Timvw&rdquo; you see that you can only choose &ldquo;A geeky person&rdquo;:</p>
<p><img src="http://www.timvw.be/wp-content/images/databind-datagridviewcomboboxcolumn-4.gif" alt="datagridviewcomboboxcolumn with limited options."></p>
<p>Instead of using an enum we could have used a regular class too. The key is to override the Equals method:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PersonTypeCode</span>
{
<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> PersonTypeCode Geek
{
<span style="color:#000;font-weight:bold">get</span> { <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> PersonTypeCode(<span style="color:#099">0</span>); }
}

<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> PersonTypeCode Anonymous
{
<span style="color:#000;font-weight:bold">get</span> { <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> PersonTypeCode(<span style="color:#099">1</span>); }
}

<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> PersonTypeCode Babe
{
<span style="color:#000;font-weight:bold">get</span> { <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> PersonTypeCode(<span style="color:#099">2</span>); }
}

<span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">int</span> id;

<span style="color:#000;font-weight:bold">public</span> PersonTypeCode(<span style="color:#458;font-weight:bold">int</span> id)
{
<span style="color:#000;font-weight:bold">this</span>.id = id;
}

<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">override</span> <span style="color:#458;font-weight:bold">bool</span> Equals(<span style="color:#458;font-weight:bold">object</span> obj)
{
<span style="color:#000;font-weight:bold">if</span> (obj == <span style="color:#000;font-weight:bold">null</span>) <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span>;
<span style="color:#000;font-weight:bold">if</span> (obj == <span style="color:#000;font-weight:bold">this</span>) <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span>;
PersonTypeCode personTypeCode = obj <span style="color:#000;font-weight:bold">as</span> PersonTypeCode;
<span style="color:#000;font-weight:bold">if</span> (personTypeCode == <span style="color:#000;font-weight:bold">null</span>) <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span>;
<span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span>.id == personTypeCode.id;
}

<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">override</span> <span style="color:#458;font-weight:bold">int</span> GetHashCode()
{
<span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span>.id.GetHashCode();
}
}

<span style="color:#000;font-weight:bold">private</span> BindingList&lt;personType&gt; FindPersonTypes(Person person)
{
<span style="color:#998;font-style:italic">// by default, all persons simply have one of the available persontypecodes
</span><span style="color:#998;font-style:italic"></span>BindingList&lt;personType&gt; bindingList = FindPersonTypes();

<span style="color:#998;font-style:italic">//if (person.PersonTypeCode == PersonTypeCode.Geek)
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">if</span> (person.PersonTypeCode.Equals(PersonTypeCode.Geek))
{
<span style="color:#998;font-style:italic">// geeks are doomed to stay geeks
</span><span style="color:#998;font-style:italic"></span>bindingList.RemoveAt(<span style="color:#099">2</span>);
bindingList.RemoveAt(<span style="color:#099">1</span>);
}

<span style="color:#000;font-weight:bold">return</span> bindingList;
}
</code></pre></div><p>And now you&rsquo;re thinking: But i want the user to not select a PersonTypeCode (null). We&rsquo;ll represent that with an empty string &ldquo;&quot;:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">private</span> BindingList&lt;person&gt; FindPersons()
{
BindingList&lt;person&gt; bindingList = <span style="color:#000;font-weight:bold">new</span> BindingList&lt;person&gt;();
bindingList.Add(<span style="color:#000;font-weight:bold">new</span> Person(<span style="color:#d14">&#34;Timvw&#34;</span>, PersonTypeCode.Geek));
bindingList.Add(<span style="color:#000;font-weight:bold">new</span> Person(<span style="color:#d14">&#34;John Doe&#34;</span>, PersonTypeCode.Anonymous));
bindingList.Add(<span style="color:#000;font-weight:bold">new</span> Person(<span style="color:#d14">&#34;An Onymous&#34;</span>, PersonTypeCode.Anonymous));
bindingList.Add(<span style="color:#000;font-weight:bold">new</span> Person(<span style="color:#d14">&#34;Jenna Jameson&#34;</span>, PersonTypeCode.Babe));
bindingList.Add(<span style="color:#000;font-weight:bold">new</span> Person(<span style="color:#d14">&#34;Null Able&#34;</span>, <span style="color:#000;font-weight:bold">null</span>));
<span style="color:#000;font-weight:bold">return</span> bindingList;
}

<span style="color:#000;font-weight:bold">private</span> BindingList&lt;personType&gt; FindPersonTypes()
{
BindingList&lt;personType&gt; bindingList = <span style="color:#000;font-weight:bold">new</span> BindingList&lt;personType&gt;();
bindingList.Add(<span style="color:#000;font-weight:bold">new</span> PersonType(<span style="color:#d14">&#34;A geeky person&#34;</span>, PersonTypeCode.Geek));
bindingList.Add(<span style="color:#000;font-weight:bold">new</span> PersonType(<span style="color:#d14">&#34;A coward&#34;</span>, PersonTypeCode.Anonymous));
bindingList.Add(<span style="color:#000;font-weight:bold">new</span> PersonType(<span style="color:#d14">&#34;Feeling hot hot hot&#34;</span>, PersonTypeCode.Babe));
bindingList.Add(<span style="color:#000;font-weight:bold">new</span> PersonType(<span style="color:#458;font-weight:bold">string</span>.Empty, <span style="color:#000;font-weight:bold">null</span>));
<span style="color:#000;font-weight:bold">return</span> bindingList;
}

<span style="color:#000;font-weight:bold">private</span> BindingList&lt;personType&gt; FindPersonTypes(Person person)
{
<span style="color:#998;font-style:italic">// by default, all persons simply have one of the available persontypecodes
</span><span style="color:#998;font-style:italic"></span>BindingList&lt;personType&gt; bindingList = FindPersonTypes();

<span style="color:#000;font-weight:bold">if</span> (person.PersonTypeCode != <span style="color:#000;font-weight:bold">null</span> &amp;&amp; person.PersonTypeCode.Equals(PersonTypeCode.Geek))
{
<span style="color:#998;font-style:italic">// geeks are doomed to stay geeks
</span><span style="color:#998;font-style:italic"></span>bindingList.RemoveAt(<span style="color:#099">2</span>);
bindingList.RemoveAt(<span style="color:#099">1</span>);
}

<span style="color:#000;font-weight:bold">return</span> bindingList;
}
</code></pre></div><p><img src="http://www.timvw.be/wp-content/images/databind-datagridviewcomboboxcolumn-5.gif" alt="datagridviewcomboboxcolumn with null option."></p>
<p>When the user starts editing the record, the combobox will choose the first item in the list (A geeky person). Now we change this behaviour so that the actual PersonTypeCode is selected:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">void</span> dataGridView1_EditingControlShowing(<span style="color:#458;font-weight:bold">object</span> sender, DataGridViewEditingControlShowingEventArgs e)
{
<span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">this</span>.dataGridView1.CurrentCell.ColumnIndex == <span style="color:#000;font-weight:bold">this</span>.ColumnPersonTypeCode.Index)
{
BindingSource bindingSource = <span style="color:#000;font-weight:bold">this</span>.dataGridView1.DataSource <span style="color:#000;font-weight:bold">as</span> BindingSource;
Person person = bindingSource.Current <span style="color:#000;font-weight:bold">as</span> Person;
BindingList&lt;personType&gt; bindingList = <span style="color:#000;font-weight:bold">this</span>.FindPersonTypes(person);

DataGridViewComboBoxEditingControl comboBox = e.Control <span style="color:#000;font-weight:bold">as</span> DataGridViewComboBoxEditingControl;
comboBox.DataSource = bindingList;
<span style="color:#000;font-weight:bold">if</span> (person.PersonTypeCode != <span style="color:#000;font-weight:bold">null</span>)
{
comboBox.SelectedValue = person.PersonTypeCode;
}
<span style="color:#000;font-weight:bold">else</span>
{
comboBox.SelectedValue = <span style="color:#458;font-weight:bold">string</span>.Empty;
}
}
}
</code></pre></div><p><img src="http://www.timvw.be/wp-content/images/databind-datagridviewcomboboxcolumn-6.gif" alt="datagridviewcomboboxcolumn with selected item."></p>
<p>In order to make the DataGridView more usable we set the EditMode property to EditOnEnter. Selected values in the ComboBox are only commited when the user leaves the current cell. Handling the SelectionChangeCommited event on the ComboBox allows us to commit that value without requiring the user to leave the current cell:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">void</span> dataGridView1_EditingControlShowing(<span style="color:#458;font-weight:bold">object</span> sender, DataGridViewEditingControlShowingEventArgs e)
{
<span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">this</span>.dataGridView1.CurrentCell.ColumnIndex == <span style="color:#000;font-weight:bold">this</span>.ColumnPersonTypeCode.Index)
{
BindingSource bindingSource = <span style="color:#000;font-weight:bold">this</span>.dataGridView1.DataSource <span style="color:#000;font-weight:bold">as</span> BindingSource;
Person person = bindingSource.Current <span style="color:#000;font-weight:bold">as</span> Person;
BindingList&lt;personType&gt; bindingList = <span style="color:#000;font-weight:bold">this</span>.FindPersonTypes(person);

DataGridViewComboBoxEditingControl comboBox = e.Control <span style="color:#000;font-weight:bold">as</span> DataGridViewComboBoxEditingControl;
comboBox.DataSource = bindingList;
<span style="color:#000;font-weight:bold">if</span> (person.PersonTypeCode != <span style="color:#000;font-weight:bold">null</span>)
{
comboBox.SelectedValue = person.PersonTypeCode;
}
<span style="color:#000;font-weight:bold">else</span>
{
comboBox.SelectedValue = <span style="color:#458;font-weight:bold">string</span>.Empty;
}

comboBox.SelectionChangeCommitted -= <span style="color:#000;font-weight:bold">this</span>.comboBox_SelectionChangeCommitted;
comboBox.SelectionChangeCommitted += <span style="color:#000;font-weight:bold">this</span>.comboBox_SelectionChangeCommitted;
}
}

<span style="color:#000;font-weight:bold">void</span> comboBox_SelectionChangeCommitted(<span style="color:#458;font-weight:bold">object</span> sender, EventArgs e)
{
<span style="color:#000;font-weight:bold">this</span>.dataGridView1.EndEdit();
}
</code></pre></div><p>Now it&rsquo;s up to you to apply these simple techniques and build great software. Feel free to download the complete source: <a href="http://www.timvw.be/wp-content/code/csharp/DataGridViewComboBoxBinding.zip">DataGridViewComboBoxBinding.zip</a>.</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
										<li><a href="../../tags/windows-forms">Windows Forms</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">14</span>
										<span class="rest">Jan 2007</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Making WebRequests in parallel...</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Under the assumption that making sequential WebRequests is slower than making them in parallel i wrote a little program that returns the HTTP status code for each URI in a list. Because the number of WaitHandles on a system is limited to 64 and i would have been required to hack around this limitation i decided to use ThreadPool instead&hellip;</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">using</span> <span style="color:#555">System</span>;
<span style="color:#000;font-weight:bold">using</span> <span style="color:#555">System.Collections.Generic</span>;
<span style="color:#000;font-weight:bold">using</span> <span style="color:#555">System.Text</span>;
<span style="color:#000;font-weight:bold">using</span> <span style="color:#555">System.Threading</span>;
<span style="color:#000;font-weight:bold">using</span> <span style="color:#555">System.Net</span>;

<span style="color:#000;font-weight:bold">namespace</span> <span style="color:#555">ManyRequests</span>
{
	<span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Program</span>
	{
	
		<span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">void</span> Main(<span style="color:#458;font-weight:bold">string</span>[] args)
		{
			List&lt;uri&gt; uris = <span style="color:#000;font-weight:bold">new</span> List&lt;uri&gt;();
			uris.Add(<span style="color:#000;font-weight:bold">new</span> Uri(<span style="color:#d14">&#34;http://www.timvw.be&#34;</span>));
			uris.Add(<span style="color:#000;font-weight:bold">new</span> Uri(<span style="color:#d14">&#34;http://example.com/does\_not\_exist&#34;</span>));
			uris.Add(<span style="color:#000;font-weight:bold">new</span> Uri(<span style="color:#d14">&#34;http://www.timvw.be/c-sharp&#34;</span>));
			uris.Add(<span style="color:#000;font-weight:bold">new</span> Uri(<span style="color:#d14">&#34;http://www.timvw.be/rss-feed/&#34;</span>));
			uris.Add(<span style="color:#000;font-weight:bold">new</span> Uri(<span style="color:#d14">&#34;http://localhost&#34;</span>));

		Console.WriteLine(<span style="color:#d14">&#34;Getting the HttpStatusCodes...&#34;</span>);
		HttpStatusCodeReader httpStatusCodeReader = <span style="color:#000;font-weight:bold">new</span> HttpStatusCodeReader(uris);
		<span style="color:#458;font-weight:bold">int</span>[] httpStatusCodes = httpStatusCodeReader.GetHttpStatusCodes();

		<span style="color:#000;font-weight:bold">for</span> (<span style="color:#458;font-weight:bold">int</span> i = <span style="color:#099">0</span>; i &lt; uris.Count; ++i) 
		{ 
			Console.WriteLine(<span style="color:#d14">&#34;{0} {1}&#34;</span>, httpStatusCodes[i], uris[i]); }
			Console.Write(<span style="color:#d14">&#34;{0}Press any key to continueÃ¢â‚¬Â¦&#34;</span>, Environment.NewLine); 
			Console.ReadKey(); 
		} 
	} 
	
	<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">HttpStatusCodeReader</span> 
	{ 
		<span style="color:#000;font-weight:bold">private</span> List&lt;uri&gt; uris;
		<span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">int</span>[] httpStatusCodes;
		<span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">object</span> syncLock;
		<span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">int</span> completed;

		<span style="color:#000;font-weight:bold">public</span> HttpStatusCodeReader(List&lt;uri&gt; uris)
		{
			<span style="color:#000;font-weight:bold">if</span> (uris == <span style="color:#000;font-weight:bold">null</span>)
			{
				<span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> ArgumentNullException(<span style="color:#d14">&#34;uris&#34;</span>);
			}

			<span style="color:#000;font-weight:bold">foreach</span> (Uri uri <span style="color:#000;font-weight:bold">in</span> uris)
			{
				<span style="color:#000;font-weight:bold">if</span> (uri.Scheme != Uri.UriSchemeHttp &amp;&amp; uri.Scheme != Uri.UriSchemeHttps)
				{
					<span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> ArgumentException(uri.ToString() + <span style="color:#d14">&#34; is not valid http(s) uri.&#34;</span>, <span style="color:#d14">&#34;uris&#34;</span>);
				}
			}

			<span style="color:#000;font-weight:bold">this</span>.uris = uris;
			<span style="color:#000;font-weight:bold">this</span>.httpStatusCodes = <span style="color:#000;font-weight:bold">new</span> <span style="color:#458;font-weight:bold">int</span>[uris.Count];
			<span style="color:#000;font-weight:bold">this</span>.syncLock = <span style="color:#000;font-weight:bold">new</span> <span style="color:#458;font-weight:bold">object</span>();
			<span style="color:#000;font-weight:bold">this</span>.completed = <span style="color:#099">0</span>;
		}

		<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span>[] GetHttpStatusCodes()
		{
			<span style="color:#000;font-weight:bold">for</span> (<span style="color:#458;font-weight:bold">int</span> i = <span style="color:#099">0</span>; i &lt; <span style="color:#000;font-weight:bold">this</span>.httpStatusCodes.Length; ++i) 
			{ 
				HttpWebRequest httpWebRequest = WebRequest.Create(<span style="color:#000;font-weight:bold">this</span>.uris[i]) <span style="color:#000;font-weight:bold">as</span> HttpWebRequest; 
				httpWebRequest.Method = <span style="color:#d14">&#34;HEAD&#34;</span>; 
				httpWebRequest.AllowAutoRedirect = <span style="color:#000;font-weight:bold">true</span>; 
				httpWebRequest.BeginGetResponse(<span style="color:#000;font-weight:bold">this</span>.GetResponseCompleted, <span style="color:#000;font-weight:bold">new</span> <span style="color:#458;font-weight:bold">object</span>[] { httpWebRequest, i });
			} 
			<span style="color:#000;font-weight:bold">lock</span> (<span style="color:#000;font-weight:bold">this</span>.syncLock) 
			{ 
				<span style="color:#000;font-weight:bold">while</span> (<span style="color:#000;font-weight:bold">this</span>.completed &lt; <span style="color:#000;font-weight:bold">this</span>.httpStatusCodes.Length) 
				{ 
					Monitor.Wait(<span style="color:#000;font-weight:bold">this</span>.syncLock); 
				} 
			} 
			<span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span>.httpStatusCodes; 
		} 
		
		<span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">void</span> GetResponseCompleted(IAsyncResult ar) 
		{ 
			<span style="color:#458;font-weight:bold">object</span>[] objects = ar.AsyncState <span style="color:#000;font-weight:bold">as</span> <span style="color:#458;font-weight:bold">object</span>[];
			HttpWebRequest httpWebRequest = objects[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">as</span> HttpWebRequest; 
			<span style="color:#458;font-weight:bold">int</span> index = (<span style="color:#458;font-weight:bold">int</span>)objects[<span style="color:#099">1</span>]; 
			HttpWebResponse httpWebResponse = <span style="color:#000;font-weight:bold">null</span>; 
			<span style="color:#000;font-weight:bold">try</span> 
			{
				httpWebResponse = httpWebRequest.EndGetResponse(ar) <span style="color:#000;font-weight:bold">as</span> HttpWebResponse; 
				<span style="color:#000;font-weight:bold">this</span>.httpStatusCodes[index] = (<span style="color:#458;font-weight:bold">int</span>)httpWebResponse.StatusCode; 
			} 
			<span style="color:#000;font-weight:bold">catch</span> (WebException webException) 
			{ 
				httpWebResponse = webException.Response <span style="color:#000;font-weight:bold">as</span> HttpWebResponse; 
				<span style="color:#000;font-weight:bold">if</span> (httpWebResponse != <span style="color:#000;font-weight:bold">null</span>) 
				{ 
					<span style="color:#000;font-weight:bold">this</span>.httpStatusCodes[index] = (<span style="color:#458;font-weight:bold">int</span>)httpWebResponse.StatusCode; 
				} 
			} 
			<span style="color:#000;font-weight:bold">finally</span> 
			{ 
				<span style="color:#000;font-weight:bold">if</span> (httpWebResponse != <span style="color:#000;font-weight:bold">null</span>) 
				{ 
					httpWebResponse.Close(); 
				} 
				<span style="color:#000;font-weight:bold">lock</span> (<span style="color:#000;font-weight:bold">this</span>.syncLock) 
				{ 
					Interlocked.Add(<span style="color:#000;font-weight:bold">ref</span> <span style="color:#000;font-weight:bold">this</span>.completed, <span style="color:#099">1</span>); 
					Monitor.Pulse(<span style="color:#000;font-weight:bold">this</span>.syncLock); 
				} 
			}
		} 
	} 
}
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">13</span>
										<span class="rest">Jan 2007</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Hide and unhide columns (or rows) in the DataGridView</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Once in a while i see the following question</p>
<blockquote>
<!-- raw HTML omitted -->
</blockquote>
<p>Using the Visibile property of the DataGridViewColumn makes this a no-brainer. Let&rsquo;s take the <a href="http://www.timvw.be/developing-a-datasource-for-your-datagridview/">Databound DataGridView</a> and implement functionality to hide/unhide the quarterly results. All you have to do is add a DataGridViewButtonColumn and handle the DataGridView CellClick event as following</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">void</span> dataGridView1_CellClick(<span style="color:#458;font-weight:bold">object</span> sender, DataGridViewCellEventArgs e)
{
	<span style="color:#000;font-weight:bold">if</span> (e.ColumnIndex == <span style="color:#000;font-weight:bold">this</span>.ColumnButton.Index)
	{
		<span style="color:#458;font-weight:bold">bool</span> visible = !<span style="color:#000;font-weight:bold">this</span>.ColumnQ1.Visible;
		<span style="color:#000;font-weight:bold">this</span>.ColumnQ1.Visible = visible;
		<span style="color:#000;font-weight:bold">this</span>.ColumnQ2.Visible = visible;
		<span style="color:#000;font-weight:bold">this</span>.ColumnQ3.Visible = visible;
		<span style="color:#000;font-weight:bold">this</span>.ColumnQ4.Visible = visible;
		<span style="color:#000;font-weight:bold">this</span>.ColumnButton.HeaderText = visible ? <span style="color:#d14">&#34;-&#34;</span> : <span style="color:#d14">&#34;+&#34;</span>;
	}
}
</code></pre></div><p>This is how it looks like</p>
<p><img src="http://www.timvw.be/wp-content/images/datagridview-hide.gif" alt="screenshot of datagridview hiding columns"></p>
<p><img src="http://www.timvw.be/wp-content/images/datagridview-unhide.gif" alt="screenshot of datagridview unhiding columns"></p>
<p>Feel free to download the updated source code for <a href="http://www.timvw.be/wp-content/code/csharp/DataGridViewDataSource.zip">DataGridViewDataSource.zip</a>.</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
										<li><a href="../../tags/windows-forms">Windows Forms</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">12</span>
										<span class="rest">Jan 2007</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Presenting a Generic RemotingHelper</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Last couple of months i&rsquo;ve been experimenting with <a href="http://msdn2.microsoft.com/en-us/library/kwdt6w2k.aspx">Remoting</a>. Here is a class that helps a client to acquire proxies to an endpoint served by the requested well-known object</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">RemotingHelper</span>
{
	<span style="color:#000;font-weight:bold">static</span> RemotingHelper()
	{
		RemotingConfiguration.Configure(AppDomain.CurrentDomain.SetupInformation.ConfigurationFile, <span style="color:#000;font-weight:bold">false</span>);
	}

	<span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">object</span> GetService(<span style="color:#458;font-weight:bold">string</span> fullName)
	{
		WellKnownClientTypeEntry[] wellKnownClientTypeEntries = RemotingConfiguration.GetRegisteredWellKnownClientTypes();
		<span style="color:#000;font-weight:bold">foreach</span> (WellKnownClientTypeEntry welknownClientTypeEntry <span style="color:#000;font-weight:bold">in</span> wellKnownClientTypeEntries)
		{
			<span style="color:#000;font-weight:bold">if</span> (welknownClientTypeEntry.ObjectType.FullName == fullName)
			{
				<span style="color:#000;font-weight:bold">return</span> Activator.GetObject(welknownClientTypeEntry.ObjectType, welknownClientTypeEntry.ObjectUrl);
			}
		}

		<span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> ArgumentException(fullName + <span style="color:#d14">&#34; is not a wellKnownClientType.&#34;</span>);
	}

	<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> T GetService&lt;t&gt;()
	{
		<span style="color:#000;font-weight:bold">return</span> (T) RemotingHelper.GetService(<span style="color:#000;font-weight:bold">typeof</span>(T).FullName);
	}
}
</code></pre></div><p>Getting a proxy is as easy as (Presuming that you&rsquo;ve configured the system.runtime.remoting in your App.config)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">IContract contract = RemotingHelper.GetService&lt;icontract&gt;();
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
									</ul>
								
							
						</div></div>
				
				

<ul class="pagination">
	<li class="page-item page-prev">
	
    <a href="../../page/30/" class="page-link" aria-label="Previous"><span aria-hidden="true">â† Prev page</span></a>
	
	</li>
	<li class="page-item page-next">
	
    <a href="../../page/32/" class="page-link" aria-label="Next"><span aria-hidden="true">Next page â†’</span></a>
	
	</li>
</ul>


			</div>
		</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2022  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-9DP4SV12YW', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
