<!DOCTYPE html>
<html>
<head>
	<meta name="generator" content="Hugo 0.80.0" />
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Tim Van Wassenhove - Passionate geek, interested in Technology. Proud father of two </title><meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="alternate" type="application/rss+xml" href="https://timvw.be/feed.xml" title="Tim Van Wassenhove" />
	<meta itemprop="name" content="Tim Van Wassenhove">
<meta itemprop="description" content="">
<meta property="og:title" content="Tim Van Wassenhove" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://timvw.be/" />
<meta property="og:updated_time" content="2021-11-08T15:31:18+01:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Tim Van Wassenhove"/>
<meta name="twitter:description" content=""/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://timvw.be/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://timvw.be/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="https://timvw.be/">Tim Van Wassenhove</a></h1>
	<div class="site-description"><p>Passionate geek, interested in Technology. Proud father of two</p><nav class="nav social">
			<ul class="flat"><li><a href="https://twitter.com/timvw" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://github.com/timvw" title="Github"><i data-feather="github"></i></a></li><li><a href="https://www.linkedin.com/in/timvanwassenhove" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="https://timvw.be/feed.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="../../">Home</a>
			</li>
			
			<li>
				<a href="../../posts">All posts</a>
			</li>
			
			<li>
				<a href="../../tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="recent-posts section">
			<div class="posts">
				
				
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">12</span>
										<span class="rest">Oct 2006</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Updating the Internet Options / Lan Settings</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>A while ago i wrote that i had created two .reg files to update my Internet Options / Lan Settings (<a href="http://www.timvw.be/automating-the-configuration-of-internet-options-and-lan-settings/">Automating the configuration of Internet Options / Lan Settings</a>). Yesterday i build a little Windows Service that automates this completely. With <a href="http://windowssdk.msdn.microsoft.com/en-gb/library/aa366329.aspx">NotifyAddrChange</a> i am notified whenever a change occurs in the table that maps IPv4 addresses to interfaces</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#008080">[DllImport(&#34;iphlpapi.dll&#34;, CharSet = CharSet.Ansi)]</span>
<span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">extern</span> <span style="color:#458;font-weight:bold">int</span> NotifyAddrChange(<span style="color:#000;font-weight:bold">ref</span> IntPtr handle, IntPtr overlapped);
</code></pre></div><p>The main loop of the service looks like this</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">while</span> (<span style="color:#000;font-weight:bold">this</span>.isRunning)
{
	IntPtr handle = IntPtr.Zero;
	NotifyAddrChange(<span style="color:#000;font-weight:bold">ref</span> handle, IntPtr.Zero);
	UpdateRegistry();
}
</code></pre></div><p>Whenever i&rsquo;m connected to the LAN at work i want to use a proxy. Here&rsquo;s the code that takes care of this</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">void</span> UpdateRegistry()
{
	RegistryKey registryKey = Registry.CurrentUser.OpenSubKey(<span style="color:#d14">@&#34;Software\Microsoft\Windows\CurrentVersion\Internet Settings&#34;</span>, <span style="color:#000;font-weight:bold">true</span>);
	<span style="color:#000;font-weight:bold">if</span> (IsInWorkLan())
	{
		registryKey.SetValue(<span style="color:#d14">&#34;AutoConfigURL&#34;</span>, <span style="color:#d14">&#34;http://123.456.789.0&#34;</span>);
	}
	<span style="color:#000;font-weight:bold">else</span>
	{
		registryKey.DeleteValue(<span style="color:#d14">&#34;AutoConfigURL&#34;</span>, <span style="color:#000;font-weight:bold">false</span>);
	}
}
</code></pre></div><p>Figuring out whether i&rsquo;m connected to the LAN at work is pretty simple. As soon as i have an IPAddress that looks like 192.168.X.Y i&rsquo;m connected. Here&rsquo;s how i translated this into code</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">bool</span> IsInWorkLan()
{
	<span style="color:#000;font-weight:bold">foreach</span> (IPAddress ipAddress <span style="color:#000;font-weight:bold">in</span> Dns.GetHostAddresses(Dns.GetHostName()))
	{
		<span style="color:#000;font-weight:bold">if</span> (IsInWorkLan(ipAddress))
		{
			<span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span>;
		}
	}

	<span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span>;
}

<span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">bool</span> IsInWorkLan(IPAddress ipAddress)
{
	<span style="color:#458;font-weight:bold">byte</span>[] bytes = ipAddress.GetAddressBytes();
	<span style="color:#000;font-weight:bold">if</span> ((<span style="color:#458;font-weight:bold">int</span>)bytes[<span style="color:#099">0</span>] == <span style="color:#099">192</span> &amp;&amp; (<span style="color:#458;font-weight:bold">int</span>)bytes[<span style="color:#099">1</span>] == <span style="color:#099">168</span>)
	{
		<span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span>;
	}

	<span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span>;
}
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">08</span>
										<span class="rest">Oct 2006</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Screenshot of DataGridViews</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>The problem with a regular screenshot is that you only get to see a part of the DataGridViews. Here&rsquo;s an example of a typical form</p>
<p><img src="http://www.timvw.be/wp-content/images/datagridviews-with-scrollbars.jpg" alt="image of datagridview with scrollbars"></p>
<p>Here is a snippet that makes a screenshot of the complete DataGridViews</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">List&lt;bitmap&gt; bitmaps = <span style="color:#000;font-weight:bold">new</span> List&lt;bitmap&gt;();
Size size = <span style="color:#000;font-weight:bold">new</span> Size();

<span style="color:#000;font-weight:bold">for</span> (<span style="color:#458;font-weight:bold">int</span> i = <span style="color:#099">1</span>; i &lt; <span style="color:#099">4</span>; ++i) 
{ 
	<span style="color:#998;font-style:italic">// lookup the datagridview 
</span><span style="color:#998;font-style:italic"></span>	DataGridView dataGridView = (DataGridView)<span style="color:#000;font-weight:bold">this</span>.Controls[<span style="color:#d14">&#34;dataGridView&#34;</span> + i]; 
	<span style="color:#998;font-style:italic">// maximize the datagridview size (choosing between current and preferred) 
</span><span style="color:#998;font-style:italic"></span>	Size oldSize = dataGridView.Size; 
	Size newSize = dataGridView.PreferredSize; 
	<span style="color:#000;font-weight:bold">if</span> (dataGridView.Size.Width &gt; newSize.Width)
	{
		newSize.Width = dataGridView.Size.Width;
	}

	<span style="color:#000;font-weight:bold">if</span> (dataGridView.Size.Height &gt; newSize.Height)
	{
		newSize.Height = dataGridView.Size.Height;
	}

	dataGridView.Size = newSize;

	<span style="color:#998;font-style:italic">// draw the datagridview into a bitmap
</span><span style="color:#998;font-style:italic"></span>	Bitmap bitmap = <span style="color:#000;font-weight:bold">new</span> Bitmap(dataGridView.Width, dataGridView.Height);
	dataGridView.DrawToBitmap(bitmap, <span style="color:#000;font-weight:bold">new</span> Rectangle(<span style="color:#099">0</span>, <span style="color:#099">0</span>, dataGridView.Width, dataGridView.Height));

	<span style="color:#998;font-style:italic">// restore the datagridview to it&#39;s original size
</span><span style="color:#998;font-style:italic"></span>	dataGridView.Size = oldSize;

	bitmaps.Add(bitmap);

	<span style="color:#998;font-style:italic">// update total bitmap size
</span><span style="color:#998;font-style:italic"></span>	<span style="color:#000;font-weight:bold">if</span> (newSize.Width &gt; size.Width)
	{
		size.Width = newSize.Width;
	}
	size.Height += newSize.Height;
}

<span style="color:#998;font-style:italic">// copy all the bitmaps into one large bitmap
</span><span style="color:#998;font-style:italic"></span>Bitmap bitmapComplete = <span style="color:#000;font-weight:bold">new</span> Bitmap(size.Width, size.Height);
Graphics g = Graphics.FromImage(bitmapComplete);

<span style="color:#458;font-weight:bold">int</span> height = <span style="color:#099">0</span>;
<span style="color:#000;font-weight:bold">for</span> (<span style="color:#458;font-weight:bold">int</span> i = <span style="color:#099">1</span>; i &lt; <span style="color:#099">4</span>; ++i) 
{ 
	g.DrawImageUnscaled(bitmaps[i - <span style="color:#099">1</span>], <span style="color:#099">0</span>, height); 
	height += bitmaps[i - <span style="color:#099">1</span>].Height; 
} 

<span style="color:#998;font-style:italic">// bitmapComplete is ready for use 
</span><span style="color:#998;font-style:italic">// eg: pictureBox1.Image = bitmapComplete 
</span><span style="color:#998;font-style:italic">// eg: bitmapComplete.Save(@&#34;C:\screenshot.jpg&#34;, ImageFormat.Jpeg); 
</span></code></pre></div><p><img src="http://www.timvw.be/wp-content/images/datagridviews-without-scrollbars.jpg" alt="image of generated screenshot"></p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
										<li><a href="../../tags/windows-forms">Windows Forms</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">04</span>
										<span class="rest">Oct 2006</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Accessing ConnectionStrings from App.config in a Console Application Project</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Earlier today i added a configuration file to my Console Applicaton Project (Add Item -&gt; Application Configuration File). Via <a href="http://www.google.be/url?sa=t&amp;ct=res&amp;cd=1&amp;url=http%3A%2F%2Fmsdn2.microsoft.com%2Fen-us%2Flibrary%2Fsystem.configuration.configurationsettings.aspx&amp;ei=Z80jRYH_C6emiAKbksTEDA&amp;sig=___7EifcEUZZI1hKTg7xiADzIZfIk=&amp;sig2=l3qMgh7T4zcrtCc2IZOp-A">ConfigurationSettings</a> i could only access the AppSettings. It took me a while to figure out that i had to add a reference to System.Configuration.dll. Once that was done i could access the ConnectionStrings via <a href="http://www.google.be/url?sa=t&amp;ct=res&amp;cd=1&amp;url=http%3A%2F%2Fmsdn2.microsoft.com%2Fen-us%2Flibrary%2Fsystem.configuration.configurationmanager.aspx&amp;ei=wM0jRbOxF7mEiALA4smRDA&amp;sig=__mZt6_vi0x3-IpA4WDtLjmB8J4qU=&amp;sig2=RhtohKiKtaGgUOTNFNtJ-w">ConfigurationManager</a>.</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">04</span>
										<span class="rest">Oct 2006</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">From UnixTime to DateTime and back</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Here are a couple of functions that allow you to convert from <a href="http://en.wikipedia.org/wiki/Unixtime">UnixTime</a> to <a href="http://msdn2.microsoft.com/en-us/library/system.datetime.aspx">DateTime</a> and back</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Util</span> {
	<span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> DateTime UnixTime
	{
		<span style="color:#000;font-weight:bold">get</span> { <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> DateTime(<span style="color:#099">1970</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>); }
	}

	<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> DateTime FromUnixTime( <span style="color:#458;font-weight:bold">double</span> unixTime )
	{
		<span style="color:#000;font-weight:bold">return</span> UnixTime.AddSeconds( unixTime );
	}

	<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">double</span> ToUnixTime( DateTime dateTime )
	{
		TimeSpan timeSpan = dateTime -- UnixTime;
		<span style="color:#000;font-weight:bold">return</span> timeSpan.TotalSeconds;
	}
}
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">18</span>
										<span class="rest">Sep 2006</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Code  39 barcodes recognizer</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Earlier today i read <a href="http://community.bartdesmet.net/blogs/bart/archive/2006/09/18/4432.aspx">Code 39 barcodes in C#</a> by <a href="http://community.bartdesmet.net/blogs/bart/default.aspx">Bart De Smet</a>. The article shows the reader how to generate a <a href="http://en.wikipedia.org/wiki/Code_39">Code 39 barcode</a>. I thought it would be cool if you could actually recognize the barcode in the generated bitmaps so i last couple of hours i wrote a BarCode39 Reader 🙂 Feel free to get <a href="http://www.timvw.be/wp-content/code/csharp/BarCode39Reader.zip">BarCode39Reader.zip</a> sources now!(PS: I forgot to write this is still a very quick &lsquo;n dirty hack. I don&rsquo;t write bad code, just create a lot of opportunities to refactor 😉</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">16</span>
										<span class="rest">Sep 2006</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Anonymous methods</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Suppose you add a couple of buttons to a panel as shown below. What do you think the message in the MessageBoxes will be?</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">partial</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Form1</span> : Form 
{
	<span style="color:#000;font-weight:bold">public</span> Form1() 
	{
		InitializeComponent();

		<span style="color:#000;font-weight:bold">for</span> (<span style="color:#458;font-weight:bold">int</span> i = <span style="color:#099">0</span>; i &lt; <span style="color:#099">10</span>; ++i) 
		{ 
			Button button = <span style="color:#000;font-weight:bold">new</span> Button(); 
			button.Text = String.Format(<span style="color:#d14">&#34;{0:00}&#34;</span>, i); 
			<span style="color:#000;font-weight:bold">this</span>.flowLayoutPanel1.Controls.Add( button ); 
			button.Click += <span style="color:#000;font-weight:bold">new</span> EventHandler(<span style="color:#000;font-weight:bold">delegate</span>(Object sender, EventArgs e) 
			{ 
				MessageBox.Show(String.Format(<span style="color:#d14">&#34;You clicked button {0:00}&#34;</span>, i)); 
			}); 
		} 
	} 
}
</code></pre></div><p>In case you&rsquo;re wondering why they all have the message &ldquo;You clicked button 10&rdquo; i suggest you read the following articles</p>
<ul>
<li><a href="http://blogs.msdn.com/oldnewthing/archive/2006/08/02/686456.aspx">Part 1</a></li>
<li><a href="http://blogs.msdn.com/oldnewthing/archive/2006/08/03/687529.aspx">Part 2</a></li>
<li><a href="http://blogs.msdn.com/oldnewthing/archive/2006/08/04/688527.aspx">Part 3</a></li>
</ul>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">16</span>
										<span class="rest">Sep 2006</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">DataGridView with EditOnEnter as EditMode</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Earlier this week i found that when a <a href="http://msdn2.microsoft.com/en-us/library/system.windows.forms.datagridview.aspx">DataGridView</a> has it&rsquo;s <a href="http://msdn2.microsoft.com/en-us/library/system.windows.forms.datagridview.editmode.aspx">EditMode</a> property set to <a href="http://msdn2.microsoft.com/en-us/library/system.windows.forms.datagridvieweditmode.aspx">EditOnEnter</a> the user cannot select an entire row by clicking on the row header. This prevents the user from being able to delete a row. A couple of websearches later i found a <a href="http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=98504">bugreport</a> but the proposed workarounds didn&rsquo;t work for me 🙁 Here is a workaround that does work for me</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">void</span> dataGridView1_MouseClick( <span style="color:#458;font-weight:bold">object</span> sender, MouseEventArgs e ) 
{
	DataGridView.HitTestInfo hitInfo = <span style="color:#000;font-weight:bold">this</span>.dataGridView1.HitTest(e.X, e.Y);
	<span style="color:#000;font-weight:bold">if</span>( hitInfo.Type == DataGridViewHitTestType.RowHeader ) 
	{
		<span style="color:#000;font-weight:bold">this</span>.dataGridView1.EditMode = DataGridViewEditMode.EditOnKeystrokeOrF2;
		<span style="color:#000;font-weight:bold">this</span>.dataGridView1.EndEdit();
	}
	<span style="color:#000;font-weight:bold">else</span>
	{
		<span style="color:#000;font-weight:bold">this</span>.dataGridView1.EditMode = DataGridViewEditMode.EditOnEnter;
	}
}
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
										<li><a href="../../tags/windows-forms">Windows Forms</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">16</span>
										<span class="rest">Sep 2006</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Drag and Drop on a DataGridView</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Here is a bit of sample code that allows you to drag and drop a cellvalue in a DataGridView (don&rsquo;t forget to set the AllowDrop property of the DataGridView to true). Notice that you need to translate the X and Y properties of the DragEventArgs first (unlike the X and Y properties of the MouseEventArgs)</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">void</span> dataGridView1_MouseDown( <span style="color:#458;font-weight:bold">object</span> sender, MouseEventArgs e )
{
	DataGridView.HitTestInfo info = <span style="color:#000;font-weight:bold">this</span>.dataGridView1.HitTest( e.X, e.Y );
	<span style="color:#000;font-weight:bold">if</span> ( info.RowIndex != -<span style="color:#099">1</span> &amp;&amp; info.ColumnIndex != -<span style="color:#099">1</span> )
	{
		Object <span style="color:#000;font-weight:bold">value</span> = <span style="color:#000;font-weight:bold">this</span>.dataGridView1.Rows[info.RowIndex].Cells[info.ColumnIndex].Value;
		<span style="color:#000;font-weight:bold">if</span> ( <span style="color:#000;font-weight:bold">value</span> != <span style="color:#000;font-weight:bold">null</span> )
		{
			<span style="color:#000;font-weight:bold">this</span>.dataGridView1.Rows[info.RowIndex].Cells[info.ColumnIndex].Value = <span style="color:#000;font-weight:bold">null</span>;
			<span style="color:#000;font-weight:bold">this</span>.DoDragDrop( <span style="color:#000;font-weight:bold">value</span>, DragDropEffects.Move );
		}
	}
}

<span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">void</span> dataGridView1_DragDrop( <span style="color:#458;font-weight:bold">object</span> sender, DragEventArgs e )
{
	Point p = <span style="color:#000;font-weight:bold">this</span>.dataGridView1.PointToClient( <span style="color:#000;font-weight:bold">new</span> Point( e.X, e.Y ) );
	DataGridView.HitTestInfo info = <span style="color:#000;font-weight:bold">this</span>.dataGridView1.HitTest( p.X, p.Y );
	<span style="color:#000;font-weight:bold">if</span> ( info.RowIndex != -<span style="color:#099">1</span> &amp;&amp; info.ColumnIndex != -<span style="color:#099">1</span> )
	{
		Object <span style="color:#000;font-weight:bold">value</span> = (Object)e.Data.GetData( <span style="color:#000;font-weight:bold">typeof</span>( <span style="color:#458;font-weight:bold">string</span> ) );
		<span style="color:#000;font-weight:bold">this</span>.dataGridView1.Rows[info.RowIndex].Cells[info.ColumnIndex].Value = <span style="color:#000;font-weight:bold">value</span>;
	}
}

<span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">void</span> dataGridView1_DragEnter( <span style="color:#458;font-weight:bold">object</span> sender, DragEventArgs e )
{
	e.Effect = DragDropEffects.Move;
}
</code></pre></div>
						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
										<li><a href="../../tags/windows-forms">Windows Forms</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">16</span>
										<span class="rest">Sep 2006</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Inconsistent Drag and Drop API</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Every System.Windows.Forms.Control has the following events</p>
<ul>
<li>public event DragEventHandler <a href="http://msdn2.microsoft.com/en-us/library/system.windows.forms.control.dragdrop.aspx">DragDrop</a></li>
<li>public event DragEventHandler <a href="http://msdn2.microsoft.com/en-us/library/system.windows.forms.control.dragenter.aspx">DragEnter</a></li>
<li>public event EventHandler <a href="http://msdn2.microsoft.com/en-us/library/system.windows.forms.control.dragleave.aspx">DragLeave</a></li>
<li>public event DragEventHandler <a href="http://msdn2.microsoft.com/en-us/library/system.windows.forms.control.dragover.aspx">DragOver</a></li>
</ul>
<p>This means, when the user drags something away of the control, you can&rsquo;t access the data anymore (unless you cached it somewhere when the DragEnter or DragOver events occured). Here is an extract from Microsoft patterns and practives on <a href="http://msdn2.microsoft.com/en-us/library/ms229011.aspx">Event Design</a></p>
<blockquote>
<!-- raw HTML omitted -->
</blockquote>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
										<li><a href="../../tags/windows-forms">Windows Forms</a></li>
										
									</ul>
								
							
						</div></div>
				
					<div class="post">
						<div class="post-header">
							
								<div class="meta">
									<div class="date">
										<span class="day">14</span>
										<span class="rest">Sep 2006</span>
									</div>
								</div>
							
							<div class="matter">
								<h1 class="title">Adding DataGridViewColumns (lots of them)</h1>
							</div>
						</div>
								
						<div class="markdown">
							<p>Last couple of days i&rsquo;ve been trying to add a couple (750+) columns into a DataGridView. Initially i tried the following</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">this</span>.dataGridView1.ColumnCount = <span style="color:#099">750</span>;
</code></pre></div><p>The code above results in the following error: <strong>Sum of the columns' FillWeight values cannot exceed 65535.</strong> Then i tried the following</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">DataGridViewColumn[] columns = <span style="color:#000;font-weight:bold">new</span> DataGridViewColumn[<span style="color:#099">750</span>];
<span style="color:#000;font-weight:bold">for</span> ( <span style="color:#458;font-weight:bold">int</span> i = <span style="color:#099">0</span>; i &lt; columns.Length; ++i ) 
{ 
	DataGridViewColumn column = <span style="color:#000;font-weight:bold">new</span> DataGridViewColumn(); 
	column.CellTemplate = <span style="color:#000;font-weight:bold">new</span> DataGridViewTextBoxCell(); 
	column.FillWeight = <span style="color:#099">1</span>; columns[i] = column; 
} 
<span style="color:#000;font-weight:bold">this</span>.dataGridView1.Columns.AddRange( columns );
</code></pre></div><p>This results in the following error: <strong>At least one of the DataGridView control&rsquo;s columns has no cell template.</strong> Thus i tried the following</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">DataGridViewColumn[] columns = <span style="color:#000;font-weight:bold">new</span> DataGridViewColumn[<span style="color:#099">750</span>];
<span style="color:#000;font-weight:bold">for</span> ( <span style="color:#458;font-weight:bold">int</span> i = <span style="color:#099">0</span>; i &lt; columns.Length; ++i ) 
{ 
	DataGridViewColumn column = <span style="color:#000;font-weight:bold">new</span> DataGridViewTextBoxColumn(); 
	column.FillWeight = <span style="color:#099">1</span>; columns[i] = column; 
} 
<span style="color:#000;font-weight:bold">this</span>.dataGridView1.Columns.AddRange( columns ); 
</code></pre></div><p>This code works but the AddRange call took about 15 seconds to complete. With the aid of a collegue and <a href="http://www.aisto.com/roeder/dotnet/">Reflector</a> i set the ColumnHeadersHeightSize to DisableResizing. This reduced the calltime to less than 0.5 seconds 🙂</p>

						</div>
			
						<div class="tags">
							
								
									<ul class="flat">
										
										<li><a href="../../tags/csharp">CSharp</a></li>
										
										<li><a href="../../tags/windows-forms">Windows Forms</a></li>
										
									</ul>
								
							
						</div></div>
				
				

<ul class="pagination">
	<li class="page-item page-prev">
	
    <a href="../../page/33/" class="page-link" aria-label="Previous"><span aria-hidden="true">← Prev page</span></a>
	
	</li>
	<li class="page-item page-next">
	
    <a href="../../page/35/" class="page-link" aria-label="Next"><span aria-hidden="true">Next page →</span></a>
	
	</li>
</ul>


			</div>
		</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2021  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-2585435-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
