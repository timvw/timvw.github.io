---
layout: post
status: publish
published: true
title: Build your own netstat.exe with c#
author:
  display_name: timvw
  login: admin
  email: tim@timvw.be
  url: http://timvw.myopenid.com/
author_login: admin
author_email: tim@timvw.be
author_url: http://timvw.myopenid.com/
wordpress_id: 201
wordpress_url: http://www.timvw.be/build-your-own-netstatexe-with-c/
date: '2007-09-09 04:58:20 +0200'
date_gmt: '2007-09-09 02:58:20 +0200'
categories: []
tags:
- C#
comments:
- id: 258
  author: WTF
  author_email: ''
  author_url: ''
  date: '2007-11-11 12:51:44 +0100'
  date_gmt: '2007-11-11 10:51:44 +0100'
  content: WTF is all this gibberish I just wanted a program thats faster than netstat
    and i see gibberish
- id: 259
  author: Trevor A Thompson
  author_email: trevorat@live.com
  author_url: http://devel.ws
  date: '2008-01-13 02:27:38 +0100'
  date_gmt: '2008-01-13 00:27:38 +0100'
  content: In regards to the previous response; netstat is as fast as it can possibly
    be-- why don't you make sure your performance issue isn't the result of slow name
    resolution or perhaps some other user error? If you can't understand the complexities
    of the trial and error approach, perhaps you shouldn't use netstat :P
- id: 260
  author: Simon
  author_email: simpa151@gmail.com
  author_url: http://none
  date: '2008-02-28 11:47:53 +0100'
  date_gmt: '2008-02-28 09:47:53 +0100'
  content: Nice project but im trying to run your code and i get a access denied error
    from win32 file and i cannot fix it im using visual studio 2008. in this foreach
    foreach (ProcessModule processModule in process.Modules) process.Modules gets
    an error but if i run it as comsole application it runs successful and i get this
    error. Im trying to add this code to a list where i can watch all active tcp udps.
    I m trying to build a application wich can alarm user if it sends info to a unknown
    place something compared to zone alarm. Can u help
- id: 261
  author: Tocs
  author_email: ''
  author_url: ''
  date: '2008-05-21 23:49:54 +0200'
  date_gmt: '2008-05-21 21:49:54 +0200'
  content: Could this be used as a base to write the same for UDP or does IPHelper
    not do that?
- id: 262
  author: timvw
  author_email: timvanwassenhove@gmail.com
  author_url: http://www.timvw.be
  date: '2008-05-22 07:34:37 +0200'
  date_gmt: '2008-05-22 05:34:37 +0200'
  content: For UDP you would need to P&#47;Invoke <a href="http:&#47;&#47;msdn.microsoft.com&#47;en-us&#47;library&#47;aa366033(VS.85).aspx"
    rel="nofollow">GetUdpTable<&#47;a> or <a href="http:&#47;&#47;msdn.microsoft.com&#47;en-us&#47;library&#47;aa365930(VS.85).aspx"
    rel="nofollow">GetExtendedUdpTable<&#47;a>.
- id: 16064
  author: hello
  author_email: ''
  author_url: ''
  date: '2011-07-29 08:16:35 +0200'
  date_gmt: '2011-07-29 07:16:35 +0200'
  content: cooooooooooool
- id: 36133
  author: SK
  author_email: noemail@here.com
  author_url: ''
  date: '2012-03-13 06:21:00 +0100'
  date_gmt: '2012-03-13 05:21:00 +0100'
  content: Very nice work - highly professional. All the nasayers from other posts
    can shove it.
- id: 38319
  author: amar
  author_email: ''
  author_url: ''
  date: '2012-03-27 21:51:39 +0200'
  date_gmt: '2012-03-27 20:51:39 +0200'
  content: Nice Work Dude
- id: 50832
  author: ChrisL
  author_email: ''
  author_url: ''
  date: '2012-05-29 02:20:45 +0200'
  date_gmt: '2012-05-29 01:20:45 +0200'
  content: Just what I needed; the naysayers need to learn more about computers &amp;
    programming
- id: 61341
  author: Dean
  author_email: dkroon5@hotmail.com
  author_url: ''
  date: '2012-07-13 15:05:28 +0200'
  date_gmt: '2012-07-13 14:05:28 +0200'
  content: Nice!  This was exactly what I was looking for.  Thanks for the great work...
    it saved me a ton of time.
- id: 65320
  author: Muthu
  author_email: remindkumar@gmail.com
  author_url: ''
  date: '2012-07-29 13:07:39 +0200'
  date_gmt: '2012-07-29 12:07:39 +0200'
  content: "Cool!\r\nVery nice article and source code organization.\r\nWorks without
    any changes.\r\nThanks a lot."
- id: 200461
  author: Soham
  author_email: soham.m17@gmail.com
  author_url: ''
  date: '2013-06-03 09:43:08 +0200'
  date_gmt: '2013-06-03 08:43:08 +0200'
  content: Are you exactly sure that this result transcribe accurately netstat.exe
    results? No extra data is there in netstat.exe results? Because I am seeing a
    lot more data in netstat.exe . I know this is the TCP table so UDP results would
    not be here but still a lot more TCP data is there at netstat.exe which is not
    here. That's why I am a bit skeptic. If you can explain a little bit that netstat
    actually copies this tcptable, it would be great.
- id: 204515
  author: 'C#&#47;.NET&#47;LINQ: DotNetStat: netstat.exe with TCP ports grouped by
    host &laquo; The Wiert Corner &#8211; irregular stream of stuff'
  author_email: ''
  author_url: http://wiert.me/2013/06/18/c-netlinq-dotnetstat-netstat-exe-with-tcp-ports-grouped-by-host/
  date: '2013-06-18 06:01:27 +0200'
  date_gmt: '2013-06-18 05:01:27 +0200'
  content: '[...] System.Net.NetworkInformation.IPGlobalProperties.GetIPGlobalProperties&nbsp;method,
    for instance by -&nbsp;Build your own netstat.exe with c# | Tim Van Wassenhove.
    -&nbsp;Netstat in C# &laquo; Towards [...]'
- id: 290069
  author: stuart murray
  author_email: ''
  author_url: ''
  date: '2013-11-29 12:57:29 +0100'
  date_gmt: '2013-11-29 11:57:29 +0100'
  content: Awesome posting.  Saved me a bundle of time
---
<p>Earlier today i wrote ManagedIpHelper, a wrapper for <a href="http:&#47;&#47;msdn2.microsoft.com&#47;en-us&#47;library&#47;aa366073.aspx">IP Helper API<&#47;a> it's <a href="http:&#47;&#47;msdn2.microsoft.com&#47;en-us&#47;library&#47;aa365928.aspx">GetExtendedTcpTable<&#47;a>. Using this wrapper i could easily create my own version of netstat.exe. The following code generates the same output (but much faster) than "netstat.exe -anvbp tcp":<&#47;p><br />
[code lang="csharp"]static void Main(string[] args)<br />
{<br />
 Console.WriteLine("Active Connections");<br />
 Console.WriteLine();</p>
<p> Console.WriteLine("  Proto  Local Address          Foreign Address        State         PID");<br />
 foreach (TcpRow tcpRow in ManagedIpHelper.GetExtendedTcpTable(true))<br />
 {<br />
  Console.WriteLine("  {0,-7}{1,-23}{2, -23}{3,-14}{4}", "TCP", tcpRow.LocalEndPoint, tcpRow.RemoteEndPoint, tcpRow.State, tcpRow.ProcessId);</p>
<p>  Process process = Process.GetProcessById(tcpRow.ProcessId);<br />
  if (process.ProcessName != "System")<br />
  {<br />
   foreach (ProcessModule processModule in process.Modules)<br />
   {<br />
    Console.WriteLine("  {0}", processModule.FileName);<br />
   }</p>
<p>   Console.WriteLine("  [{0}]", Path.GetFileName(process.MainModule.FileName));<br />
  }<br />
  else<br />
  {<br />
   Console.WriteLine("  -- unknown component(s) --");<br />
   Console.WriteLine("  [{0}]", "System");<br />
  }</p>
<p>  Console.WriteLine();<br />
 }</p>
<p> Console.Write("{0}Press any key to continue...", Environment.NewLine);<br />
 Console.ReadKey();<br />
}[&#47;code]</p>
<p>As always, feel free to download the code for the <a href="http:&#47;&#47;www.timvw.be&#47;wp-content&#47;code&#47;csharp&#47;managediphelperanddemo.zip">ManagedIpHelper and demo<&#47;a>.<&#47;p></p>
