---
layout: post
status: publish
published: true
title: Strict mocks lead to overspecification
author:
  display_name: timvw
  login: admin
  email: tim@timvw.be
  url: http://timvw.myopenid.com/
author_login: admin
author_email: tim@timvw.be
author_url: http://timvw.myopenid.com/
wordpress_id: 927
wordpress_url: http://www.timvw.be/?p=927
date: '2009-03-24 16:49:02 +0100'
date_gmt: '2009-03-24 15:49:02 +0100'
categories: []
tags:
- C#
- Patterns
comments: []
---
<p>Here is an example that demonstrates how strick mocks lead to overspecification. Imagine that we are creating a simple screen in a <a href="http:&#47;&#47;martinfowler.com&#47;eaaDev&#47;PassiveScreen.html">Passive View<&#47;a> architecture. The first feature that we implement is displaying the message "edit" when the user clicks the edit button:<&#47;p></p>
<p>[code lang="csharp"][Fact] public void ShouldDisplayEditClickMessage()<br />
{<br />
 &#47;&#47; Establish context<br />
 MockRepository mockRepository = new MockRepository();<br />
 IView view = mockRepository.StrictMock<iview>();<br />
 Expect.Call(delegate { view.EditClick += null; }).IgnoreArguments();<br />
 mockRepository.Replay(view);</p>
<p> &#47;&#47; Create sut<br />
 Presenter sut = new Presenter(view);</p>
<p> &#47;&#47; Setup expectations<br />
 mockRepository.BackToRecord(view, BackToRecordOptions.Expectations);<br />
 Expect.Call(delegate { view.DisplayClickMessage("edit"); });<br />
 mockRepository.ReplayAll();</p>
<p> &#47;&#47; Exercise<br />
 RhinoMocksExtensions<br />
  .GetEventRaiser(view, delegate(IView v) { v.EditClick += null; })<br />
  .Raise(view, EventArgs.Empty);</p>
<p> &#47;&#47; Verify<br />
 mockRepository.VerifyAll();<br />
}[&#47;code]</p>
<p><br&#47;></p>
<p><img src="http:&#47;&#47;www.timvw.be&#47;wp-content&#47;images&#47;overspecification-01.PNG" alt="screenshot of test runner with all tests passing" &#47;></p>
<p>And now we add the feature that displays the message "save" whenever the user clicks on the save button:<&#47;p></p>
<p>[code lang="csharp"][Fact] public void ShouldDisplaySaveClickMessage()<br />
{<br />
 &#47;&#47; Establish context<br />
 MockRepository mockRepository = new MockRepository();<br />
 IView view = mockRepository.StrictMock<iview>();<br />
 Expect.Call(delegate { view.EditClick += null; }).IgnoreArguments();<br />
 Expect.Call(delegate { view.SaveClick += null; }).IgnoreArguments();<br />
 mockRepository.Replay(view);</p>
<p> &#47;&#47; Create sut<br />
 Presenter sut = new Presenter(view);</p>
<p> &#47;&#47; Setup expectations<br />
 mockRepository.BackToRecord(view, BackToRecordOptions.Expectations);<br />
 Expect.Call(delegate { view.DisplayClickMessage("save"); });<br />
 mockRepository.ReplayAll();</p>
<p> &#47;&#47; Exercise<br />
 RhinoMocksExtensions<br />
  .GetEventRaiser(view, delegate(IView v) { v.SaveClick += null; })<br />
  .Raise(view, EventArgs.Empty);</p>
<p>  &#47;&#47; Verify<br />
  mockRepository.VerifyAll();<br />
 }<br />
}[&#47;code]</p>
<p><br&#47;></p>
<p><img src="http:&#47;&#47;www.timvw.be&#47;wp-content&#47;images&#47;overspecification-02.PNG" alt="screenshot of test runner with a failing test." &#47;></p>
<p>Although we implemented the feature correctly, and left the code of the first feature untouched, we notice that our ShouldDisplayEditClickMessage test fails because it is not expecting a subscription to the SaveClick event. Imho, this way of testing is a testing <b>anti-pattern<&#47;b>.<&#47;p></p>
