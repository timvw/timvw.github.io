---
layout: post
status: publish
published: true
title: Pondering about DateTime and it&#039;s Ticks...
author:
  display_name: timvw
  login: admin
  email: tim@timvw.be
  url: http://timvw.myopenid.com/
author_login: admin
author_email: tim@timvw.be
author_url: http://timvw.myopenid.com/
wordpress_id: 181
wordpress_url: http://www.timvw.be/pondering-about-datetime-and-its-ticks/
date: '2007-07-18 18:29:29 +0200'
date_gmt: '2007-07-18 16:29:29 +0200'
categories: []
tags:
- C#
comments:
- id: 240
  author: Joe
  author_email: joe.harris@gmail.com
  author_url: ''
  date: '2007-08-13 16:54:10 +0200'
  date_gmt: '2007-08-13 14:54:10 +0200'
  content: I was not able to reproduce this problem.  My results were consistent with
    the first table you present.  Since I live in Florida, I used 5:59:59 on 10&#47;28&#47;2007
    as the utcBase to get the same Ticks value you did for the first time.  Other
    than that, I just copied and pasted your code.
- id: 241
  author: timvw
  author_email: timvanwassenhove@gmail.com
  author_url: http://www.timvw.be
  date: '2007-08-13 23:43:34 +0200'
  date_gmt: '2007-08-13 21:43:34 +0200'
  content: |-
    That is because in EST the DaylightTime ends on 11&#47;04&#47;2007

    TimeZone.CurrentTimeZone.GetDaylightChanges(2007);

    So, if you start with
    DateTime utcBase = new DateTime(2007, 11, 4, 4, 59, 59, DateTimeKind.Utc); you will see the same effect...
---
<p>Recently someone was able to convince me that there is no problem with using <a href="http:&#47;&#47;msdn2.microsoft.com&#47;en-us&#47;library&#47;System.Datetime.aspx">System.DateTime<&#47;a> for the storage of localtimes (even if DST is in effect), because it works with <a href="http:&#47;&#47;msdn2.microsoft.com&#47;en-us&#47;library&#47;system.datetime.ticks.aspx">Ticks<&#47;a> and i bought into his base + offset story.... The following table explains his reasoning:<&#47;p></p>
<table width="100%">
<tr>
<th style="width: 33%">Utc<&#47;th></p>
<th style="width: 33%">Localtime<&#47;th></p>
<th style="width: 33%">Ticks (Localtime)<&#47;th><br />
 <&#47;tr></p>
<tr>
<td>2007-10-27 23:59:59<&#47;td></p>
<td>2007-10-28 01:59:59<&#47;td></p>
<td>63329133<b>599<&#47;b>0000000<&#47;td><br />
 <&#47;tr></p>
<tr style="background-color: orange">
<td>+1 second<&#47;td></p>
<td>2007-10-28 02:00:00<&#47;td></p>
<td>63329133<b>600<&#47;b>0000000<&#47;td><br />
 <&#47;tr></p>
<tr>
<td>+2 seconds<&#47;td></p>
<td>2007-10-28 02:00:01<&#47;td></p>
<td>63329133<b>601<&#47;b>0000000<&#47;td><br />
 <&#47;tr></p>
<tr>
<td>+60 minutes<&#47;td></p>
<td>2007-10-28 02:59:59<&#47;td></p>
<td>63329137<b>199<&#47;b>0000000<&#47;td><br />
 <&#47;tr></p>
<tr>
<td>+60 minutes and 1 second<&#47;td></p>
<td>2007-10-28 02:00:00<&#47;td></p>
<td>63329133<b>200<&#47;b>0000000<&#47;td><br />
 <&#47;tr></p>
<tr>
<td>+60 minutes and 2 seconds<&#47;td></p>
<td>2007-10-28 02:00:01<&#47;td></p>
<td>63329133<b>201<&#47;b>0000000<&#47;td><br />
 <&#47;tr><br />
<&#47;table></p>
<p>This reasoning gives you the impression that for each second <b>1<&#47;b>0000000 is added to the ticks.. However, this is faulty and in reality you get the following:<&#47;p></p>
<table width="100%">
<tr>
<th style="width: 33%">Utc<&#47;th></p>
<th style="width: 33%">Localtime<&#47;th></p>
<th style="width: 33%">Ticks (Localtime)<&#47;th><br />
 <&#47;tr></p>
<tr>
<td>2007-10-27 23:59:59<&#47;td></p>
<td>2007-10-28 01:59:59<&#47;td></p>
<td>63329133<b>599<&#47;b>0000000<&#47;td><br />
 <&#47;tr></p>
<tr style="background-color: orange">
<td>+1 second<&#47;td></p>
<td>2007-10-28 02:00:00<&#47;td></p>
<td>63329133<b>600<&#47;b>0000000<&#47;td><br />
 <&#47;tr></p>
<tr>
<td>+2 seconds<&#47;td></p>
<td>2007-10-28 02:00:01<&#47;td></p>
<td>63329133<b>601<&#47;b>0000000<&#47;td><br />
 <&#47;tr></p>
<tr>
<td>+60 minutes<&#47;td></p>
<td>2007-10-28 02:59:59<&#47;td></p>
<td>63329137<b>199<&#47;b>0000000<&#47;td><br />
 <&#47;tr></p>
<tr style="background-color: orange">
<td>+60 minutes and 1 second<&#47;td></p>
<td>2007-10-28 02:00:00<&#47;td></p>
<td>63329133<span style="color: red"><b>600<&#47;b><&#47;span>0000000<&#47;td><br />
 <&#47;tr></p>
<tr>
<td>+60 minutes and 2 seconds<&#47;td></p>
<td>2007-10-28 02:00:01<&#47;td></p>
<td>63329133<b>601<&#47;b>0000000<&#47;td><br />
 <&#47;tr><br />
<&#47;table></p>
<p>As you can see, instead of adding <b>1<&#47;b>0000000 to the ticks between 2007-10-27 00:59:59 and 01:00:00 in UTC there is a <span style="color:red">reduction of ticks in the localtime<&#47;span> instead.... Because of this new DateTime(633291336000000000, DateTimeKind.Local) could represent both 2007-10-27 00:00:00 UTC and 2007-10-27 01:00:00 UTC... So if you want to keep out of trouble you'd better start storing your dates as UTC... If you don't believe me, run the test yourself:<&#47;p><br />
[code lang="csharp"]List<dateTime> localTimes = new List<dateTime>();</p>
<p>&#47;&#47; start at 2007-10-27 23:59:59 UTC, which is 2007-28-10 01:59:59 localtime<br />
DateTime utcBase = new DateTime(2007, 10, 27, 23, 59, 59, DateTimeKind.Utc);<br />
localTimes.Add(utcBase.ToLocalTime());</p>
<p>&#47;&#47; add 1 second to the base, which is 2007-28-10 02:00:00 localtime (first time)<br />
localTimes.Add(utcBase.AddSeconds(1).ToLocalTime());</p>
<p>&#47;&#47; add 2 seconds to the base, which is 2007-28-10 02:00:01 localtime (first time)<br />
localTimes.Add(utcBase.AddSeconds(2).ToLocalTime());</p>
<p>&#47;&#47; add 60 minutes to the base, which is 2007-28-10 02:59:59 localtime (first time)<br />
localTimes.Add(utcBase.AddMinutes(60).ToLocalTime());</p>
<p>&#47;&#47; add 60 minutes and 1 second to the base, which is 2007-28-10 02:00:00 localtime (second time)<br />
localTimes.Add(utcBase.AddMinutes(60).AddSeconds(1).ToLocalTime());</p>
<p>&#47;&#47; add 60 minutes and 2 second to the base, which is 2007-28-10 02:00:01 localtime (second time)<br />
localTimes.Add(utcBase.AddMinutes(60).AddSeconds(2).ToLocalTime());</p>
<p>foreach (DateTime localTime in localTimes)<br />
{<br />
 Console.WriteLine(localTime.ToString("yyyy-MM-dd HH:mm:ss"));<br />
 Console.WriteLine(localTime.Ticks);<br />
 Console.WriteLine();<br />
}[&#47;code]</p>
