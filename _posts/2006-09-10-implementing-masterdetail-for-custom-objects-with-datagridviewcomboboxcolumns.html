---
layout: post
status: publish
published: true
title: Implementing Master&#47;Detail for Custom Objects with DataGridViewComboBoxColumns
author:
  display_name: timvw
  login: admin
  email: tim@timvw.be
  url: http://timvw.myopenid.com/
author_login: admin
author_email: tim@timvw.be
author_url: http://timvw.myopenid.com/
wordpress_id: 13
wordpress_url: http://www.timvw.be/implementing-masterdetail-for-custom-objects-with-datagridviewcomboboxcolumns/
date: '2006-09-10 02:07:17 +0200'
date_gmt: '2006-09-10 00:07:17 +0200'
categories: []
tags:
- C#
- Windows Forms
comments:
- id: 44
  author: sam
  author_email: ''
  author_url: ''
  date: '2006-11-08 03:49:19 +0100'
  date_gmt: '2006-11-08 01:49:19 +0100'
  content: |-
    works good, very unique approach! never realized you could have items in the cell that were different from the combobox.

    in the Form constructor add
       this.Column1.ValueMember = "Id";

    and in
    private void dataGridView1_EditingControlShowing
    replace
      int parentId = ( (Parent)currentCellValue ).Id;
    with
      int parentId = (int)currentCellValue;
- id: 45
  author: begc
  author_email: ckbeg1705@gmail.com
  author_url: ''
  date: '2007-09-23 11:33:41 +0200'
  date_gmt: '2007-09-23 09:33:41 +0200'
  content: |-
    Hi Tim,
    It is very good code, but it is not working when tried it with my classes. It shows error like Formatting&#47;Displaying. Why?
    Could you please help me.
- id: 46
  author: ali
  author_email: novin_pardaz1@yahoo.com
  author_url: ''
  date: '2008-10-13 22:36:44 +0200'
  date_gmt: '2008-10-13 20:36:44 +0200'
  content: |-
    hi
    how use this code in vb.net with dataset
    please help me
- id: 21426
  author: Chub
  author_email: ''
  author_url: ''
  date: '2011-11-01 23:16:55 +0100'
  date_gmt: '2011-11-01 22:16:55 +0100'
  content: "Very nice solution.\r\nWhat if the requirement is to populate automatically
    parent based on child selection. i.e by selecting any Child element from the combobox
    list it should automatically select the Parent. How this should be accomplished?
    \r\n\r\nThanks"
---
<p>Imagine you have the following two classes:<&#47;p><br />
[code lang="csharp"]public class Parent {<br />
 private int id;<br />
 private string name;</p>
<p> public Parent( int id, string name ) {<br />
  this.id = id;<br />
  this.name = name;<br />
 }</p>
<p> public int Id {<br />
  get { return this.id; }<br />
 }</p>
<p> public string Name {<br />
  get { return this.name; }<br />
 }<br />
}</p>
<p>public class Child : Parent {<br />
 private int parentId;</p>
<p> public Child( int id, int parentId, string name )<br />
  : base( id, name ) {<br />
  this.parentId = parentId;<br />
 }</p>
<p> public int ParentId {<br />
  get { return this.parentId; }<br />
 }<br />
}[&#47;code]</p>
<p>In the first ComboBoxColumn you display a list of possible Parents. In the second ComboBoxColumn you display Children, but only those that belong to the Chosen Parent. Here is how it goes:<&#47;p><br />
[code lang="csharp"]public partial class Form1 : Form {<br />
private Object selectedValue;</p>
<p>public Form1() {<br />
 InitializeComponent();</p>
<p> &#47;&#47; Add a couple of Parents<br />
 for ( int i = 0; i < 3; ++i ) {<br />
  Parent parent = new Parent( i, String.Format( "Parent{0:00}", i ) );<br />
  this.Column1.Items.Add( parent );<br />
  &#47;&#47; Add a couple of Children to each parent<br />
  for ( int j = 0; j < 5; ++j ) {<br />
   Child child = new Child( j, i, String.Format( "Child{0:00}", i * 10 + j ) );<br />
   this.Column2.Items.Add( child );<br />
  }<br />
 }</p>
<p> this.Column1.DisplayMember = "Name";<br />
 this.Column2.DisplayMember = "Name";<br />
}</p>
<p>private void dataGridView1_CellParsing( object sender, DataGridViewCellParsingEventArgs e ) {<br />
 e.Value = this.selectedValue;<br />
 e.ParsingApplied = true;<br />
}</p>
<p>private void dataGridView1_EditingControlShowing( object sender, DataGridViewEditingControlShowingEventArgs e ) {<br />
 ComboBox cb = e.Control as ComboBox;<br />
 if ( cb != null ) {<br />
  &#47;&#47; remove all the children that do not belong to the choosen parent<br />
  int currentColumnIndex = this.dataGridView1.CurrentCell.ColumnIndex;<br />
  if ( currentColumnIndex == 1 ) {<br />
   cb.Items.Clear();</p>
<p>   int currentRowIndex = this.dataGridView1.CurrentCell.RowIndex;<br />
   Object currentCellValue = this.dataGridView1.Rows[currentRowIndex].Cells[0].Value;<br />
   if ( currentCellValue != null ) {<br />
    int parentId = ( (Parent)currentCellValue ).Id;</p>
<p>    foreach ( Child child in this.Column2.Items ) {<br />
     if ( child.ParentId == parentId ) {<br />
      cb.Items.Add( child );<br />
     }<br />
    }<br />
   }<br />
  }</p>
<p>  cb.SelectedIndexChanged -= cb_SelectedIndexChanged;<br />
  cb.SelectedIndexChanged += cb_SelectedIndexChanged;<br />
 }</p>
<p> void cb_SelectedIndexChanged(object sender, EventArgs e) {<br />
  ComboBox comboBox = sender as ComboBox;<br />
  this.selectedValue = comboBox.SelectedItem;<br />
 }<br />
}[&#47;code]</p>
