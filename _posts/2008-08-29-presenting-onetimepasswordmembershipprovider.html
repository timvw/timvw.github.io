---
layout: post
status: publish
published: true
title: Presenting OneTimePasswordMembershipProvider
author:
  display_name: timvw
  login: admin
  email: tim@timvw.be
  url: http://timvw.myopenid.com/
author_login: admin
author_email: tim@timvw.be
author_url: http://timvw.myopenid.com/
wordpress_id: 445
wordpress_url: http://www.timvw.be/?p=445
date: '2008-08-29 17:49:41 +0200'
date_gmt: '2008-08-29 15:49:41 +0200'
categories: []
tags:
- C#
comments: []
---
<p>What good is a <a href="http:&#47;&#47;www.timvw.be&#47;presenting-timeotpclient&#47;">TimeOTP<&#47;a> client if you don't have anything to use it with? Last week i have implemented a <a href="http:&#47;&#47;msdn.microsoft.com&#47;en-us&#47;library&#47;system.web.security.membershipprovider.aspx">MembershipProvider<&#47;a> that uses <a href="http:&#47;&#47;www.timvw.be&#47;presenting-hmac-based-otp-and-time-based-otp&#47;">Time-based One-Time Password<&#47;a> to validate the user credentials. Basically, it is a wrapper around an existing MembershipProvider, you get to choose which one via the providerType attribute in the configuration, and requires that it can access the password of users. Here is an example configuration that relies on the SqlMembershipProvider:<&#47;p></p>
<p>[code lang="xml"]<?xml version="1.0"?><br />
<configuration><br />
 <connectionStrings><br />
  <add name="MyDatabase"<br />
         connectionString="xxxxx"<br />
         providerName="System.Data.SqlClient"&#47;><br />
 <&#47;connectionStrings><br />
 <system.web><br />
  <membership defaultProvider="OTPMembershipProvider"></p>
<providers>
    <add connectionStringName="MyDatabase"<br />
            enablePasswordRetrieval="true"<br />
            enablePasswordReset="true"<br />
            requiresQuestionAndAnswer="false"<br />
            applicationName="&#47;DemoOTP"<br />
            requiresUniqueEmail="false"<br />
            passwordFormat="Clear"<br />
            maxInvalidPasswordAttempts="5"<br />
            minRequiredPasswordLength="7"<br />
            minRequiredNonalphanumericCharacters="1"<br />
            passwordAttemptWindow="10"<br />
            passwordStrengthRegularExpression=""<br />
            name="OTPMembershipProvider"<br />
            type="Be.Timvw.Framework.Web.Security.OneTimePasswordMembershipProvider, Be.Timvw.Framework.Web"<br />
            providerType="System.Web.Security.SqlMembershipProvider, System.Web" &#47;><br />
    <&#47;providers><br />
   <&#47;membership><br />
   <authentication mode="Forms" &#47;><br />
    <authorization><br />
     <allow users="timvw"&#47;><br />
     <deny users="*"&#47;><br />
    <&#47;authorization><br />
 <&#47;system.web><br />
<&#47;configuration>[&#47;code]</p>
<p>While i was writing unittests i ran into a couple of issues: <&#47;p></p>
<ul>
<li><a href="http:&#47;&#47;www.nmock.org&#47;">NMock<&#47;a> seemingly only works with interfaces so i had to rip out an interface out of the abstract base class and wrap that in a MockMembershipProvider.<&#47;li>
<li>Settings expectations for output parameters can be achieved with a SetNameParameterAction as described <a href="http:&#47;&#47;www.pashabitz.com&#47;PermaLink,guid,02e35fa6-c729-43a8-85c3-8c05df7a4aa8.aspx">here<&#47;a>.<&#47;li><br />
<&#47;ul></p>
<p>Anyway, you can find the implementation of the MembershipProvider in <a href="http:&#47;&#47;www.codeplex.com&#47;BeTimvwFramework">BeTimvwFramework<&#47;a> and <a href="http:&#47;&#47;www.timvw.be&#47;wp-content&#47;code&#47;csharp&#47;DemoOTP.zip">download the demo webapplication<&#47;a>.<&#47;p></p>
