---
layout: post
status: publish
published: true
title: Searching made easy
author:
  display_name: timvw
  login: admin
  email: tim@timvw.be
  url: http://timvw.myopenid.com/
author_login: admin
author_email: tim@timvw.be
author_url: http://timvw.myopenid.com/
wordpress_id: 123
wordpress_url: http://www.timvw.be/searching-made-easy/
date: '2006-10-22 11:09:28 +0200'
date_gmt: '2006-10-22 09:09:28 +0200'
categories: []
tags:
- SQL
comments: []
---
<p>Very often i have to write queries that return all the rows where one or more columns match a specific value. If i add for every column the condition 'P_COLUMN IS NULL OR COLUMN = P_COLUMN' to the WHERE clause i only have to write one query. Here's an example of such a query:<&#47;p></p>
<p>[code lang="sql"]<br />
PROCEDURE FIND_TESTS<br />
(<br />
 P_ID              IN        TEST.ID%Type,<br />
 P_TITLE         IN        TEST.TITLE%Type,<br />
 P_TYPE_CODE IN        TEST.TYPE_CODE%Type,<br />
 P_CURSOR      OUT     CURSOR REF<br />
)</p>
<p>AS</p>
<p>BEGIN</p>
<p>OPEN<br />
              P_CURSOR FOR<br />
SELECT<br />
              ID,<br />
              TITLE,<br />
              TYPE_CODE<br />
FROM<br />
              TEST<br />
WHERE<br />
              (P_ID IS NULL OR ID = P_ID)<br />
              AND (P_TITLE IS NULL OR TITLE LIKE P_TITLE)<br />
              AND (P_TYPE_CODE IS NULL OR TYPE_CODE LIKE P_TYPE_CODE)<br />
ORDER BY<br />
              ID ASC;<br />
END;<br />
[&#47;code]</p>
<p>A couple of examples how you can use this query:<&#47;p></p>
<p>[code lang="csharp"]<br />
using (OracleConnection conn = new OracleConnection("User Id=u;password=p;Data Source=ORCL"))<br />
{<br />
 conn.Open();</p>
<p> OracleCommand command = conn.CreateCommand();<br />
 command.CommandText = "TIMVW.MYPACKAGE.FIND_TESTS";<br />
 command.CommandType = CommandType.StoredProcedure;</p>
<p> &#47;&#47; select all tests of type_code "book" that have a title that starts with "Myst"<br />
 command.Parameters.Add("P_ID", OracleDbType.Int32, 10, DBNull.Value, ParameterDirection.Input);<br />
 command.Parameters.Add("P_TITLE", OracleDbType.Varchar2, 20, "Myst%", ParameterDirection.Input);<br />
 command.Parameters.Add("P_TYPE_CODE", OracleDbType.Varchar2, 20, "book", ParameterDirection.Input);<br />
 command.Parameters.Add("P_CURSOR", OracleDbType.RefCursor, ParameterDirection.Output);</p>
<p> &#47;&#47; select the test with id 1<br />
 &#47;&#47;command.Parameters.Add("P_ID", OracleDbType.Int32, 10, 1, ParameterDirection.Input);<br />
 &#47;&#47;command.Parameters.Add("P_TITLE", OracleDbType.Varchar2, 20, DBNull.Value, ParameterDirection.Input);<br />
 &#47;&#47;command.Parameters.Add("P_TYPE_CODE", OracleDbType.Varchar2, 20, DBNull.Value, ParameterDirection.Input);<br />
 &#47;&#47;command.Parameters.Add("P_CURSOR", OracleDbType.RefCursor, ParameterDirection.Output);</p>
<p> OracleDataReader reader = command.ExecuteReader();<br />
 while (reader.Read())<br />
 {<br />
  Console.WriteLine("test id: " + reader.GetDecimal(0));<br />
 }</p>
<p> Console.Write("{0}Press any key to continue...", Environment.NewLine);<br />
 Console.ReadKey();<br />
}<br />
[&#47;code]</p>
