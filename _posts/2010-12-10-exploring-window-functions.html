---
layout: post
status: publish
published: true
title: Exploring window functions
author:
  display_name: timvw
  login: admin
  email: tim@timvw.be
  url: http://timvw.myopenid.com/
author_login: admin
author_email: tim@timvw.be
author_url: http://timvw.myopenid.com/
wordpress_id: 2005
wordpress_url: http://www.timvw.be/?p=2005
date: '2010-12-10 21:52:01 +0100'
date_gmt: '2010-12-10 20:52:01 +0100'
categories:
- Uncategorized
tags:
- SQL
comments: []
---
<p>Here is a sample query that allows you to explore the behavior of various <a href="http:&#47;&#47;msdn.microsoft.com&#47;en-us&#47;library&#47;ms189461.aspx">aggregate window functions<&#47;a>:<&#47;p></p>
<p>[code lang="sql"]<br />
WITH<br />
    [Nums1] AS ( SELECT 1 AS [Value] UNION SELECT 2 AS [Value] )<br />
  , [Nums2] AS ( SELECT A.* FROM [Nums1] AS A, [Nums1] AS B, [Nums1] AS C)<br />
  , [Nums3] AS ( SELECT A.* FROM [Nums2] AS A, [Nums2] AS B, [Nums2] AS C)<br />
  , [Nums4] AS ( SELECT A.* FROM [Nums3] AS A, [Nums3] AS B )<br />
  -- Build numbers from 1 to 1000<br />
  , [Numbers] AS ( SELECT TOP(1000) ROW_NUMBER() OVER(ORDER BY [Value]) AS [Value] FROM[Nums4] )<br />
SELECT<br />
    [Value]<br />
  , ROW_NUMBER() OVER(PARTITION BY [Value] &#47; 100 ORDER BY [Value] % 10) AS [RowNumber]<br />
  , RANK() OVER(PARTITION BY [Value] &#47; 100 ORDER BY [Value] % 10) AS [Rank]<br />
  , DENSE_RANK() OVER (PARTITION BY [Value] &#47; 100 ORDER BY [Value] % 10) AS [DenseRank]<br />
  , NTILE(4) OVER (PARTITION BY [Value] &#47; 100 ORDER BY [Value] % 10) AS [Tile100]<br />
FROM<br />
    [Numbers]<br />
ORDER BY<br />
    [Value];<br />
[&#47;code]</p>
