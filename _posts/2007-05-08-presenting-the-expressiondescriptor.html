---
layout: post
status: publish
published: true
title: Presenting the ExpressionDescriptor
author:
  display_name: timvw
  login: admin
  email: tim@timvw.be
  url: http://timvw.myopenid.com/
author_login: admin
author_email: tim@timvw.be
author_url: http://timvw.myopenid.com/
wordpress_id: 169
wordpress_url: http://www.timvw.be/presenting-the-expressiondescriptor/
date: '2007-05-08 21:07:47 +0200'
date_gmt: '2007-05-08 19:07:47 +0200'
categories: []
tags:
- C#
- Windows Forms
comments: []
---
<p>A couple of days ago i presented you the <a href="http:&#47;&#47;www.timvw.be&#47;presenting-the-typedlistt&#47;">TypedList<&#47;a> which supports navigation through subproperties. Another common feature request is the possibility to add a column that has a value based on other values in the row (like a DataColumn with it's Expression property set). With the plumbing code i've written it's as simple as implementing the following interface:<&#47;p><br />
[code lang="csharp"]public interface IExpressionProvider<componentType, PropertyType><br />
{<br />
 &#47;&#47;&#47;<br />
<summary>
 &#47;&#47;&#47; Gets the name of the property<br />
 &#47;&#47;&#47; <&#47;summary><br />
 string Name { get; }</p>
<p> &#47;&#47;&#47;<br />
<summary>
 &#47;&#47;&#47; Returns the value of the expression for the given component<br />
 &#47;&#47;&#47; <&#47;summary><br />
 &#47;&#47;&#47;
<param name="component"><&#47;param><br />
 &#47;&#47;&#47; <returns><&#47;returns><br />
 PropertyType GetValue(ComponentType component);<br />
}[&#47;code]</p>
<p>An example implementation could be an expression that represents the duration of an Appointment:<&#47;p><br />
[code lang="csharp"]public class DurationExpressionProvider : IExpressionProvider<appointment, TimeSpan><br />
{<br />
 #region IExpressionProvider<appointment,TimeSpan> Members</p>
<p> public string Name { get { return "||Duration"; } }</p>
<p> public TimeSpan GetValue(Appointment component)<br />
 {<br />
  return component.DateTimeRange.End - component.DateTimeRange.Start;<br />
 }</p>
<p> #endregion<br />
}[&#47;code]</p>
<p>I've changed the constructor of TypedList a bit so that it accepts an enumeration of PropertyDescriptors. In my example you can initialise the list as following:<&#47;p><br />
[code lang="csharp"]List
<propertyDescriptor> propertyDescriptors = new List
<propertyDescriptor>();</p>
<p>&#47;&#47; create the subpropertydescriptors<br />
string[] propertyNames = new string[] { "Patient.Name", "Patient.Address.Municipality", "DateTimeRange.Start", "DateTimeRange.End" };<br />
propertyDescriptors.AddRange(Array.ConvertAll<string, SubPropertyDescriptor<appointment>>(propertyNames, delegate(string propertyName) { return new SubPropertyDescriptor<appointment>(propertyName); }));</p>
<p>&#47;&#47; add an expressiondescriptor<br />
IExpressionProvider<appointment, TimeSpan> expressionProvider = new DurationExpressionProvider();<br />
ExpressionDescriptor<appointment, TimeSpan> durationDescriptor = new ExpressionDescriptor<appointment, TimeSpan>(expressionProvider);<br />
propertyDescriptors.Add(durationDescriptor);</p>
<p>TypedBindingList<appointment> appointments = new TypedBindingList<appointment>(propertyDescriptors);[&#47;code]</p>
<p>And this is how it looks like at runtime:<&#47;p><br />
<img src="http:&#47;&#47;www.timvw.be&#47;wp-content&#47;images&#47;typedlist-3.gif" alt="image of the typedlist"&#47;></p>
<p>As always, feel free to download the code: <a href="http:&#47;&#47;www.timvw.be&#47;wp-content&#47;code&#47;csharp&#47;TypedList.zip">TypedList.zip<&#47;a>.<&#47;p></p>
