<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Configuring MinIO OAuth with Authentik - Tim Van Wassenhove</title><meta name="viewport" content="width=device-width, initial-scale=1">
	
  <meta itemprop="name" content="Configuring MinIO OAuth with Authentik">
  <meta itemprop="description" content="Introduction Following our previous posts about setting up Authentik with Kubernetes and FluxCD, managing Authentik with Terraform, and configuring Grafana OAuth integration, today I’ll share how I implemented OAuth authentication for MinIO using Authentik as the identity provider.
MinIO is a high-performance object storage system compatible with Amazon S3 API. By integrating it with Authentik, we can leverage centralized authentication and role-based access control for our object storage environment.
Integration Overview The integration between MinIO and Authentik involves the following components:">
  <meta itemprop="datePublished" content="2025-03-20T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-03-20T21:47:15+01:00">
  <meta itemprop="wordCount" content="884">
  <meta itemprop="keywords" content="Minio,Authentik,Oauth,Terraform,Kubernetes"><meta property="og:url" content="https://timvw.be/2025/03/20/configuring-minio-oauth-with-authentik/">
  <meta property="og:site_name" content="Tim Van Wassenhove">
  <meta property="og:title" content="Configuring MinIO OAuth with Authentik">
  <meta property="og:description" content="Introduction Following our previous posts about setting up Authentik with Kubernetes and FluxCD, managing Authentik with Terraform, and configuring Grafana OAuth integration, today I’ll share how I implemented OAuth authentication for MinIO using Authentik as the identity provider.
MinIO is a high-performance object storage system compatible with Amazon S3 API. By integrating it with Authentik, we can leverage centralized authentication and role-based access control for our object storage environment.
Integration Overview The integration between MinIO and Authentik involves the following components:">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-03-20T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-03-20T21:47:15+01:00">
    <meta property="article:tag" content="Minio">
    <meta property="article:tag" content="Authentik">
    <meta property="article:tag" content="Oauth">
    <meta property="article:tag" content="Terraform">
    <meta property="article:tag" content="Kubernetes">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Configuring MinIO OAuth with Authentik">
  <meta name="twitter:description" content="Introduction Following our previous posts about setting up Authentik with Kubernetes and FluxCD, managing Authentik with Terraform, and configuring Grafana OAuth integration, today I’ll share how I implemented OAuth authentication for MinIO using Authentik as the identity provider.
MinIO is a high-performance object storage system compatible with Amazon S3 API. By integrating it with Authentik, we can leverage centralized authentication and role-based access control for our object storage environment.
Integration Overview The integration between MinIO and Authentik involves the following components:">
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://timvw.be/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://timvw.be/js/main.js"></script>
	<link href="https://github.com/timvw" rel="me">
    <link href="https://timvw.be/" rel="me">
    <link href="https://fosstodon.org/@timvw" rel="me">
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="https://timvw.be/">Tim Van Wassenhove</a></h1>
	<div class="site-description"><p>Passionate geek, interested in Technology. Proud father of two</p><nav class="nav social">
			<ul class="flat"><li><a href="https://twitter.com/timvw" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://github.com/timvw" title="Github"><i data-feather="github"></i></a></li><li><a href="https://www.linkedin.com/in/timvanwassenhove" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="https://timvw.be/feed.xml" title="RSS"><i data-feather="rss"></i></a></li><li><a rel="me" href="https://fosstodon.org/@timvw" class="masto-link" ></a></li>
			</ul>
		
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="../../../../">Home</a>
			</li>
			
			<li>
				<a href="../../../../posts">All posts</a>
			</li>
			
			<li>
				<a href="../../../../tags">Tags</a>
			</li>
			
			<li>
				<a href="../../../../about/">About Me</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">20</span>
							<span class="rest">Mar 2025</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Configuring MinIO OAuth with Authentik</h1>
				</div>
			</div>
					
			<div class="markdown">
				<h2 id="introduction">Introduction</h2>
<p>Following our previous posts about <a href="../../../../2025/03/17/setting-up-authentik-with-kubernetes-and-fluxcd/">setting up Authentik with Kubernetes and FluxCD</a>, <a href="../../../../2025/03/18/managing-authentik-with-terraform/">managing Authentik with Terraform</a>, and <a href="../../../../2025/03/19/configuring-grafana-oauth-with-authentik/">configuring Grafana OAuth integration</a>, today I&rsquo;ll share how I implemented OAuth authentication for MinIO using Authentik as the identity provider.</p>
<p>MinIO is a high-performance object storage system compatible with Amazon S3 API. By integrating it with Authentik, we can leverage centralized authentication and role-based access control for our object storage environment.</p>
<h2 id="integration-overview">Integration Overview</h2>
<p>The integration between MinIO and Authentik involves the following components:</p>
<ol>
<li><strong>Authentik OAuth Provider</strong>: Configuration in Authentik to enable OAuth authentication for MinIO</li>
<li><strong>Property Mappings</strong>: Ensuring user group information is included in JWT tokens</li>
<li><strong>MinIO OpenID Configuration</strong>: Setting up MinIO to use Authentik for authentication</li>
<li><strong>JWT Claims Processing</strong>: How MinIO interprets group information from tokens</li>
</ol>
<h2 id="configuring-authentik-for-minio-oauth">Configuring Authentik for MinIO OAuth</h2>
<p>First, let&rsquo;s look at how we&rsquo;ve configured the Authentik side of the integration using Terraform:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-terraform" data-lang="terraform"><span style="display:flex;"><span><span style="color:#cf222e">resource</span> <span style="color:#0a3069">&#34;authentik_provider_oauth2&#34;</span> <span style="color:#0a3069">&#34;minio&#34;</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">name</span>               = <span style="color:#0a3069">&#34;Minio&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">client_id</span>          = <span style="color:#0a3069">&#34;minio&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">client_secret</span>      = <span style="color:#6639ba">var</span><span style="color:#1f2328">.</span><span style="color:#1f2328">minio_client_secret</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">authorization_flow</span> = <span style="color:#6639ba">data</span><span style="color:#1f2328">.</span><span style="color:#1f2328">authentik_flow</span><span style="color:#1f2328">.</span><span style="color:#1f2328">default</span><span style="color:#0550ae">-</span><span style="color:#1f2328">provider</span><span style="color:#0550ae">-</span><span style="color:#1f2328">authorization</span><span style="color:#0550ae">-</span><span style="color:#1f2328">implicit</span><span style="color:#0550ae">-</span><span style="color:#1f2328">consent</span><span style="color:#1f2328">.</span><span style="color:#1f2328">id</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">invalidation_flow</span>  = <span style="color:#6639ba">data</span><span style="color:#1f2328">.</span><span style="color:#1f2328">authentik_flow</span><span style="color:#1f2328">.</span><span style="color:#1f2328">default_invalidation_flow</span><span style="color:#1f2328">.</span><span style="color:#1f2328">id</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">signing_key</span>        = <span style="color:#6639ba">data</span><span style="color:#1f2328">.</span><span style="color:#1f2328">authentik_certificate_key_pair</span><span style="color:#1f2328">.</span><span style="color:#1f2328">default</span><span style="color:#1f2328">.</span><span style="color:#1f2328">id</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">sub_mode</span> = <span style="color:#0a3069">&#34;user_username&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">property_mappings</span> = <span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">    data</span><span style="color:#1f2328">.</span><span style="color:#1f2328">authentik_property_mapping_provider_scope</span><span style="color:#1f2328">.</span><span style="color:#1f2328">scope</span><span style="color:#0550ae">-</span><span style="color:#1f2328">email</span><span style="color:#1f2328">.</span><span style="color:#1f2328">id</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">    data</span><span style="color:#1f2328">.</span><span style="color:#1f2328">authentik_property_mapping_provider_scope</span><span style="color:#1f2328">.</span><span style="color:#1f2328">scope</span><span style="color:#0550ae">-</span><span style="color:#1f2328">profile</span><span style="color:#1f2328">.</span><span style="color:#1f2328">id</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">    data</span><span style="color:#1f2328">.</span><span style="color:#1f2328">authentik_property_mapping_provider_scope</span><span style="color:#1f2328">.</span><span style="color:#1f2328">scope</span><span style="color:#0550ae">-</span><span style="color:#1f2328">openid</span><span style="color:#1f2328">.</span><span style="color:#1f2328">id</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">authentik_property_mapping_provider_scope</span><span style="color:#1f2328">.</span><span style="color:#1f2328">minio</span><span style="color:#1f2328">.</span><span style="color:#1f2328">id</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">allowed_redirect_uris</span> = <span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#0a3069">&#34;matching_mode&#34;</span> <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;strict&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#0a3069">&#34;url&#34;</span>           <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;https://minio.apps.timvw.be/oauth_callback&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">
</span></span></span><span style="display:flex;"><span><span style="color:#cf222e">resource</span> <span style="color:#0a3069">&#34;authentik_application&#34;</span> <span style="color:#0a3069">&#34;minio&#34;</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">name</span>              = <span style="color:#0a3069">&#34;Minio&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">slug</span>              = <span style="color:#0a3069">&#34;minio&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">protocol_provider</span> = <span style="color:#1f2328">authentik_provider_oauth2</span><span style="color:#1f2328">.</span><span style="color:#1f2328">minio</span><span style="color:#1f2328">.</span><span style="color:#1f2328">id</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">meta_icon</span>         = <span style="color:#0a3069">&#34;https://dl.min.io/logo/Minio_logo_light/Minio_logo_light.svg&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">meta_launch_url</span>   = <span style="color:#0a3069">&#34;https://minio.apps.timvw.be&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">open_in_new_tab</span>   = <span style="color:#cf222e">true</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">
</span></span></span><span style="display:flex;"><span><span style="color:#cf222e">resource</span> <span style="color:#0a3069">&#34;authentik_property_mapping_provider_scope&#34;</span> <span style="color:#0a3069">&#34;minio&#34;</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">name</span>       = <span style="color:#0a3069">&#34;minio&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">scope_name</span> = <span style="color:#0a3069">&#34;minio&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">expression</span> = <span style="color:#0550ae">&lt;&lt;EOF</span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">return {
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">  &#34;policy&#34;: &#34;readwrite&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">}
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069"></span><span style="color:#0550ae">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span></code></pre></div><p>This configuration:</p>
<ol>
<li>Creates an OAuth2 provider for MinIO with the necessary flow and key settings</li>
<li>Includes standard OpenID scopes plus a custom scope for MinIO</li>
<li>Sets up allowed redirect URIs for security</li>
<li>Creates an application in Authentik that users will see in their dashboard</li>
<li>Defines a custom property mapping that adds a policy claim to the JWT</li>
</ol>
<h2 id="configuring-minio-for-openid-authentication">Configuring MinIO for OpenID Authentication</h2>
<p>Now let&rsquo;s look at the MinIO configuration in our Kubernetes deployment:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#0550ae">apiVersion</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>apps/v1<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">kind</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>Deployment<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">metadata</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">  </span><span style="color:#0550ae">name</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>minio<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">  </span><span style="color:#0550ae">namespace</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>minio<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">spec</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">  </span><span style="color:#0550ae">replicas</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">  </span><span style="color:#0550ae">selector</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#0550ae">matchLabels</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#0550ae">app</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>minio<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">  </span><span style="color:#0550ae">template</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#0550ae">metadata</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#0550ae">labels</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#0550ae">app</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>minio<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#0550ae">spec</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#0550ae">containers</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span>- <span style="color:#0550ae">name</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>minio<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#0550ae">image</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>minio/minio<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#0550ae">args</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span>- server<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span>- --address<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span>- <span style="color:#1f2328">:</span><span style="color:#0550ae">9000</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span>- --console-address<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span>- <span style="color:#1f2328">:</span><span style="color:#0550ae">9001</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span>- /data<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#0550ae">env</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span>- <span style="color:#0550ae">name</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>MINIO_ROOT_USER<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">          </span><span style="color:#0550ae">valueFrom</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">            </span><span style="color:#0550ae">secretKeyRef</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">              </span><span style="color:#0550ae">name</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>minio-credentials<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">              </span><span style="color:#0550ae">key</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>root-user<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span>- <span style="color:#0550ae">name</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>MINIO_ROOT_PASSWORD<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">          </span><span style="color:#0550ae">valueFrom</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">            </span><span style="color:#0550ae">secretKeyRef</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">              </span><span style="color:#0550ae">name</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>minio-credentials<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">              </span><span style="color:#0550ae">key</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>root-password<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#57606a"># https://min.io/docs/minio/linux/operations/external-iam/configure-openid-external-identity-management.html</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span>- <span style="color:#0550ae">name</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>MINIO_IDENTITY_OPENID_CONFIG_URL<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">          </span><span style="color:#0550ae">value</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span><span style="color:#0a3069">&#34;https://authentik.apps.timvw.be/application/o/minio/.well-known/openid-configuration&#34;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span>- <span style="color:#0550ae">name</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>MINIO_IDENTITY_OPENID_CLIENT_ID<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">          </span><span style="color:#0550ae">value</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>minio<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span>- <span style="color:#0550ae">name</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>MINIO_IDENTITY_OPENID_CLIENT_SECRET<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">          </span><span style="color:#0550ae">value</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>${CLIENT_SECRET}<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span>- <span style="color:#0550ae">name</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>MINIO_IDENTITY_OPENID_DISPLAY_NAME<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">          </span><span style="color:#0550ae">value</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span><span style="color:#0a3069">&#34;Authentik (timvw.be)&#34;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span>- <span style="color:#0550ae">name</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>MINIO_IDENTITY_OPENID_REDIRECT_URI<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">          </span><span style="color:#0550ae">value</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span><span style="color:#0a3069">&#34;https://minio.apps.timvw.be/oauth_callback&#34;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#57606a"># Additional configuration omitted for brevity</span><span style="color:#fff">
</span></span></span></code></pre></div><p>The key parts of this configuration are:</p>
<ol>
<li><strong>OpenID Configuration URL</strong>: Points to Authentik&rsquo;s well-known OpenID configuration endpoint for the MinIO application</li>
<li><strong>Client Credentials</strong>: The client ID and secret matching those set up in Authentik</li>
<li><strong>Display Name</strong>: A friendly name for the login button in the MinIO console</li>
<li><strong>Redirect URI</strong>: Matches the URI allowed in the Authentik OAuth provider configuration</li>
</ol>
<h2 id="how-minio-openid-authentication-works">How MinIO OpenID Authentication Works</h2>
<p>MinIO supports OpenID Connect (OIDC) for authentication, which allows it to delegate user authentication to Authentik. When properly configured, the authentication flow works as follows:</p>
<ol>
<li>User attempts to access MinIO and clicks &ldquo;Log in with OpenID&rdquo;</li>
<li>User is redirected to Authentik&rsquo;s login page</li>
<li>After successful authentication, Authentik generates a JWT token containing user information</li>
<li>User is redirected back to MinIO with this token</li>
<li>MinIO validates the token and extracts user information, including group memberships</li>
<li>MinIO maps the user&rsquo;s groups to policies that control their access permissions</li>
</ol>
<h2 id="understanding-the-property-mapping">Understanding the Property Mapping</h2>
<p>A key part of this integration is the property mapping we&rsquo;ve defined in Authentik. Let&rsquo;s examine our Terraform configuration more closely:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-terraform" data-lang="terraform"><span style="display:flex;"><span><span style="color:#cf222e">resource</span> <span style="color:#0a3069">&#34;authentik_property_mapping_provider_scope&#34;</span> <span style="color:#0a3069">&#34;minio&#34;</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">name</span>       = <span style="color:#0a3069">&#34;minio&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">scope_name</span> = <span style="color:#0a3069">&#34;minio&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">expression</span> = <span style="color:#0550ae">&lt;&lt;EOF</span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">return {
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">  &#34;policy&#34;: &#34;readwrite&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">}
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069"></span><span style="color:#0550ae">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span></code></pre></div><p>This property mapping adds a &ldquo;policy&rdquo; claim to the JWT token with the value &ldquo;readwrite&rdquo;. When MinIO receives this token, it will apply the corresponding policy to the authenticated user.</p>
<p>MinIO uses these policies to control what actions users can perform:</p>
<ul>
<li><strong>consoleAdmin</strong>: Grants full administrative access</li>
<li><strong>readOnly</strong>: Grants read-only access to all buckets</li>
<li><strong>readwrite</strong>: Grants read and write access but not administrative privileges</li>
<li><strong>writeonly</strong>: Grants write-only access (can upload but not view files)</li>
</ul>
<p>You can also create custom policies for more fine-grained permission control if needed.</p>
<h2 id="configuring-for-security">Configuring for Security</h2>
<p>When implementing this integration, several security considerations are important:</p>
<ol>
<li>Using short-lived access tokens (typically 1 hour)</li>
<li>Storing client secrets securely in Kubernetes Secrets</li>
<li>Restricting allowed redirect URIs to prevent open redirector vulnerabilities</li>
<li>Using HTTPS for all communications between Authentik and MinIO</li>
<li>Applying the principle of least privilege for access control</li>
</ol>
<h2 id="testing-the-integration">Testing the Integration</h2>
<p>After deploying the integration, you can verify it by:</p>
<ol>
<li>Accessing your MinIO instance</li>
<li>Clicking the &ldquo;Log in with OpenID&rdquo; button</li>
<li>Successfully authenticating with Authentik</li>
<li>Being redirected back to MinIO with the appropriate permissions</li>
</ol>
<p>If you encounter issues, check:</p>
<ul>
<li>The JWT token contents (using browser developer tools)</li>
<li>MinIO server logs for authentication-related messages</li>
<li>Authentik logs for token generation issues</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>Integrating MinIO with Authentik provides a robust OAuth authentication solution that centralizes user management and enables role-based access control. This integration follows the same principles as our Grafana integration, creating a consistent authentication experience across our infrastructure.</p>
<p>By leveraging Authentik as our identity provider for both services, we eliminate the need to manage separate credentials for each application while improving overall security through centralized management.</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://docs.goauthentik.io/integrations/services/minio/">Authentik MinIO Integration Documentation</a></li>
<li><a href="https://min.io/docs/minio/linux/operations/external-iam/configure-openid-external-identity-management.html">MinIO OpenID Configuration Documentation</a></li>
<li><a href="https://min.io/docs/minio/linux/administration/identity-access-management/policy-based-access-control.html">MinIO Policy Documentation</a></li>
<li><a href="https://jwt.io/">JWT.io Debugger</a> - Useful for debugging JWT tokens during integration</li>
</ul>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="../../../../tags/minio">minio</a></li>
							
							<li><a href="../../../../tags/authentik">authentik</a></li>
							
							<li><a href="../../../../tags/oauth">oauth</a></li>
							
							<li><a href="../../../../tags/terraform">terraform</a></li>
							
							<li><a href="../../../../tags/kubernetes">kubernetes</a></li>
							
						</ul>
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2025  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-9DP4SV12YW"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-9DP4SV12YW');
        }
      </script><script>feather.replace()</script>
</body>
</html>
