<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Presenting ApplicationEnvironment - Tim Van Wassenhove</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta itemprop="name" content="Presenting ApplicationEnvironment">
<meta itemprop="description" content="Imagine we are an ice cream vendor. During summer months our available capacity is twice as high as in the rest of the year. In code this problem looks like the following
public int AvailableCapacity { get { DateTime now = DateTime.UtcNow; if (new DateTime(now.Year, 6, 1) &lt;= now &amp;&amp; now &lt;= new DateTime(now.Year, 9, 1) ) { return 10000; } else { return 5000; } } } This code is pretty difficult to test because it depends on DateTime.">
<meta itemprop="datePublished" content="2008-09-22T00:00:00+00:00" />
<meta itemprop="dateModified" content="2021-11-08T15:31:18+01:00" />
<meta itemprop="wordCount" content="175">



<meta itemprop="keywords" content="CSharp," />
<meta property="og:title" content="Presenting ApplicationEnvironment" />
<meta property="og:description" content="Imagine we are an ice cream vendor. During summer months our available capacity is twice as high as in the rest of the year. In code this problem looks like the following
public int AvailableCapacity { get { DateTime now = DateTime.UtcNow; if (new DateTime(now.Year, 6, 1) &lt;= now &amp;&amp; now &lt;= new DateTime(now.Year, 9, 1) ) { return 10000; } else { return 5000; } } } This code is pretty difficult to test because it depends on DateTime." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://timvw.be/2008/09/22/presenting-applicationenvironment/" />
<meta property="article:published_time" content="2008-09-22T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-11-08T15:31:18+01:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Presenting ApplicationEnvironment"/>
<meta name="twitter:description" content="Imagine we are an ice cream vendor. During summer months our available capacity is twice as high as in the rest of the year. In code this problem looks like the following
public int AvailableCapacity { get { DateTime now = DateTime.UtcNow; if (new DateTime(now.Year, 6, 1) &lt;= now &amp;&amp; now &lt;= new DateTime(now.Year, 9, 1) ) { return 10000; } else { return 5000; } } } This code is pretty difficult to test because it depends on DateTime."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://timvw.be/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://timvw.be/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://timvw.be/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="https://timvw.be/">Tim Van Wassenhove</a></h1>
	<div class="site-description"><p>Passionate geek, interested in Technology. Proud father of two</p><nav class="nav social">
			<ul class="flat"><li><a href="https://twitter.com/timvw" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://github.com/timvw" title="Github"><i data-feather="github"></i></a></li><li><a href="https://www.linkedin.com/in/timvanwassenhove" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="https://timvw.be/feed.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="../../../../">Home</a>
			</li>
			
			<li>
				<a href="../../../../posts">All posts</a>
			</li>
			
			<li>
				<a href="../../../../tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">22</span>
							<span class="rest">Sep 2008</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Presenting ApplicationEnvironment</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>Imagine we are an ice cream vendor. During summer months our available capacity is twice as high as in the rest of the year. In code this problem looks like the following</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span> AvailableCapacity
{
	<span style="color:#000;font-weight:bold">get</span>
	{
		DateTime now = DateTime.UtcNow;

		<span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">new</span> DateTime(now.Year, <span style="color:#099">6</span>, <span style="color:#099">1</span>) &lt;= now &amp;&amp; now &lt;= <span style="color:#000;font-weight:bold">new</span> DateTime(now.Year, <span style="color:#099">9</span>, <span style="color:#099">1</span>) ) { <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">10000</span>; } 
		<span style="color:#000;font-weight:bold">else</span> { <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">5000</span>; } 
	} 
}
</code></pre></div><p>This code is pretty difficult to test because it depends on DateTime.UtcNow. In order to get control over that dependency i have defined an ApplicationEnvironment and rewritten the code as following</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span> AvailableCapacity
{
	<span style="color:#000;font-weight:bold">get</span>
	{
		DateTime now = ApplicationEnvironment.Instance.CurrentDateTime;

		<span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">new</span> DateTime(now.Year, <span style="color:#099">6</span>, <span style="color:#099">1</span>) &lt;= now &amp;&amp; now &lt;= <span style="color:#000;font-weight:bold">new</span> DateTime(now.Year, <span style="color:#099">9</span>, <span style="color:#099">1</span>) ) { <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">10000</span>; } 
		<span style="color:#000;font-weight:bold">else</span> { <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">5000</span>; } 
	} 
}
</code></pre></div><p>Now i can use my <a href="http://www.timvw.be/presenting-configurationfilesession/">ConfigurationFileSession</a> to test this code</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#008080">[TestMethod]</span>
<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">void</span> ShouldReturn10000InSummer()
{
	<span style="color:#000;font-weight:bold">using</span> (<span style="color:#000;font-weight:bold">new</span> ConfigurationFileSession(<span style="color:#d14">&#34;Summer.config&#34;</span>))
	{
		ApplicationEnvironment.Instance.Refresh();
		Assert.AreEqual(<span style="color:#099">10000</span>, <span style="color:#000;font-weight:bold">new</span> IceCreamPlant().AvailableCapacity);
	}
}
<span style="color:#008080">
</span><span style="color:#008080">[TestMethod]</span>
<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">void</span> ShouldReturn5000InWinter()
{
	<span style="color:#000;font-weight:bold">using</span> (<span style="color:#000;font-weight:bold">new</span> ConfigurationFileSession(<span style="color:#d14">&#34;Winter.config&#34;</span>))
	{
		ApplicationEnvironment.Instance.Refresh();
		Assert.AreEqual(<span style="color:#099">5000</span>, <span style="color:#000;font-weight:bold">new</span> IceCreamPlant().AvailableCapacity);
	}
}
</code></pre></div>
			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="../../../../tags/csharp">CSharp</a></li>
							
						</ul>
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2021  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-2585435-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
